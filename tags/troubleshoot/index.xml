<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Troubleshoot on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/troubleshoot/</link>
    <description>Recent content in Troubleshoot on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Wed, 21 Jul 2021 07:07:50 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/troubleshoot/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Fixing Broken Windows Permissions After Using SaRA</title>
      <link>https://fahmifj.github.io/articles/office-error-30015-4/</link>
      <pubDate>Wed, 21 Jul 2021 07:07:50 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/articles/office-error-30015-4/</guid>
      <description>Facing weird error on Windows 10? Then this post might help you</description>
      <content:encoded><![CDATA[<p>TL;DR</p>
<p>If your Microsoft Office installation fails with <code>Error Code: 30015-4 (5)</code> or you’re seeing <code>GetLastError:5</code> and strange Wi-Fi issues after using the Microsoft Support and Recovery Assistant (SaRA), it’s probably caused by broken Windows folder permissions.</p>
<p><strong>Fix:</strong></p>
<ol>
<li>Re-enable permission inheritance on affected folders under <code>C:\ProgramData\Microsoft\</code>.</li>
<li>Remove any custom user entries (keep SYSTEM, Administrators, Users).</li>
<li>Reboot and retry the installer.</li>
</ol>
<p>Common folders to check:</p>
<ul>
<li><code>C:\ProgramData\Microsoft\OFFICE</code></li>
<li><code>C:\ProgramData\Microsoft\Windows</code></li>
<li><code>C:\ProgramData\Microsoft\Wlansvc</code></li>
</ul>
<p>Symptoms this resolves:</p>
<ul>
<li>Office install error <strong>30015-4 (5)</strong></li>
<li><code>GetLastError:5</code> during app install/uninstall</li>
<li>Wi-Fi forgetting passwords or crashing with stack-based buffer error</li>
<li>Missing &ldquo;Forget&rdquo; / &ldquo;Properties&rdquo; options in Wi-Fi menu</li>
</ul>
<hr>
<p>Yesterday, what started as a simple plan to upgrade Microsoft Office and clean up unused Chocolatey packages turned into a full-blown Windows permissions disaster.</p>
<p>While reinstalling Office, I ran into this error  <code>Error Code: 30015-4 (5)</code> , from there it escalated quickly to more error messages. At that time, I couldn’t install or uninstall any program that used Windows Installer, and even my Wi-Fi not functioning like how it was supposed to.</p>
<p>This post documents how I identified the root cause, which is corrupted system permissions, that was likely caused by Microsoft’s <strong>SaRA (Support and Recovery Assistant)</strong> tool and how I fixed everything by manually restoring folder permission inheritance.</p>
<h2 id="the-problems">The Problems</h2>
<h3 id="office-installation-failed">Office Installation Failed</h3>
<p>The trouble started when Office refused to install and threw this message:  <code>Error Code: 30015-4(5)</code>.</p>
<p><div class="img-container"><img src="imgs/image-20210721040950497.png" alt="image-20210721040950497"  title="Error Code: 30015-4 (5)"  /></div>
</p>
<p>Clicking on the online help led me to <a href="https://support.microsoft.com/en-us/office/fix-office-installation-errors-d5df89a9-0507-4b4c-92f9-22f457e630aa?ns=ocsac2rinstall&amp;version=16&amp;syslcid=1033&amp;uilcid=1033&amp;appver=cin160&amp;helpid=%225-4-30015%22&amp;ui=en-us&amp;rs=en-us&amp;ad=us"target="_blank" rel="noopener noreferrer"
>this page</a>, where it offers an &ldquo;easy fix&rdquo; tool, which turns out only to make thing worse.</p>
<p><div class="img-container"><img src="imgs/image-20210721041358098.png" alt="image-20210721041358098"  title="An easy fix tool that resulted in another chaos"  /></div>
</p>
<p>The tool running successfully, but the same error persisted. At this point, I couldn&rsquo;t install or uninstall any applications wrapped with Windows Installer (<code>.msi</code>) anymore. The problem then escalated to unrelated installers like Node.js or Visual Studio’s Windows SDK.</p>
<p><div class="img-container"><img src="./imgs/image-20210718024015408.png" alt="image-20210718024015408"  /></div>
</p>
<h3 id="side-effects-wifi-gone-weird">Side Effects: WiFi Gone Weird</h3>
<p>Strangely, my WiFi started acting up:</p>
<ol>
<li>It stopped saving Wi-Fi profiles, so I had to re-enter passwords every time.</li>
<li>Auto-connect and mobile hotspot features stopped working.</li>
<li>The <em>Forget</em> and <em>Properties</em> options disappeared when right-clicking a network.</li>
<li>And most bizarre was a <strong>stack-based buffer overrun</strong> error appeared when opening Wi-Fi settings.</li>
</ol>
<p>Right-clicking a connected Wi-Fi network triggered the stack-based buffer overrun.</p>
<p><div class="img-container"><img src="imgs/image-20210721050915867.png" alt="image-20210721050915867"  title="Stack-based buffer error"  /></div>
</p>
<p>And as you can see below, the “Forget” and “Properties” options were gone completely.</p>
<p><div class="img-container"><img src="imgs/image-20210721054401662.png" alt="image-20210721054401662"  title="Missing the Forget and the Properties options"  /></div>
</p>
<p>At this point, it was clear this wasn’t just an Office issue anymore, my Windows system were messed up.</p>
<h3 id="identifying-root-cause">Identifying Root Cause</h3>
<p>Searching for <code>Error Code: 30015-4 (5)</code> on Microsoft’s support site didn’t help much. So I looked into the <a href="https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-"target="_blank" rel="noopener noreferrer"
>windows system error codes</a> list and found that <code>(5)</code> corresponds to:</p>
<p><div class="img-container"><img src="imgs/image-20210721043547662.png" alt="image-20210721043547662"  /></div>
</p>
<p>That confirmed it was clear that these problems were related to the system permissions.</p>
<p>I started to investigate the folder where all application data is stored/created.</p>
<ul>
<li><code>C:\Program Files\</code></li>
<li><code>C:\Program Files (x86)\</code></li>
<li><code>C:\ProgramData</code></li>
</ul>
<p>While investigating all the folders under <code>C:\ProgramData\</code> and <code>C:\ProgramData\Microsoft</code>, I noticed that some of the folders only had my user account listed in their security properties.</p>
<p><div class="img-container"><img src="imgs/image-20210721044802348.png" alt="image-20210721044802348"  title="Bad Permissions on Office folder"  /></div>
</p>
<p>Normally, the folder permissions under <code>C:\ProgramData</code> should be configured similar to the image below (taken from VirtualBox folder).</p>
<p><div class="img-container"><img src="imgs/image-20210721045334784.png" alt="image-20210721045334784"  title="Good Permissions: Basic"  /></div>
</p>
<p>With advanced permissions configured like this:</p>
<p><div class="img-container"><img src="imgs/image-20210721045624596.png" alt="image-20210721045624596"  title="Good Permissions: Advanced Settings"  /></div>
</p>
<p>Now that I knew what proper permissions looked like, I could start fixing the broken ones.</p>
<h2 id="fixing-permissions">Fixing Permissions</h2>
<h3 id="office-installation-error-code-30015-4-5">Office Installation Error Code: 30015-4 (5)</h3>
<p>To fix this, I restored proper inheritance on the <strong>Office data folder</strong>:</p>
<p>Path:</p>
<pre tabindex="0"><code class="language-PATH:" data-lang="PATH:">C:\ProgramData\Microsoft\OFFICE
</code></pre><p>Fix steps</p>
<ol>
<li>Right-click the folder → <em>Properties</em> → <em>Security</em> → <em>Advanced</em></li>
<li>Remove any explicit entries for your user account (keep SYSTEM, Administrators, Users).</li>
<li>Enable Inheritance  (This allows the <code>OFFICE</code> folder to inherit permissions from its parent <code>Microsoft</code> folder).</li>
</ol>
<p><div class="img-container"><img src="imgs/image-20210721051824838.png" alt="image-20210721051824838"  title="Fix Office Error Code: 30015-4(5)"  /></div>
</p>
<p>If you&rsquo;re not sure about this, do check the other folders&rsquo; permissions under the same parent folder. Using this case, then the parent folder is <code>C:\ProgramData\Microsoft\</code>,  and the child are any folders under <code>C:\ProgramData\Microsoft\[child]</code>.</p>
<p>After applying these changes, I retried the Office installer and it finally worked.</p>
<p><div class="img-container"><img src="imgs/image-20210721053920106.png" alt="image-20210721053920106"  /></div>
</p>
<h3 id="getlasterror5">GetLastError:5</h3>
<p>Next, I encountered the following error message from chocolatey and node.js:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">C:<span class="se">\P</span>rogramData<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\S</span>tart Menu<span class="se">\P</span>rograms GetLastError: <span class="m">5</span>
</span></span></code></pre></div><p>Any <code>GetLastError:5</code>, can be resolved using the same method as above, by enabling the inheritance to the affected application folder.</p>
<p>To trace the problem:</p>
<ol>
<li>Check the permissions of each parent folder in sequence:
<ul>
<li><code>C:\ProgramData\Microsoft</code></li>
<li><code>C:\ProgramData\Microsoft\Windows</code></li>
<li><code>C:\ProgramData\Microsoft\Windows\Start Menu</code></li>
<li><code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs</code></li>
</ul>
</li>
<li>Identify where inheritance was broken.</li>
<li>Reenable it, starting from the topmost broken folder.</li>
</ol>
<p>In my case, the <code>Windows</code> folder had lost its inherited permissions, so I restored it first by enable the inheritance  (See &ldquo;Inherited from&rdquo; column).</p>
<p><div class="img-container"><img src="imgs/image-20210721114505028.png" alt="image-20210721114505028"  /></div>
</p>
<p>And then, I will revert the <code>Start Menu</code> folder permissions to default, see image below.</p>
<p><div class="img-container"><img src="imgs/image-20210721114911619.png" alt="image-20210721114911619"  /></div>
</p>
<p>Finally inherit the <code>Start Menu</code> folder permissions to the <code>Programs</code> folder.</p>
<p><div class="img-container"><img src="imgs/image-20210721115022365.png" alt="image-20210721115022365"  /></div>
</p>
<p>If you’re unsure what the default permissions should be, try install a clean Windows VM and compare them, it’s much safer than guessing.</p>
<h3 id="stack-based-and-wifi-error">Stack-based and WiFi error</h3>
<p>If you’re seeing any of these symptoms:</p>
<ul>
<li>SystemSettings.exe – System Error (stack overrun message)</li>
<li>Windows forgets Wi-Fi networks or passwords</li>
<li>Missing <em>Forget</em> and <em>Properties</em> options in Wi-Fi menu</li>
<li>Mobile hotspot won’t start</li>
</ul>
<p>Then the culprit is probably the WLAN service profile folder. In Windows, all Wi-Fi profiles are stored in</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">C:\ProgramData\Microsoft\Wlansvc\Profiles
</span></span></code></pre></div><p>If the system doesn’t have write access, it can’t save or load them correctly.</p>
<p>The fix steps are the same:</p>
<ol>
<li>Right-click <code>Wlansvc</code> folder &gt; <em>Properties</em> &gt; <em>Security</em> &gt; <em>Advanced</em></li>
<li>Remove any users account available</li>
<li>Enable <em>inheritance</em>, so permissions flow down from <code>Microsoft</code></li>
<li>Apply and restart Windows</li>
</ol>
<p><div class="img-container"><img src="imgs/image-20210721055011183.png" alt="image-20210721055011183"  /></div>
</p>
<p>After that, everything worked again:</p>
<ul>
<li>Wi-Fi remembered passwords</li>
<li>Auto-connect and hotspot worked</li>
<li>No more stack-based buffer error</li>
<li>It also fixed the missing options and auto-connect.</li>
</ul>
<p><div class="img-container"><img src="imgs/image-20210721055107535.png" alt="image-20210721055107535"  /></div>
</p>
<h2 id="lesson-learned">Lesson Learned</h2>
<ul>
<li>Permission issues can cause <em>weird</em> system behavior, even unrelated things like Wi-Fi and installer errors.</li>
<li>Always check folder inheritance settings before running automated repair tools.</li>
<li>Use a virtual machine to inspect clean Windows defaults, it’s a great reference for fixing broken permissions.</li>
<li>Tools like Microsoft SaRA can help in many cases, but sometimes they might overfix things.</li>
</ul>
<h2 id="end">End</h2>
<p>In the end, restoring folder inheritance fixed all my issues, from Office installation errors to Wi-Fi crashes. All that chaos just because I wanted to reinstall Office, nut at least now I understand Windows permissions better than ever.</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
