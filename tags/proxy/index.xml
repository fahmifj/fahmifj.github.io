<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Proxy on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/proxy/</link>
    <description>Recent content in Proxy on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Thu, 04 Nov 2021 16:40:44 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/proxy/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Bypass Blokir ISP: DoH, Hosts File, dan SSH Socks Proxy</title>
      <link>https://fahmifj.github.io/articles/bypass-blokir-isp-tanpa-vpn/</link>
      <pubDate>Thu, 04 Nov 2021 16:40:44 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/articles/bypass-blokir-isp-tanpa-vpn/</guid>
      <description>Finding ways around digital roadblocks with DoH, hosts file, and SSH Socks Proxy</description>
      <content:encoded><![CDATA[<p>Banyak teman gw pernah ngeluh karena gak bisa buka situs tertentu seperti Reddit atau beberapa situs streaming anime. Umumnya sih karena situs-situs itu diblokir oleh ISP. Solusi mereka saat itu tentu saja pakai VPN. Tapi, sayangnya muncul masalah lain, yaitu kecepatan internet yang langsung turun drastis, apalagi kalau VPN yang digunakan ini gratisan alias dipakai berjamaah.</p>
<p>Nah sebenernya ada solusi lain yang lebih mudah dan murah, yaitu mengaktifkan fitur <a href="https://developers.cloudflare.com/1.1.1.1/encrypted-dns"target="_blank" rel="noopener noreferrer"
>DNS over HTTPS (DoH)</a> di browser. Beberapa browser populer (Chrome, Firefox, Edge, dll.) udah punya fitur ini. Meskipun begitu, ternyata masih banyak orang yang belum tahu tentang adanya fitur ini.</p>
<figure>
    <img src="imgs/image-20211104224726768.png"
         alt="Settingan DoH pada Chrome dan Firefox"/> <figcaption>
            <p>Settingan DoH pada Chrome dan Firefox
            </p>
        </figcaption>
</figure>

<p>Setelah teman gw tahu, salah satunya memberi respon berikut.</p>
<figure>
    <img src="imgs/image-20211103210137432.png"
         alt="Sebuah testimoni"/> <figcaption>
            <p>Sebuah testimoni
            </p>
        </figcaption>
</figure>

<p>Dengan mengaktifkan fitur DoH, hampir semua situs yang diblokir oleh ISP bisa dibuka kembali, loh.</p>
<p>Tapi kok bisa, ya?</p>
<h2 id="how-do-isps-block-websites">How do ISPs block websites?</h2>
<h3 id="dns-request-flow">DNS Request Flow</h3>
<p>Pertama-tama, kita perlu tahu dulu alur tentang bagaimana sebuah website itu bisa terbuka oleh browser kita.</p>
<p>Ketika kita mengakses sebuah situs seperti <code>www.reddit.com</code>, komputer akan mengirimkan sebuah <a href="https://www.cloudns.net/wiki/article/254/"target="_blank" rel="noopener noreferrer"
>kueri DNS</a> ke server DNS (DNS resolver). Server DNS ini simplenya berisi informasi/mapping nama-nama domain dan menerjemahkannya ke alamat IP. Sehingga setelah kueri tersebut diterima, nantinya <code>www.reddit.com</code> diterjemahkan ke alamat IP agar laman situs tersebut bisa dimuat kemudian.</p>
<p>Secara default, kueri tersebut akan sampai ke server DNS milik penyedia jasa internet (ISP) atau operator seluler yang kita pakai. Jadi setiap kali kita browsing, ISP tahu kita sedang mengakses situs apa.</p>
<img src="./imgs/image-20250128220902286.png" alt="image-20250128220902286" style="zoom:50%;" />
<h3 id="dns-filtering--dns-hijacking">DNS Filtering / DNS Hijacking</h3>
<p>Jika domain yang kamu buka masuk daftar blokir, server DNS ISP akan <strong>mengganti hasil kueri DNS</strong> kamu menjadi alamat IP halaman blokir (seperti “Internet Positif” atau “Kominfo SafeNet”). Metode yang digunakan ISP ini lebih dikenal dengan sebutan <a href="https://en.wikipedia.org/wiki/DNS_hijacking"target="_blank" rel="noopener noreferrer"
>DNS hijack/poisoning</a>.</p>
<p>Contohnya seperti dibawah ini:</p>
<ul>
<li>Gw coba akses situs <code>www.reddit.com</code></li>
<li>DNS ISP “menjawab” dengan IP <code>36.86.63.185</code> (<code>internetpositif.id</code>)</li>
<li>Browser akhirnya buka halaman blokir, bukan Reddit</li>
</ul>
<img src="./imgs//image-20241226140545496.png" alt="image-20241226140545496" style="zoom:50%;" />
<p>Kita bisa melihat hasil <em>hijack</em> oleh server DNS ISP untuk <code>www.reddit.com</code> menggunakan Wireshark. Dari hasil inspeksi, kueri DNS untuk <code>www.reddit.com</code> telah diarahkan ke <code>internetpositif.id</code> yang beralamat di <code>36.86.63.185</code>.</p>
<p>Padahal kalau kita cek lagi secara external seperti <a href="https://toolbox.googleapps.com/apps/dig/#A/"target="_blank" rel="noopener noreferrer"
>Dig Google</a> atau <a href="https://digwebinterface.com/?hostnames=www.reddit.com&amp;type=&amp;ns=resolver&amp;useresolver=9.9.9.10&amp;nameservers="target="_blank" rel="noopener noreferrer"
>Dig Web Interface</a>, ternyata  alamat IP dari <code>www.reddit.com</code> menurut Google adalah <code>151.101.X.140</code>, bukan <code>36.86.63.185</code>.</p>
<figure>
    <img src="imgs/image-20211104095424598.png"
         alt="Hasil dig situs reddit"/> <figcaption>
            <p>Hasil dig situs reddit
            </p>
        </figcaption>
</figure>

<p>Alur pemblokiran website ini bisa diilustrasikan sebagai berikut.</p>
<figure>
    <img src="imgs/image-20211103163418666.png"
         alt="Ilustrasi(nya)"/> <figcaption>
            <p>Ilustrasi(nya)
            </p>
        </figcaption>
</figure>

<h3 id="whats-the-point-of-https">What&rsquo;s the point of HTTPS?</h3>
<p>Kueri DNS itu dikirimkan <strong>sebelum trafik/handshake HTTPS</strong> terjadi dan isi kuerinya tidak terenkripsi alias plain text. Sehingga ISP dapat membaca dan mengubah isi kuerinya. Selanjutnya, penggunaan HTTPS ini hanya mengenkripsi bagian data atau kontennya saja<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, bukan nama domain yang kamu akses.</p>
<p>Saat kita mengunjungi sebuah situs, ISP hanya dapat melihat nama domain dan alamat IP dari situs tersebut. Informasi seperti username, password, dan bahkan URL endpoint/path beserta kuerynya tidak dapat diketahui oleh ISP.</p>
<p>Contoh, jika URL-nya adalah:</p>
<ul>
<li><code>https://website.com/api/v1/login?username=admin&amp;password=admin</code></li>
</ul>
<p>Maka, yang terlihat oleh ISP saat paket data kita transit di server/router mereka hanyalah nama domain, yaitu: <code>website.com</code>, sedangkan datanya akan terenkripsi seperti berikut.</p>
<figure>
    <img src="imgs/image-20211104092043412.png"
         alt="Contoh konten yang dienkripsi"/> <figcaption>
            <p>Contoh konten yang dienkripsi
            </p>
        </figcaption>
</figure>

<h2 id="thou-shalt-bypass">Thou Shalt (By)Pass</h2>
<h3 id="dns-over-https-doh">DNS over HTTPS (DoH)</h3>
<p>Dengan DoH, kueri DNS tadi ikut <strong>&ldquo;dibungkus&rdquo;</strong> dalam HTTPS sebagai bagian dari konten aplikasi yang dikirim ke <em>endpoint</em> DoH, misalnya <code>https://cloudflare-dns.com/dns-query</code>. Karena sekarang kuerinya ini ikut terenkripsi di dalam HTTPS, ISP jadi tidak bisa lagi membongkar dan mengubah isi dari kueri DNS kamu.</p>
<p>Namun, ISP <strong>masih bisa tahu</strong> kamu terhubung ke DoH providernya (<code>cloudflare-dns.com</code> atau IP <code>1.1.1.1</code>). Tapi mereka <strong>tidak tahu</strong> situs apa yang sedang kamu resolve di dalamnya. Sehingga komputer kita terhindar dari &ldquo;penipuan&rdquo; alamat yang dilakukan server DNS ISP pada kasus <code>reddit.com</code> di atas.</p>
<blockquote>
<p>Notes:</p>
<p>Meski DoH menyembunyikan isi DNS, nama domain yang kamu kunjungi masih bisa terlihat lewat <strong>SNI (Server Name Indication)</strong> saat TLS handshake.</p>
<p>Fitur baru bernama <strong>Encrypted Client Hello (ECH)</strong> bisa menyembunyikan ini, tapi belum semua browser dan server mendukungnya.</p>
</blockquote>
<h3 id="hosts-file-the-primivite-dns">Hosts file: The Primivite DNS</h3>
<p>Sebenarnya, tanpa DoH, kita bisa menghindari &ldquo;penipuan&rdquo; alamat IP tadi di level <em>cache</em>, alias melakukan bypass dengan cara yang mirip dengan tekniknya ISP untuk memblokir situs web.</p>
<p>Komputer akan menyimpan alamat dari hasil kueri DNS pada proses sebelumnya di <a href="https://www.cloudns.net/blog/dns-cache-explained/"target="_blank" rel="noopener noreferrer"
>cache</a>. Di request berikutnya nanti, komputer akan mengandalkan entri alamat yang ada pada <em>cache</em>, selama entri tersebut belum kadaluarsa (umumnya 24 jam).</p>
<p>Pada Windows, kita bisa melihat daftar IP dan nama domain yang sudah di <em>cache</em> dengan menjalankan perintah berikut.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">C:<span class="se">\&gt;</span>ipconfig /displaydns
</span></span></code></pre></div><p>Informasi nama-nama domain pada server DNS milik ISP akan selalu up-to-date secara periodik alias bersifat dinamis. Nah, di sistem operasi sendiri, terdapat sebuah file yang merupakan bagian dari sistem DNS, namun bersifat statis, yaitu file <code>hosts</code>.</p>
<ul>
<li>Lokasi di Windows: <code>C:\Windows\System32\drivers\etc\hosts</code></li>
<li>Lokasi di Linux/macOS: <code>/etc/hosts</code></li>
</ul>
<figure>
    <img src="imgs/image-20211104123812239.png"
         alt="Windows hosts file"/> <figcaption>
            <p>Windows hosts file
            </p>
        </figcaption>
</figure>

<p>Isi dari file <code>hosts</code> ini akan selalu masuk ke dalam entri <em>cache</em> dari DNS. Maka dari itu, kita bisa memanfaatkan hal ini untuk memberi tahu komputer secara langsung (<em>bypass</em>) alamat IP dari sebuah situs.</p>
<p>Contoh:</p>
<p>Misalnya <code>www.reddit.com</code> dengan <code>151.101.129.140</code>. Kita tinggal menambahkan DNS entri ke dalam file <code>hosts</code> dengan format berikut.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># [Alamat IP] [domain name 1] [domain name 2] [domain name N]
</span></span><span class="line"><span class="cl">151.101.129.140 reddit.com www.reddit.com
</span></span></code></pre></div><p>Sekarang kita bisa jalankan kembali perintah yang sama untuk menampilkan DNS cache, tapi sebelum itu ada baiknya DNS cache ini di-<em>flush</em> terlebih dulu.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">C:<span class="se">\&gt;</span>ipconfig /flushdns <span class="c1"># clear cache dulu untuk menghilangkan &#34;brainwash&#34; dari Server DNS ISP</span>
</span></span><span class="line"><span class="cl">C:<span class="se">\&gt;</span>ipconfig /displaydns
</span></span></code></pre></div><p>Seharusnya saat ini <code>www.reddit.com</code> dan <code>reddit.com</code> berada di entry paling atas.</p>
<p>Karena si komputer sudah tahu alamat IP dari <code>www.reddit.com</code>, maka dia tidak perlu lagi &ldquo;bertanya&rdquo; ke server DNS milik ISP.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ tracert -d www.reddit.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Tracing route to reddit.com <span class="o">[</span>151.101.129.140<span class="o">]</span>
</span></span><span class="line"><span class="cl">over a maximum of <span class="m">30</span> hops:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="m">1</span>   <span class="m">120</span> ms     <span class="m">2</span> ms     <span class="m">3</span> ms  192.168.43.1
</span></span><span class="line"><span class="cl">  <span class="m">2</span>     *        *        *     Request timed out.
</span></span><span class="line"><span class="cl">  <span class="m">3</span>   <span class="m">162</span> ms    <span class="m">26</span> ms    <span class="m">26</span> ms  10.***.44.2
</span></span><span class="line"><span class="cl">  <span class="m">4</span>   <span class="m">160</span> ms    <span class="m">25</span> ms    <span class="m">30</span> ms  ***.215.36.238 
</span></span><span class="line"><span class="cl">  <span class="m">5</span>   <span class="m">187</span> ms    <span class="m">46</span> ms    <span class="m">46</span> ms  180.87.12.233
</span></span><span class="line"><span class="cl">  <span class="m">6</span>   <span class="m">186</span> ms    <span class="m">57</span> ms    <span class="m">50</span> ms  180.87.12.232
</span></span><span class="line"><span class="cl">  <span class="m">7</span>   <span class="m">191</span> ms    <span class="m">49</span> ms    <span class="m">47</span> ms  180.87.12.250
</span></span><span class="line"><span class="cl">  <span class="m">8</span>    <span class="m">49</span> ms    <span class="m">49</span> ms    <span class="m">48</span> ms  210.57.30.38
</span></span><span class="line"><span class="cl">  <span class="m">9</span>   <span class="m">188</span> ms    <span class="m">53</span> ms    <span class="m">52</span> ms  202.84.219.174
</span></span><span class="line"><span class="cl"> <span class="m">10</span>    <span class="m">70</span> ms    <span class="m">49</span> ms    <span class="m">52</span> ms  202.84.219.174
</span></span><span class="line"><span class="cl"> <span class="m">11</span>    <span class="m">60</span> ms    <span class="m">54</span> ms    <span class="m">49</span> ms  202.84.224.197
</span></span><span class="line"><span class="cl"> <span class="m">12</span>    <span class="m">83</span> ms    <span class="m">80</span> ms    <span class="m">85</span> ms  210.57.38.171
</span></span><span class="line"><span class="cl"> <span class="m">13</span>   <span class="m">205</span> ms   <span class="m">200</span> ms   <span class="m">203</span> ms  151.101.129.140 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Trace complete.
</span></span></code></pre></div><p>Tekniknya bisa diilustrasikan seperti berikut.</p>
<img src="./imgs/image-20250128224915710.png" alt="image-20250128224915710" style="zoom:50%;" />
<p><em><strong>Kalau untuk situs lain gimana?</strong></em></p>
<p>Caranya, kamu bisa <em>resolve</em> dulu IPnya menggunakan tool dig DNS, misalnya dengan dig milik Google.</p>
<img src="imgs/image-20211104142819468.png" alt="image-20211104142819468" style="zoom: 50%;" />
<p>Lalu tambahkan hasil record yang di dapat ke dalam <code>hosts</code> file:</p>
<img src="imgs/image-20211104142858365.png" alt="image-20211104142858365" style="zoom:50%;" />
<blockquote>
<p>Notes:</p>
<ul>
<li>Perlu akses Administrator/root untuk membuka dan mengedit  file <code>hosts</code>.</li>
<li>Beberapa situs sangat mungkin memiliki lebih dari satu IP (misal CDN) untuk high-availability/load-balance. Jadi menambahkan satu IP di dalam file hosts mungkin bisa menyebabkan situs gagal dimuat karena alamat tersebut sedang dialihkan atau down.</li>
</ul>
</blockquote>
<h3 id="ssh-socks-proxy">SSH SOCKS Proxy</h3>
<p>Untuk solusi bypass yang lebih bersifat pribadi adalah menggunakan <em>Virtual Private Server</em> (VPS) dan memanfaatkan fitur SOCKS <a href="https://en.wikipedia.org/wiki/Proxy_server"target="_blank" rel="noopener noreferrer"
>proxy</a> bawaan OpenSSH. VPS ini bisa kalian beli atau deploy sendiri di platform cloud seperti Azure/GCP/AWS.</p>
<p>Untuk memanfaatkan proxy SOCKS dari SSH, perintahnya cukup simple:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh user@vps-ip -D <span class="m">1080</span> -N
</span></span></code></pre></div><ul>
<li><code>-D 1080</code>: Buka SOCKS proxy di port 1080</li>
<li><code>-N</code>: Tanpa interactive shell.</li>
</ul>
<p>Saat ini proxy SOCKS sudah tersedia pada local interface,  <code>127.0.0.1:1080</code>. Kita tinggal mengkonfigurasikan browser untuk menggunakan proxy tersebut.</p>
<figure>
    <img src="imgs/image-20211104161049841.png"
         alt="Firefox proxy settings"/> <figcaption>
            <p>Firefox proxy settings
            </p>
        </figcaption>
</figure>

<p>Untuk memudahkan proses switching proxy-unproxy, kita bisa pakai ekstensi seperti <a href="https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/"target="_blank" rel="noopener noreferrer"
>FoxyProxy</a>. Berikut tampilannya.</p>
<figure>
    <img src="imgs/image-20211104160902204.png"
         alt="FoxyProxy Toogle"/> <figcaption>
            <p>FoxyProxy Toogle
            </p>
        </figcaption>
</figure>

<p>Konfigurasinya? sama dengan settingan browser tadi!</p>
<figure>
    <img src="imgs/image-20211104090204141.png"
         alt="Konfigurasi SOCKS Proxy di Foxy Proxy"/> <figcaption>
            <p>Konfigurasi SOCKS Proxy di Foxy Proxy
            </p>
        </figcaption>
</figure>

<p>Untuk mengecek apakah proxy tersebut berjalan, cukup kunjungi situs: <code>ifconfig.co/json</code>. Sebagai contoh, hasil berikut menunjukkan IP publik gw sekarang adalah IP publik si VPS dan terdeteksi berada di US.</p>
<figure>
    <img src="imgs/image-20211104090145368.png"
         alt="Akses ifconfig.co dengan proxy"/> <figcaption>
            <p>Akses ifconfig.co dengan proxy
            </p>
        </figcaption>
</figure>

<p>Sampai sini ISP hanya bisa lihat gw terhubung dengan ke VPS tapi tidak dengan domain dan kontennya, seperti berikut.</p>
<figure>
    <img src="imgs/image-20211104152555436.png"
         alt="Web trafic yang terenkripsi melalui SSH tunnel"/> <figcaption>
            <p>Web trafic yang terenkripsi melalui SSH tunnel
            </p>
        </figcaption>
</figure>

<h2 id="conclusion">Conclusion</h2>
<p>Selain menggunakan VPN, setidaknya ada 3 metode yang bisa kamu coba untuk melakukan bypass web filter yang diterapkan oleh ISP langganan kamu,:</p>
<ul>
<li>Hosts file,</li>
<li>DoH,</li>
<li>SSH SOCKS Proxy.</li>
</ul>
<p>Perbandingan singkatnya seperti berikut:</p>
<table>
<thead>
<tr>
<th>Metode</th>
<th>Bypass Web filters</th>
<th>Hide the domain we visit from ISP?</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hosts file</td>
<td>Probably yes</td>
<td>No</td>
<td>Fast, simple, offline</td>
<td>Statis, hard to manage</td>
</tr>
<tr>
<td>DoH</td>
<td>Yes, mostly</td>
<td>No</td>
<td>Fast, easy</td>
<td>So far none,</td>
</tr>
<tr>
<td>SSH SOCKS Proxy (VPS)</td>
<td>Yes, mostly, but it depends.</td>
<td>Yes</td>
<td>More privacy</td>
<td>Paid, Slow (depending on VPS region)</td>
</tr>
</tbody>
</table>
<p><em><strong>Gimana kalau IP DoH resolvernya diblokir ISP/Kom*nfo?</strong></em></p>
<p>Kembali ke VPN/VPS deh. Hahaha.</p>
<p>Tapi sejauh ini sepertinya teknik blokir situs yang dipakai Kom*nfo dan ISP hanya sebatas di DNS hijack/redirection. Karena jika yang diblokir sudah sampai IP penyedia layanan seperti Google dan Cloudflare, besar kemungkinan akan terjadi efek domino, entah down atau semacamnya.</p>
<p>Ya, jadi gak perlu khawatir deh!</p>
<blockquote>
<p>Karena sudah kejadian di 2024. Lol.</p>
</blockquote>
<p><em><strong>Apakah dengan ini gw sudah bisa menjadi <del>bjoorka</del> anonymous user?</strong></em></p>
<p>Nope, kamu <strong>tidak 100% anonim</strong>. Server tempat kamu tunneling (VPS atau VPN) tetap bisa melihat data kamu dan mereka lebih besar dari pada sekadar ISP dan dua-duanya mengumpulkan data juga. Jadi selalu gunakan dengan bijak.</p>
<p>Baiklah, sekian untuk postingan ini semoga bermanfaat. See you in the next post.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://https.cio.gov/faq/#what-does-https-do"target="_blank" rel="noopener noreferrer"
>https://https.cio.gov/faq/#what-does-https-do</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
