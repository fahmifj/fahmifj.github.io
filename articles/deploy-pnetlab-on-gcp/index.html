<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>Deploying PNETLab on Google Cloud | Ef's log</title><meta name=keywords content="GCP Ideas,GCP Lab,GCP Terraform,PNETLab GCP"><meta name=description content="In the previous article, I had an issue with either Mac or Orbstack’s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.
In this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/articles/deploy-pnetlab-on-gcp/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.e493735ea2dbe7c590720cf86f9a56dd105617dd7ee16d7b03eec85ae4fa32ca.css integrity="sha256-5JNzXqLb58WQcgz4b5pW3RBWF91+4W17A+7IWuT6Mso=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.d0c69d770710ed56c32d9dd1c517c99ba940dc26d1d8fba5ed029e276155d123.js integrity="sha256-0MaddwcQ7VbDLZ3RxRfJm6lA3CbR2Pul7QKeJ2FV0SM="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0="></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.111.2"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="Deploying PNETLab on Google Cloud"><meta property="og:description" content="In the previous article, I had an issue with either Mac or Orbstack&rsquo;s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.
In this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/articles/deploy-pnetlab-on-gcp/"><meta property="article:section" content="articles"><meta property="article:published_time" content="2025-03-26T13:27:29+07:00"><meta property="article:modified_time" content="2025-11-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying PNETLab on Google Cloud"><meta name=twitter:description content="In the previous article, I had an issue with either Mac or Orbstack&rsquo;s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.
In this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Articles","item":"https://fahmifj.github.io/articles/"},{"@type":"ListItem","position":2,"name":"Deploying PNETLab on Google Cloud","item":"https://fahmifj.github.io/articles/deploy-pnetlab-on-gcp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying PNETLab on Google Cloud","name":"Deploying PNETLab on Google Cloud","description":"In the previous article, I had an issue with either Mac or Orbstack\u0026rsquo;s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.\nIn this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet.","keywords":["GCP Ideas","GCP Lab","GCP Terraform","PNETLab GCP"],"articleBody":"In the previous article, I had an issue with either Mac or Orbstack’s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.\nIn this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet.\nGoals\nAutomate PNETLab server deployment with Terraform. Secure access to the lab without exposing it to the public internet. Configure a domain for easy access to the lab. Prerequisites\nGCP \u0026 Twingate accounts. GCP CLI installed. Terraform installed. Own a domain name (optional). Network Diagram Overview\nHere’s an overview of what we’re going to build:\nPrepare the GCP Project Create a Project Before we begin, make sure that you’ve authenticated to GCP. Once done, create a project for our PNETLab deployment.\n$ PROJECT_ID=pnetlab-$RANDOM $ echo $PROJECT_ID pnetlab-xxx $ mkdir $PROJECT_ID $ cd $PROJECT_ID $ gcloud projects create $PROJECT_ID $ gcloud config set project $PROJECT_ID Then, link the project to your billing account.\n$ gcloud billing accounts list ACCOUNT_ID NAME OPEN MASTER_ACCOUNT_ID AAAAAA-BBBBBB-CCCCCC My Billing Account True $ gcloud billing projects link $PROJECT_ID --billing-account=AAAAAA-BBBBBB-CCCCCC Enable the Compute API Before you can use Google Cloud’s compute resources, we need to enable the Compute API which allows your project to access and manage VM instances.\n$ gcloud services enable compute.googleapis.com Note: I’m using GCP’s free trial credits for this setup, if you’re on a paid account, the steps remain the same.\nInstance Deployment Preparing Terraform Code We’ll use the following folder structure.\n$ tree . ├── README.MD └── terraform ├── terraforms.tfvars # sensitive informations goes here (project_id, region, user/keys) ├── main.tf # defined gcp resources └── variables.tf 1 directories, 4 files Within the terraform folder, initialize the terraform working directory.\n$ terraform init terraform.tfvars terraforms.tfvars contains the following (make your adjustment):\nproject_id = \"\" region = \"\" zone = \"\" os_image = \"projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20240116a\" ssh_user = \"username\" ssh_pub_user = \"ssh-ed25519 AAAAC3N... root\" ssh_pub_ansible = \"ssh-ed25519 AAAAC3N... ansible\" main.tf main.tf file contains the following:\nterraform { required_providers { google = { source = \"hashicorp/google\" version = \"~\u003e 4.5\" } } } provider \"google\" { project = var.project_id region = var.region zone = var.zone } # SETUP NETWORK # resource \"google_compute_network\" \"pnetlab_vpc\" { name = \"pnetlab-vpc\" auto_create_subnetworks = false } resource \"google_compute_subnetwork\" \"pnetlab_subnet\" { name = \"pnetlab-subnet\" network = google_compute_network.pnetlab_vpc.id ip_cidr_range = \"10.10.1.0/24\" } resource \"google_compute_firewall\" \"allow_ssh_access\" { name = \"allow-ssh\" network = google_compute_network.pnetlab_vpc.id allow { protocol = \"tcp\" ports = [\"22\"] } source_ranges = [ \"0.0.0.0/0\" ] } # NAT resource \"google_compute_router\" \"pnetlab_router\" { name = \"pnetlab-router\" region = var.region network = google_compute_network.pnetlab_vpc.id } resource \"google_compute_router_nat\" \"pnetlab_router_nat\" { name = \"pnetlab-router-nat\" region = var.region router = google_compute_router.pnetlab_router.name nat_ip_allocate_option = \"AUTO_ONLY\" # use dynamic public ip for nat source_subnetwork_ip_ranges_to_nat = \"ALL_SUBNETWORKS_ALL_IP_RANGES\" # nat any sources ip range available within the vpc } # SETUP EXT DISK # resource \"google_compute_disk\" \"additional_disk\" { name = \"pnetlab-additional-disk\" type = \"pd-standard\" # Choose disk type (pd-standard, pd-ssd, etc.) size = 100 lifecycle { prevent_destroy = true } } # SETUP INSTANCES # # ubuntu-1804-bionic-v20240116a ubuntu-os-cloud ubuntu-1804-lts resource \"google_compute_instance\" \"pnetlab_server\" { name = \"pnetlab-server\" machine_type = \"n2-standard-2\" tags = [\"pnetlab\"] boot_disk { initialize_params { image = var.os_image # cloud image size = 20 # assign 20gb type = \"pd-standard\" } } # external disk 100gb attached_disk { source = google_compute_disk.additional_disk.id } network_interface { network = google_compute_network.pnetlab_vpc.id subnetwork = google_compute_subnetwork.pnetlab_subnet.id # Disable public IP # access_config { # network_tier = \"STANDARD\" # } } scheduling { automatic_restart = true on_host_maintenance = \"MIGRATE\" preemptible = false provisioning_model = \"STANDARD\" } advanced_machine_features { enable_nested_virtualization = true } metadata = { ssh-keys = \"${var.ssh_user}:${var.ssh_pub_user} \\n${var.ssh_user}:${var.ssh_pub_ansible}\" } } variables.tf variables.tf define the variables we used in the tfvars file, it contains:\nvariable \"project_id\" { type = string description = \"Project ID\" } variable \"region\" { type = string description = \"Project region\" default = \"us-central\" } variable \"zone\" { type = string description = \"Project zone\" default = \"us-central1-a\" } variable \"os_image\" { type = string description = \"OS family\" } variable \"ssh_user\" { type = string description = \"The sudo user\" } variable \"ssh_pub_user\" { type = string description = \"The public key used for authentication to an instance. Format: [public key] [username]\" } variable \"ssh_pub_ansible\" { type = string description = \"The public key used for configuration management. Format: [public key] [username]\" } Run Code With all the resource files defined, we will run the following command in the terraform directory.\n$ terraform fmt # Format your Terraform files $ terraform validate # Check for syntax errors $ terraform plan -out pnetlab-deploy #Preview the infrastructure changes $ terraform apply pnetlab-deploy -auto-approve # Deploy the resources Verify Deployment After it finishes, check if the instance is running:\n$ gcloud compute instances list --filter=\"name=pnetlab-server\" --project=\"$PROJECT_ID\" PNETLab Installation Install PNETLab SSH into the instance using gcloud cli.\n$ gcloud compute ssh INSTANCE_NAME --zone=YOUR_ZONE Add pnetlab repository with the following command.\n$ echo \"deb [trusted=yes] http://repo.pnetlab.com ./\" | sudo tee -a /etc/apt/sources.list Update the repository and install pnetlab.\nroot@pnetlab-server:~# apt-get update root@pnetlab-server:~# apt-get install pnetlab Note: I switched my user to root with $ sudo su -\nConfigure the Instance Swap Create a swap disk, allocate the size according to your need.\nroot@pnetlab-server:~# fallocate -l 1G /swapfile root@pnetlab-server:~# chmod 600 /swapfile root@pnetlab-server:~# mkswap /swapfile root@pnetlab-server:~# swapon /swapfile root@pnetlab-server:~# cp /etc/fstab{,.bak} root@pnetlab-server:~# '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab DNS Edit file /etc/network/interfaces add line dns-nameservers 8.8.8.8 to the configuration of interface pnet0.\n... # The primary network interface iface eth0 inet manual auto pnet0 iface pnet0 inet dhcp dns-nameservers 8.8.8.8 bridge_ports eth0 bridge_stp off ... And restart the networking service.\nroot@pnetlab-server:~# sudo service networking restart Disk Time to add the additional disk we defined in the terraform resource. The purpose of this disk is to store all the pnetlab project files as well as the images later.\nIn my case, the additional disk is available at /dev/sdb.\nroot@pnetlab-server:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7:0 0 40.4M 1 loop /snap/snapd/20671 loop1 7:1 0 368M 1 loop /snap/google-cloud-cli/203 loop2 7:2 0 63.9M 1 loop /snap/core20/2105 sda 8:0 0 20G 0 disk ├─sda1 8:1 0 19.9G 0 part / ├─sda14 8:14 0 4M 0 part └─sda15 8:15 0 106M 0 part /boot/efi sdb 8:16 0 100G 0 disk We’ll create an LVM disk out of it.\nroot@pnetlab-server:~# vgcreate /dev/vg01 /dev/sdb Volume group \"vg01\" successfully created root@pnetlab-server:~# lvcreate -l 100%FREE --name lv01 vg01 Logical volume \"lv01\" created. root@pnetlab-server:~# mkfs.ext4 /dev/vg01/lv01 mke2fs 1.44.1 (24-Mar-2018) Discarding device blocks: done Creating filesystem with 26213376 4k blocks and 6553600 inodes Filesystem UUID: f1173542-f07c-493f-89e6-188439880465 Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000, 7962624, 11239424, 20480000, 23887872 Allocating group tables: done Writing inode tables: done Creating journal (131072 blocks): done Writing superblocks and filesystem accounting information: done Then we set a mount point for the volume we just created.\nroot@pnetlab-server:~# mkdir /mnt/unetlab root@pnetlab-server:~# mount /dev/vg01/lv01 /mnt/unetlab Edit the /etc/fstab file and add the following line to mount /mnt/unetlab on boot:\n/dev/vg01/lv01 /mnt/unetlab ext4 defaults 0 0 Now we’ll create a new directory for PNETLab project files and image files in our newly mounted disk.\nroot@pnetlab-server:~# mkdir /mnt/unetlab/addons root@pnetlab-server:~# mkdir /mnt/unetlab/labs Next, we’ll remove the old directories for project files and image files, and replace them with symbolic links pointing to the new directories on the mounted disk.\nroot@pnetlab-server:~# rm -rf /opt/unetlab/addons/ root@pnetlab-server:~# rm -rf /opt/unetlab/labs/ root@pnetlab-server:~# ln -s /mnt/unetlab/addons/ /opt/unetlab/ root@pnetlab-server:~# ln -s /mnt/unetlab/labs/ /opt/unetlab/ Change ownership of the new labs directory to ensure PNETLab’s services can access it back.\nroot@pnetlab-server:~# chown -R www-data:www-data /mnt/unetlab/labs/ Grub Remove the default grub config.\nroot@pnetlab-server:~# rm /etc/default/grub.d/50-cloudimg-settings.cfg root@pnetlab-server:~# update-grub root@pnetlab-server:~# reboot Restart and Verify Once all the steps above are complete, restart the server and verify if the pnetlab service is running using the following command and check these ports: 80, 443 for pnetlab web services and 4822 for guacamole proxy.\nroot@pnetlab-server:~# netstat -tlpn Update Version (Optional) After the installation completed, we can directly upgrade PNETLab to the latest version. It’s an optional, so I will just put the official guide link on how to upgrade the lab version: go here.\nSetup Tailscale VPN For this step, I will assume that you already generated an auth key in the Tailscale admin console.\nInstall Tailscale First, install Tailscale by executing the install script.\nroot@pnetlab-server:~# curl -fsSL https://tailscale.com/install.sh | sh Configure Subnet Router We will configure the instance as a subnet router, simply turning the server into a router. This will enable direct access between PNETLab appliances network and our local network via the Tailscale network.\nTo achieve that, we first need to enable IP forwarding on the server.\nroot@pnetlab-server:~# echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf root@pnetlab-server:~# echo 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf root@pnetlab-server:~# sudo sysctl -p /etc/sysctl.d/99-tailscale.conf To register your instance as a node in your Tailscale network and enable it to act as a subnet router, run the following command:\nroot@pnetlab-server:~# tailscale up --auth-key=tskey-auth-XXXXX --advertise-route=10.0.10.0/24 Note:\nReplace tskey-auth-XXXXX with your actual auth key and 10.0.10.0/24 with your designated local network on the PNETLAB server:\nThe --advertise-routes=10.0.10.0/24 option tells the instance to advertise the subnet 10.0.10.0/24 to your Tailscale network. Once advertised, other devices in your Tailscale network can route traffic to this subnet through this instance.\nRevisit your Tailscale’s admin console. You should see a Subnets label on the pnetlab node.\nOpen the node settings, select “edit route settings…” and tick your network there.\nVerify Routing To verify, you can simply ping any interface IP of the instance that you have advertised. The image below is an example of mine, where I’m pinging the Docker interface.\nConfigure Domain Name We can use a custom domain name to access PNETLab. To do so, we will obtain a LetsEncrypt’s certificate to replace the self-signed one and then configure a new DNS record: pnetlab.yourdomain.com. This record will be pointing to Tailscale IP of our instance.\nFor this step, I will assume that you already own a domain and know how to complete an ACME DNS challenge (proving control over a domain).\nObtain LetsEncrypt SSL Within the instance, install certbot and prepare the work folder.\nroot@pnetlab-server:~# sudo apt install -y certbot root@pnetlab-server:~# mkdir letsencrypt/work letsencrypt/config letsencrypt/logs We can obtain a Let’s Encrypt certificate with the following command.\nroot@pnetlab-server:~# certbot certonly --agree-tos --email admin@yourdomain.com --manual --preferred-challenges=dns -d \\*.yourdomain.com --config-dir ./letsencrypt/config --work-dir ./letsencrypt/work --logs-dir ./letsencrypt/logs Complete the ACME DNS challenge on your DNS provider (NameCheap, Hostinger, etc). After successful validation, the CA (Let’s Encrypt) will issue the certificate, which should be available at ./letsencrypt/config/live/yourdomain.com.\nNext, edit /etc/apache2/sites-available/pnetlabs.conf and change these values with your certificate path.\nSSLCertificateFile /path/to/your/cert/cert1.pem SSLCertificateKeyFile /path/to/your/certkey/privkey1.pem Restart the apache services\nroot@pnetlab-server:~# systemctl restart apache2 Create DNS A record Go to your DNS hosting provider and add a new records with the following data:\nType: A Hostname/Domain Name: pnetlab.yourdomain.com IPv4: pnetlab-tailscale-ip Here’s an example of mine, where I’m using Cloudflare for DNS management.\n100.126.1.2 is the tailscale node IP of my pnetlab server.\nVerify if your domain is mapped correctly using the dig command or Google Toolbox.\n$ dig pnetlab.gcp.fahmifj.space ...[SNIP]... ;; QUESTION SECTION: ;pnetlab.fahmifj.space.\tIN\tA ;; ANSWER SECTION: pnetlab.fahmifj.space. 300\tIN\tA\t100.126.1.2 ...[SNIP]... Once you done and get connected to Tailscale network, you should be able to access PNETLab at pnetlab.yourdomain.com.\nTroubleshoot If you happen to meet these errors, try the following solutions.\nCannot install packages Try disable/comment this whole url line from the repository.\n#deb [trusted=yes] http://i-share.top/repo ./ #deb [trusted=yes] http://repo.pnetlab.com ./ Cloud Appliance: DHCP not working Verify udhcpd service is running and enabled.\n$ service udhcpd status $ cat /etc/default/udhcpd | grep ENABLED Update to enabled and restart and see if it’s working.\nConclusion We’ve completed all the necessary steps to deploy a PNETLab server on Google Cloud. With this setup, we can do our networking stuff in the lab safely without exposing it to the internet.\nThat’s all, see you in the next post!\n","wordCount":"2018","inLanguage":"en","datePublished":"2025-03-26T13:27:29+07:00","dateModified":"2025-11-02T00:00:00Z","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/articles/deploy-pnetlab-on-gcp/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menuOnScroll()><li><a href=https://fahmifj.github.io/articles/ title=Articles>Articles</a></li><li><a href=https://fahmifj.github.io/notes/ title=Notes>Notes</a></li><li><a href=https://fahmifj.github.io/ctf/ title=CTF>CTF</a></li><li><a href=https://fahmifj.github.io/series/ title=Series>Series</a></li><li><a href=https://fahmifj.github.io/archives/ title=Archives>Archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search placeholder=Search...><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main id=swup class="main transition-fade"><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/articles/>Articles</a></div><h1 class=post-title>Deploying PNETLab on Google Cloud</h1><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>March 26, 2025</span>&nbsp;&#183;&nbsp;<span class=meta-read>10 min read</span></div><hr></header><div class=post-content-container><nav id=toc class=toc aria-label="Table of contents"><div class=inner><ul><li><a href=#prepare-the-gcp-project aria-label="Prepare the GCP Project">Prepare the GCP Project</a><ul><li><a href=#create-a-project aria-label="Create a Project">Create a Project</a></li><li><a href=#enable-the-compute-api aria-label="Enable the Compute API">Enable the Compute API</a></li></ul></li><li><a href=#instance-deployment aria-label="Instance Deployment">Instance Deployment</a><ul><li><a href=#preparing-terraform-code aria-label="Preparing Terraform Code">Preparing Terraform Code</a></li><li><a href=#run-code aria-label="Run Code">Run Code</a></li><li><a href=#verify-deployment aria-label="Verify Deployment">Verify Deployment</a></li></ul></li><li><a href=#pnetlab-installation aria-label="PNETLab Installation">PNETLab Installation</a><ul><li><a href=#install-pnetlab aria-label="Install PNETLab">Install PNETLab</a></li><li><a href=#configure-the-instance aria-label="Configure the Instance">Configure the Instance</a></li><li><a href=#update-version-optional aria-label="Update Version (Optional)">Update Version (Optional)</a></li></ul></li><li><a href=#setup-tailscale-vpn aria-label="Setup Tailscale VPN">Setup Tailscale VPN</a><ul><li><a href=#install-tailscale aria-label="Install Tailscale">Install Tailscale</a></li><li><a href=#configure-subnet-router aria-label="Configure Subnet Router">Configure Subnet Router</a></li><li><a href=#verify-routing aria-label="Verify Routing">Verify Routing</a></li></ul></li><li><a href=#configure-domain-name aria-label="Configure Domain Name">Configure Domain Name</a><ul><li><a href=#obtain-letsencrypt-ssl aria-label="Obtain LetsEncrypt SSL">Obtain LetsEncrypt SSL</a></li><li><a href=#create-dns-a-record aria-label="Create DNS A record">Create DNS A record</a></li></ul></li><li><a href=#troubleshoot aria-label=Troubleshoot>Troubleshoot</a><ul><li><a href=#cannot-install-packages aria-label="Cannot install packages">Cannot install packages</a></li><li><a href=#cloud-appliance-dhcp-not-working aria-label="Cloud Appliance: DHCP not working">Cloud Appliance: DHCP not working</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></nav><div class=post-content><p>In the <a href=https://fahmifj.github.io/articles/running-gns3-on-apple-m2-orbstack/ target=_blank rel="noopener noreferrer">previous article</a>, I had an issue with either Mac or Orbstack&rsquo;s networking system, that prevented my localhost from communicating with the GNS3 appliances. Instead of spending more time troubleshooting, I decided to give PNETLab a try, a web-based network emulator that can run entirely on a cloud server.</p><p>In this article, I’ll show how to deploy PNETLab on Google Cloud using Terraform to automate the setup, and Tailscale to securely access the lab without exposing it to the public Internet.</p><p><strong>Goals</strong></p><ul><li>Automate PNETLab server deployment with Terraform.</li><li>Secure access to the lab without exposing it to the public internet.</li><li>Configure a domain for easy access to the lab.</li></ul><p><strong>Prerequisites</strong></p><ul><li>GCP & Twingate accounts.</li><li>GCP CLI installed.</li><li>Terraform installed.</li><li>Own a domain name (optional).</li></ul><p><strong>Network Diagram Overview</strong></p><p>Here’s an overview of what we’re going to build:</p><img src=./imgs/image-20251028001404879.png alt=image-20251028001404879 style=zoom:50%><h2 id=prepare-the-gcp-project>Prepare the GCP Project<a class=anchor aria-hidden=true href=#prepare-the-gcp-project>#</a></h2><h3 id=create-a-project>Create a Project<a class=anchor aria-hidden=true href=#create-a-project>#</a></h3><p>Before we begin, make sure that you&rsquo;ve <a href=https://docs.cloud.google.com/sdk/gcloud/reference/auth/login target=_blank rel="noopener noreferrer">authenticated to GCP</a>. Once done, create a project for our PNETLab deployment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>PROJECT_ID</span><span class=o>=</span>pnetlab-<span class=nv>$RANDOM</span>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=nv>$PROJECT_ID</span>
</span></span><span class=line><span class=cl>pnetlab-xxx
</span></span><span class=line><span class=cl>$ mkdir <span class=nv>$PROJECT_ID</span>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> <span class=nv>$PROJECT_ID</span>
</span></span><span class=line><span class=cl>$ gcloud projects create <span class=nv>$PROJECT_ID</span>
</span></span><span class=line><span class=cl>$ gcloud config <span class=nb>set</span> project <span class=nv>$PROJECT_ID</span>
</span></span></code></pre></div><p>Then, link the project to your <a href=https://cloud.google.com/billing/docs/how-to/create-billing-account target=_blank rel="noopener noreferrer">billing account</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ gcloud billing accounts list              
</span></span><span class=line><span class=cl>ACCOUNT_ID            NAME                OPEN  MASTER_ACCOUNT_ID
</span></span><span class=line><span class=cl>AAAAAA-BBBBBB-CCCCCC  My Billing Account  True
</span></span><span class=line><span class=cl>$ gcloud billing projects link <span class=nv>$PROJECT_ID</span> --billing-account<span class=o>=</span>AAAAAA-BBBBBB-CCCCCC
</span></span></code></pre></div><h3 id=enable-the-compute-api>Enable the Compute API<a class=anchor aria-hidden=true href=#enable-the-compute-api>#</a></h3><p>Before you can use Google Cloud&rsquo;s compute resources, we need to enable the Compute API which allows your project to access and manage VM instances.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ gcloud services <span class=nb>enable</span> compute.googleapis.com
</span></span></code></pre></div><blockquote><p>Note: I&rsquo;m using GCP&rsquo;s free trial credits for this setup, if you&rsquo;re on a paid account, the steps remain the same.</p></blockquote><h2 id=instance-deployment>Instance Deployment<a class=anchor aria-hidden=true href=#instance-deployment>#</a></h2><h3 id=preparing-terraform-code>Preparing Terraform Code<a class=anchor aria-hidden=true href=#preparing-terraform-code>#</a></h3><p>We&rsquo;ll use the following folder structure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── README.MD
</span></span><span class=line><span class=cl>└── terraform
</span></span><span class=line><span class=cl>    ├── terraforms.tfvars <span class=c1># sensitive informations goes here (project_id, region, user/keys)</span>
</span></span><span class=line><span class=cl>    ├── main.tf <span class=c1># defined gcp resources</span>
</span></span><span class=line><span class=cl>    └── variables.tf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>1</span> directories, <span class=m>4</span> files
</span></span></code></pre></div><p>Within the terraform folder, initialize the terraform working directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ terraform init
</span></span></code></pre></div><h4 id=terraformtfvars>terraform.tfvars<a class=anchor aria-hidden=true href=#terraformtfvars>#</a></h4><p><code>terraforms.tfvars</code> contains the following (make your adjustment):</p><pre tabindex=0><code>project_id      = &#34;&#34;
region          = &#34;&#34;
zone            = &#34;&#34;
os_image        = &#34;projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20240116a&#34;
ssh_user        = &#34;username&#34;
ssh_pub_user    = &#34;ssh-ed25519 AAAAC3N... root&#34;
ssh_pub_ansible = &#34;ssh-ed25519 AAAAC3N... ansible&#34;
</code></pre><h4 id=maintf>main.tf<a class=anchor aria-hidden=true href=#maintf>#</a></h4><p><code>main.tf</code> file contains the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>terraform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>required_providers</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>google</span> <span class=err>=</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>      <span class=err>source</span> <span class=err>=</span> <span class=nt>&#34;hashicorp/google&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>version</span> <span class=err>=</span> <span class=s2>&#34;~&gt; 4.5&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>provider</span> <span class=s2>&#34;google&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>project</span> <span class=err>=</span> <span class=err>var.project_id</span>
</span></span><span class=line><span class=cl>  <span class=err>region</span>  <span class=err>=</span> <span class=err>var.region</span>
</span></span><span class=line><span class=cl>  <span class=err>zone</span>    <span class=err>=</span> <span class=err>var.zone</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>SETUP</span> <span class=err>NETWORK</span> <span class=err>#</span>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_network&#34;</span> <span class=s2>&#34;pnetlab_vpc&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span>                    <span class=err>=</span> <span class=nt>&#34;pnetlab-vpc&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>auto_create_subnetworks</span> <span class=err>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_subnetwork&#34;</span> <span class=s2>&#34;pnetlab_subnet&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span>          <span class=err>=</span> <span class=nt>&#34;pnetlab-subnet&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>network</span>       <span class=err>=</span> <span class=err>google_compute_network.pnetlab_vpc.id</span>
</span></span><span class=line><span class=cl>  <span class=err>ip_cidr_range</span> <span class=err>=</span> <span class=s2>&#34;10.10.1.0/24&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_firewall&#34;</span> <span class=s2>&#34;allow_ssh_access&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span>    <span class=err>=</span> <span class=nt>&#34;allow-ssh&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>network</span> <span class=err>=</span> <span class=err>google_compute_network.pnetlab_vpc.id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>allow</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>protocol</span> <span class=err>=</span> <span class=nt>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>ports</span>    <span class=err>=</span> <span class=p>[</span><span class=s2>&#34;22&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>source_ranges</span> <span class=err>=</span> <span class=p>[</span> <span class=s2>&#34;0.0.0.0/0&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>NAT</span>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_router&#34;</span> <span class=s2>&#34;pnetlab_router&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span> <span class=err>=</span> <span class=nt>&#34;pnetlab-router&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>region</span> <span class=err>=</span> <span class=err>var.region</span>
</span></span><span class=line><span class=cl>  <span class=err>network</span> <span class=err>=</span> <span class=err>google_compute_network.pnetlab_vpc.id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_router_nat&#34;</span> <span class=s2>&#34;pnetlab_router_nat&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span> <span class=err>=</span> <span class=nt>&#34;pnetlab-router-nat&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>region</span> <span class=err>=</span> <span class=err>var.region</span>
</span></span><span class=line><span class=cl>  <span class=err>router</span> <span class=err>=</span> <span class=err>google_compute_router.pnetlab_router.name</span>
</span></span><span class=line><span class=cl>  <span class=err>nat_ip_allocate_option</span> <span class=err>=</span> <span class=s2>&#34;AUTO_ONLY&#34;</span> <span class=err>#</span> <span class=err>use</span> <span class=err>dynamic</span> <span class=err>public</span> <span class=err>ip</span> <span class=err>for</span> <span class=err>nat</span>
</span></span><span class=line><span class=cl>  <span class=err>source_subnetwork_ip_ranges_to_nat</span> <span class=err>=</span> <span class=s2>&#34;ALL_SUBNETWORKS_ALL_IP_RANGES&#34;</span> <span class=err>#</span> <span class=err>nat</span> <span class=err>any</span> <span class=err>sources</span> <span class=err>ip</span> <span class=err>range</span> <span class=err>available</span> <span class=err>within</span> <span class=err>the</span> <span class=err>vpc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>SETUP</span> <span class=err>EXT</span> <span class=err>DISK</span> <span class=err>#</span>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_disk&#34;</span> <span class=s2>&#34;additional_disk&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span>   <span class=err>=</span> <span class=nt>&#34;pnetlab-additional-disk&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>   <span class=err>=</span> <span class=s2>&#34;pd-standard&#34;</span>  <span class=err>#</span> <span class=err>Choose</span> <span class=err>disk</span> <span class=err>type</span> <span class=err>(pd-standard</span><span class=p>,</span> <span class=err>pd-ssd,</span> <span class=err>etc.)</span>
</span></span><span class=line><span class=cl>  <span class=err>size</span> <span class=err>=</span> <span class=err>100</span> 
</span></span><span class=line><span class=cl>  <span class=err>lifecycle</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>prevent_destroy</span> <span class=err>=</span> <span class=err>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>SETUP</span> <span class=err>INSTANCES</span> <span class=err>#</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>ubuntu</span><span class=mi>-1804</span><span class=err>-bionic-v</span><span class=mi>20240116</span><span class=err>a</span>                                 <span class=err>ubuntu-os-cloud</span>      <span class=err>ubuntu</span><span class=mi>-1804</span><span class=err>-lts</span>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;google_compute_instance&#34;</span> <span class=s2>&#34;pnetlab_server&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name</span>         <span class=err>=</span> <span class=nt>&#34;pnetlab-server&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>machine_type</span> <span class=err>=</span> <span class=s2>&#34;n2-standard-2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>tags</span>         <span class=err>=</span> <span class=p>[</span><span class=s2>&#34;pnetlab&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>boot_disk</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>initialize_params</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>      <span class=err>image</span> <span class=err>=</span> <span class=err>var.os_image</span> <span class=err>#</span> <span class=err>cloud</span> <span class=err>image</span>
</span></span><span class=line><span class=cl>      <span class=err>size</span>  <span class=err>=</span> <span class=err>20</span>                 <span class=err>#</span> <span class=err>assign</span> <span class=err>20gb</span>
</span></span><span class=line><span class=cl>      <span class=err>type</span>  <span class=err>=</span> <span class=nt>&#34;pd-standard&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=err>#</span> <span class=err>external</span> <span class=err>disk</span> <span class=mi>100</span><span class=err>gb</span>
</span></span><span class=line><span class=cl>  <span class=err>attached_disk</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>source</span> <span class=err>=</span> <span class=err>google_compute_disk.additional_disk.id</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>network_interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>network</span>    <span class=err>=</span> <span class=err>google_compute_network.pnetlab_vpc.id</span>
</span></span><span class=line><span class=cl>    <span class=err>subnetwork</span> <span class=err>=</span> <span class=err>google_compute_subnetwork.pnetlab_subnet.id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=err>Disable</span> <span class=err>public</span> <span class=err>IP</span>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=err>access_config</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>#</span>  <span class=err>network_tier</span> <span class=err>=</span> <span class=nt>&#34;STANDARD&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>scheduling</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>automatic_restart</span>           <span class=err>=</span> <span class=err>true</span>
</span></span><span class=line><span class=cl>    <span class=err>on_host_maintenance</span>         <span class=err>=</span> <span class=nt>&#34;MIGRATE&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>preemptible</span>                 <span class=err>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=err>provisioning_model</span>          <span class=err>=</span> <span class=s2>&#34;STANDARD&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>advanced_machine_features</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>enable_nested_virtualization</span> <span class=err>=</span> <span class=err>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=err>metadata</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>ssh-keys</span> <span class=err>=</span> <span class=nt>&#34;${var.ssh_user}:${var.ssh_pub_user} \n${var.ssh_user}:${var.ssh_pub_ansible}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h4 id=variablestf>variables.tf<a class=anchor aria-hidden=true href=#variablestf>#</a></h4><p><code>variables.tf</code> define the variables we used in the <code>tfvars</code> file, it contains:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;project_id&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;Project ID&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;region&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;Project region&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>default</span>     <span class=err>=</span> <span class=s2>&#34;us-central&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;zone&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;Project zone&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>default</span>     <span class=err>=</span> <span class=s2>&#34;us-central1-a&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;os_image&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;OS family&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;ssh_user&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;The sudo user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;ssh_pub_user&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;The public key used for authentication to an instance. Format: [public key] [username]&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;ssh_pub_ansible&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span>        <span class=err>=</span> <span class=err>string</span>
</span></span><span class=line><span class=cl>  <span class=err>description</span> <span class=err>=</span> <span class=nt>&#34;The public key used for configuration management. Format: [public key] [username]&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=run-code>Run Code<a class=anchor aria-hidden=true href=#run-code>#</a></h3><p>With all the resource files defined, we will run the following command in the terraform directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ terraform fmt         <span class=c1># Format your Terraform files  </span>
</span></span><span class=line><span class=cl>$ terraform validate    <span class=c1># Check for syntax errors  </span>
</span></span><span class=line><span class=cl>$ terraform plan -out pnetlab-deploy       <span class=c1>#Preview the infrastructure changes  </span>
</span></span><span class=line><span class=cl>$ terraform apply pnetlab-deploy -auto-approve  <span class=c1># Deploy the resources  </span>
</span></span></code></pre></div><h3 id=verify-deployment>Verify Deployment<a class=anchor aria-hidden=true href=#verify-deployment>#</a></h3><p>After it finishes, check if the instance is running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ gcloud compute instances list --filter<span class=o>=</span><span class=s2>&#34;name=pnetlab-server&#34;</span> --project<span class=o>=</span><span class=s2>&#34;</span><span class=nv>$PROJECT_ID</span><span class=s2>&#34;</span>
</span></span></code></pre></div><h2 id=pnetlab-installation>PNETLab Installation<a class=anchor aria-hidden=true href=#pnetlab-installation>#</a></h2><h3 id=install-pnetlab>Install PNETLab<a class=anchor aria-hidden=true href=#install-pnetlab>#</a></h3><p>SSH into the instance using <code>gcloud</code> cli.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ gcloud compute ssh INSTANCE_NAME --zone<span class=o>=</span>YOUR_ZONE
</span></span></code></pre></div><p>Add pnetlab repository with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;deb [trusted=yes] http://repo.pnetlab.com ./&#34;</span> <span class=p>|</span> sudo tee -a /etc/apt/sources.list
</span></span></code></pre></div><p>Update the repository and install pnetlab.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# apt-get update
</span></span><span class=line><span class=cl>root@pnetlab-server:~# apt-get install pnetlab
</span></span></code></pre></div><blockquote><p>Note: I switched my user to root with <code>$ sudo su -</code></p></blockquote><h3 id=configure-the-instance>Configure the Instance<a class=anchor aria-hidden=true href=#configure-the-instance>#</a></h3><h4 id=swap>Swap<a class=anchor aria-hidden=true href=#swap>#</a></h4><p>Create a swap disk, allocate the size according to your need.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# fallocate -l 1G /swapfile
</span></span><span class=line><span class=cl>root@pnetlab-server:~# chmod <span class=m>600</span> /swapfile
</span></span><span class=line><span class=cl>root@pnetlab-server:~# mkswap /swapfile
</span></span><span class=line><span class=cl>root@pnetlab-server:~# swapon /swapfile
</span></span><span class=line><span class=cl>root@pnetlab-server:~# cp /etc/fstab<span class=o>{</span>,.bak<span class=o>}</span>
</span></span><span class=line><span class=cl>root@pnetlab-server:~# <span class=s1>&#39;/swapfile none swap sw 0 0&#39;</span> <span class=p>|</span> sudo tee -a /etc/fstab
</span></span></code></pre></div><h4 id=dns>DNS<a class=anchor aria-hidden=true href=#dns>#</a></h4><p>Edit file <code>/etc/network/interfaces</code> add line <code>dns-nameservers 8.8.8.8</code> to the configuration of interface <code>pnet0</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=c># The primary network interface</span>
</span></span><span class=line><span class=cl><span class=nx>iface</span> <span class=nx>eth0</span> <span class=nx>inet</span> <span class=nx>manual</span>
</span></span><span class=line><span class=cl><span class=nx>auto</span> <span class=nx>pnet0</span>
</span></span><span class=line><span class=cl><span class=nx>iface</span> <span class=nx>pnet0</span> <span class=nx>inet</span> <span class=nx>dhcp</span>
</span></span><span class=line><span class=cl>    <span class=nx>dns-nameservers</span> <span class=mf>8.8</span><span class=p>.</span><span class=mf>8.8</span>
</span></span><span class=line><span class=cl>    <span class=nx>bridge_ports</span> <span class=nx>eth0</span>
</span></span><span class=line><span class=cl>    <span class=nx>bridge_stp</span> <span class=nx>off</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>And restart the networking service.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# sudo service networking restart
</span></span></code></pre></div><h4 id=disk>Disk<a class=anchor aria-hidden=true href=#disk>#</a></h4><p>Time to add the additional disk we defined in the terraform resource. The purpose of this disk is to store all the pnetlab project files as well as the images later.</p><p>In my case, the additional disk is available at <code>/dev/sdb</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# lsblk
</span></span><span class=line><span class=cl>NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span class=line><span class=cl>loop0     7:0    <span class=m>0</span> 40.4M  <span class=m>1</span> loop /snap/snapd/20671
</span></span><span class=line><span class=cl>loop1     7:1    <span class=m>0</span>  368M  <span class=m>1</span> loop /snap/google-cloud-cli/203
</span></span><span class=line><span class=cl>loop2     7:2    <span class=m>0</span> 63.9M  <span class=m>1</span> loop /snap/core20/2105
</span></span><span class=line><span class=cl>sda       8:0    <span class=m>0</span>   20G  <span class=m>0</span> disk 
</span></span><span class=line><span class=cl>├─sda1    8:1    <span class=m>0</span> 19.9G  <span class=m>0</span> part /
</span></span><span class=line><span class=cl>├─sda14   8:14   <span class=m>0</span>    4M  <span class=m>0</span> part 
</span></span><span class=line><span class=cl>└─sda15   8:15   <span class=m>0</span>  106M  <span class=m>0</span> part /boot/efi
</span></span><span class=line><span class=cl>sdb       8:16   <span class=m>0</span>  100G  <span class=m>0</span> disk 
</span></span></code></pre></div><p>We&rsquo;ll create an LVM disk out of it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# vgcreate /dev/vg01 /dev/sdb
</span></span><span class=line><span class=cl>  Volume group <span class=s2>&#34;vg01&#34;</span> successfully created
</span></span><span class=line><span class=cl>root@pnetlab-server:~# lvcreate -l 100%FREE --name lv01 vg01 
</span></span><span class=line><span class=cl>  Logical volume <span class=s2>&#34;lv01&#34;</span> created.
</span></span><span class=line><span class=cl>root@pnetlab-server:~# mkfs.ext4 /dev/vg01/lv01 
</span></span><span class=line><span class=cl>mke2fs 1.44.1 <span class=o>(</span>24-Mar-2018<span class=o>)</span>
</span></span><span class=line><span class=cl>Discarding device blocks: <span class=k>done</span>                            
</span></span><span class=line><span class=cl>Creating filesystem with <span class=m>26213376</span> 4k blocks and <span class=m>6553600</span> inodes
</span></span><span class=line><span class=cl>Filesystem UUID: f1173542-f07c-493f-89e6-188439880465
</span></span><span class=line><span class=cl>Superblock backups stored on blocks: 
</span></span><span class=line><span class=cl>  32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
</span></span><span class=line><span class=cl>  4096000, 7962624, 11239424, 20480000, <span class=m>23887872</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Allocating group tables: <span class=k>done</span>                            
</span></span><span class=line><span class=cl>Writing inode tables: <span class=k>done</span>                            
</span></span><span class=line><span class=cl>Creating journal <span class=o>(</span><span class=m>131072</span> blocks<span class=o>)</span>: <span class=k>done</span>
</span></span><span class=line><span class=cl>Writing superblocks and filesystem accounting information: <span class=k>done</span>
</span></span></code></pre></div><p>Then we set a mount point for the volume we just created.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# mkdir /mnt/unetlab
</span></span><span class=line><span class=cl>root@pnetlab-server:~# mount /dev/vg01/lv01 /mnt/unetlab
</span></span></code></pre></div><p>Edit the <code>/etc/fstab</code> file and add the following line to mount <code>/mnt/unetlab</code> on boot:</p><pre tabindex=0><code>/dev/vg01/lv01  /mnt/unetlab  ext4  defaults  0  0
</code></pre><p>Now we&rsquo;ll create a new directory for PNETLab project files and image files in our newly mounted disk.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# mkdir /mnt/unetlab/addons
</span></span><span class=line><span class=cl>root@pnetlab-server:~# mkdir /mnt/unetlab/labs
</span></span></code></pre></div><p>Next, we&rsquo;ll remove the old directories for project files and image files, and replace them with symbolic links pointing to the new directories on the mounted disk.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# rm -rf /opt/unetlab/addons/ 
</span></span><span class=line><span class=cl>root@pnetlab-server:~# rm -rf /opt/unetlab/labs/
</span></span><span class=line><span class=cl>root@pnetlab-server:~# ln -s /mnt/unetlab/addons/ /opt/unetlab/
</span></span><span class=line><span class=cl>root@pnetlab-server:~# ln -s /mnt/unetlab/labs/ /opt/unetlab/
</span></span></code></pre></div><p>Change ownership of the new labs directory to ensure PNETLab&rsquo;s services can access it back.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# chown -R www-data:www-data /mnt/unetlab/labs/
</span></span></code></pre></div><h4 id=grub>Grub<a class=anchor aria-hidden=true href=#grub>#</a></h4><p>Remove the default grub config.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# rm /etc/default/grub.d/50-cloudimg-settings.cfg
</span></span><span class=line><span class=cl>root@pnetlab-server:~# update-grub
</span></span><span class=line><span class=cl>root@pnetlab-server:~# reboot
</span></span></code></pre></div><h4 id=restart-and-verify>Restart and Verify<a class=anchor aria-hidden=true href=#restart-and-verify>#</a></h4><p>Once all the steps above are complete, restart the server and verify if the pnetlab service is running using the following command and check these ports: <code>80</code>, <code>443</code> for pnetlab web services and <code>4822</code> for guacamole proxy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# netstat -tlpn  
</span></span></code></pre></div><h3 id=update-version-optional>Update Version (Optional)<a class=anchor aria-hidden=true href=#update-version-optional>#</a></h3><p>After the installation completed, we can directly upgrade PNETLab to the latest version. It&rsquo;s an optional, so I will just put the official guide link on how to upgrade the lab version: <a href=https://pnetlab.com/pages/releases target=_blank rel="noopener noreferrer">go here</a>.</p><h2 id=setup-tailscale-vpn>Setup Tailscale VPN<a class=anchor aria-hidden=true href=#setup-tailscale-vpn>#</a></h2><p>For this step, I will assume that you already generated an auth key in the Tailscale <a href=https://login.tailscale.com/admin/settings/keys target=_blank rel="noopener noreferrer">admin console</a>.</p><h3 id=install-tailscale>Install Tailscale<a class=anchor aria-hidden=true href=#install-tailscale>#</a></h3><p>First, install Tailscale by executing the install script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# curl -fsSL https://tailscale.com/install.sh <span class=p>|</span> sh 
</span></span></code></pre></div><h3 id=configure-subnet-router>Configure Subnet Router<a class=anchor aria-hidden=true href=#configure-subnet-router>#</a></h3><p>We will configure the instance as a <a href=https://tailscale.com/kb/1019/subnets target=_blank rel="noopener noreferrer">subnet router</a>, simply turning the server into a <strong>router</strong>. This will enable direct access between PNETLab appliances network and our local network via the Tailscale network.</p><p>To achieve that, we first need to enable IP forwarding on the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# <span class=nb>echo</span> <span class=s1>&#39;net.ipv4.ip_forward = 1&#39;</span> <span class=p>|</span> sudo tee -a /etc/sysctl.d/99-tailscale.conf
</span></span><span class=line><span class=cl>root@pnetlab-server:~# <span class=nb>echo</span> <span class=s1>&#39;net.ipv6.conf.all.forwarding = 1&#39;</span> <span class=p>|</span> sudo tee -a /etc/sysctl.d/99-tailscale.conf
</span></span><span class=line><span class=cl>root@pnetlab-server:~# sudo sysctl -p /etc/sysctl.d/99-tailscale.conf
</span></span></code></pre></div><p>To register your instance as a node in your Tailscale network and enable it to act as a subnet router, run the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# tailscale up --auth-key<span class=o>=</span>tskey-auth-XXXXX  --advertise-route<span class=o>=</span>10.0.10.0/24
</span></span></code></pre></div><blockquote><p>Note:</p><ul><li><p>Replace <code>tskey-auth-XXXXX</code> with your actual auth key and <code>10.0.10.0/24</code> with your designated local network on the PNETLAB server:</p></li><li><p>The <code>--advertise-routes=10.0.10.0/24</code> option tells the instance to advertise the subnet <code>10.0.10.0/24</code> to your Tailscale network. Once advertised, other devices in your Tailscale network can route traffic to this subnet through this instance.</p></li></ul></blockquote><p>Revisit your Tailscale&rsquo;s admin console. You should see a <code>Subnets</code> label on the pnetlab node.</p><img src=./imgs/image-20250326110623945.png alt=image-20250326110623945 style=zoom:50%><p>Open the node settings, select &ldquo;<strong>edit route settings&mldr;</strong>&rdquo; and tick your network there.</p><img src=./imgs/image-20250326100421964.png alt=image-20250326100421964 style=zoom:50%><h3 id=verify-routing>Verify Routing<a class=anchor aria-hidden=true href=#verify-routing>#</a></h3><p>To verify, you can simply ping any interface IP of the instance that you have advertised. The image below is an example of mine, where I&rsquo;m pinging the Docker interface.</p><img src=./imgs/image-20251028003923861.png alt=image-20251028003923861 style=zoom:50%><h2 id=configure-domain-name>Configure Domain Name<a class=anchor aria-hidden=true href=#configure-domain-name>#</a></h2><p>We can use a custom domain name to access PNETLab. To do so, we will obtain a LetsEncrypt&rsquo;s certificate to replace the self-signed one and then configure a new DNS record: <code>pnetlab.yourdomain.com</code>. This record will be pointing to Tailscale IP of our instance.</p><p>For this step, I will assume that you already own a domain and know how to complete an ACME DNS challenge (proving control over a domain).</p><h3 id=obtain-letsencrypt-ssl>Obtain LetsEncrypt SSL<a class=anchor aria-hidden=true href=#obtain-letsencrypt-ssl>#</a></h3><p>Within the instance, install <code>certbot</code> and prepare the work folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# sudo apt install -y certbot
</span></span><span class=line><span class=cl>root@pnetlab-server:~# mkdir letsencrypt/work letsencrypt/config letsencrypt/logs
</span></span></code></pre></div><p>We can obtain a Let&rsquo;s Encrypt certificate with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# certbot certonly --agree-tos --email admin@yourdomain.com --manual --preferred-challenges<span class=o>=</span>dns -d <span class=se>\*</span>.yourdomain.com --config-dir ./letsencrypt/config --work-dir ./letsencrypt/work --logs-dir ./letsencrypt/logs
</span></span></code></pre></div><p>Complete the ACME DNS challenge on your DNS provider (NameCheap, Hostinger, etc). After successful validation, the CA (Let&rsquo;s Encrypt) will issue the certificate, which should be available at <code>./letsencrypt/config/live/yourdomain.com</code>.</p><p>Next, edit <code>/etc/apache2/sites-available/pnetlabs.conf</code> and change these values with your certificate path.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SSLCertificateFile   /path/to/your/cert/cert1.pem
</span></span><span class=line><span class=cl>SSLCertificateKeyFile /path/to/your/certkey/privkey1.pem
</span></span></code></pre></div><p>Restart the apache services</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pnetlab-server:~# systemctl restart apache2
</span></span></code></pre></div><h3 id=create-dns-a-record>Create DNS A record<a class=anchor aria-hidden=true href=#create-dns-a-record>#</a></h3><p>Go to your DNS hosting provider and add a new records with the following data:</p><ul><li>Type: <code>A</code></li><li>Hostname/Domain Name: <code>pnetlab.yourdomain.com</code></li><li>IPv4: <code>pnetlab-tailscale-ip</code></li></ul><p>Here&rsquo;s an example of mine, where I&rsquo;m using Cloudflare for DNS management.</p><img src=./imgs/image-20250326102815535.png alt=image-20250326102815535 style=zoom:33%><blockquote><p><code>100.126.1.2</code> is the tailscale node IP of my pnetlab server.</p></blockquote><p>Verify if your domain is mapped correctly using the <code>dig</code> command or <a href=https://toolbox.googleapps.com/apps/dig/#A/ target=_blank rel="noopener noreferrer">Google Toolbox</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ dig pnetlab.gcp.fahmifj.space                         
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl><span class=p>;;</span> QUESTION SECTION:
</span></span><span class=line><span class=cl><span class=p>;</span>pnetlab.fahmifj.space.	IN	A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>;;</span> ANSWER SECTION:
</span></span><span class=line><span class=cl>pnetlab.fahmifj.space. 300	IN	A	100.126.1.2
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>Once you done and get connected to Tailscale network, you should be able to access PNETLab at <code>pnetlab.yourdomain.com</code>.</p><h2 id=troubleshoot>Troubleshoot<a class=anchor aria-hidden=true href=#troubleshoot>#</a></h2><p>If you happen to meet these errors, try the following solutions.</p><h3 id=cannot-install-packages>Cannot install packages<a class=anchor aria-hidden=true href=#cannot-install-packages>#</a></h3><p>Try disable/comment this whole url line from the repository.</p><pre tabindex=0><code>#deb [trusted=yes] http://i-share.top/repo ./
#deb [trusted=yes] http://repo.pnetlab.com ./
</code></pre><h3 id=cloud-appliance-dhcp-not-working>Cloud Appliance: DHCP not working<a class=anchor aria-hidden=true href=#cloud-appliance-dhcp-not-working>#</a></h3><p>Verify <code>udhcpd</code> service is running and enabled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ service udhcpd status
</span></span><span class=line><span class=cl>$ cat /etc/default/udhcpd <span class=p>|</span> grep ENABLED
</span></span></code></pre></div><p>Update to enabled and restart and see if it&rsquo;s working.</p><h2 id=conclusion>Conclusion<a class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>We&rsquo;ve completed all the necessary steps to deploy a PNETLab server on Google Cloud. With this setup, we can do our networking stuff in the lab safely without exposing it to the internet.</p><p>That&rsquo;s all, see you in the next post!</p><div class=post-references><h2>Reference</h2><ul><li><a href="https://www.pnetlab.com/pages/documentation?slug=how-to-deploy-pnetlab-box-on-google-cloud" target=_blank rel="noopener noreferrer">https://www.pnetlab.com/pages/documentation?slug=how-to-deploy-pnetlab-box-on-google-cloud</a></li></ul></div></div></div><div class=post-meta-bottom><span class=date-update>Updated on November 02, 2025</span></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/home-lab/>Home-lab</a></li><li><a href=https://fahmifj.github.io/tags/gcp/>gcp</a></li><li><a href=https://fahmifj.github.io/tags/tailscale/>tailscale</a></li><li><a href=https://fahmifj.github.io/tags/terraform/>terraform</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on twitter" href="https://twitter.com/intent/tweet/?text=Deploying%20PNETLab%20on%20Google%20Cloud&amp;url=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f&amp;hashtags=home-lab%2cgcp%2ctailscale%2cterraform"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f&amp;title=Deploying%20PNETLab%20on%20Google%20Cloud&amp;summary=Deploying%20PNETLab%20on%20Google%20Cloud&amp;source=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f&title=Deploying%20PNETLab%20on%20Google%20Cloud"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on whatsapp" href="https://api.whatsapp.com/send?text=Deploying%20PNETLab%20on%20Google%20Cloud%20-%20https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deploying PNETLab on Google Cloud on telegram" href="https://telegram.me/share/url?text=Deploying%20PNETLab%20on%20Google%20Cloud&amp;url=https%3a%2f%2ffahmifj.github.io%2farticles%2fdeploy-pnetlab-on-gcp%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><div class=footer-wrapper><div class=footer-right><span class=copyright>&copy; 2025&nbsp;<a href=https://fahmifj.github.io/%20about>Fahmi FJ</a></span></div><div class=footer-mid><span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span>
&nbsp;·&nbsp;
<span class=support><a href=https://fahmifj.github.io/about#support>support</a></span>
&nbsp;·&nbsp;
<span class=rss><a href=https://fahmifj.github.io/index.xml>rss</a></span></div><div class=footer-left><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span><a href=https://git.io/hugopapermod rel="noopener noreferrer" target=_blank>PaperMod</a></span></div></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script src=https://fahmifj.github.io/js/toc.min.ce91a484ef8bd5269d29f99cb564f8a55429364b383629459e33fc50dec37644.js></script>
<script defer type=module src=https://fahmifj.github.io/js/Swup.umd.min.d64a38b8723041127f14ef7bcd3898876f7226120fe6bd79aadb73f863ee0395.js></script>
<script defer src=https://fahmifj.github.io/js/custom.min.9823db6be4ed92504e057463eb39c25c3384263f7decbda02eb2ec6ad1ad71ad.js></script></body></html>