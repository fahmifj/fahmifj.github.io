<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>Building Virtual Home Lab for Pentesting | Ef's log</title>
<meta name=keywords content="Home lab,Pentesting,Cyber Security"><meta name=description content="Virtual home lab for offensive security practice, with 8 gigs!"><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/blog/building-virtual-home-lab-for-pentest/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.f8d44b48193d4cea81abe843f6f06cf29be562f410f74313d884444ebb3fa35b.css integrity="sha256-+NRLSBk9TOqBq+hD9vBs8pvlYvQQ90MT2IRETrs/o1s=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.10542ddfd48539cce47e119ac2ff665345319adeb919a52f2fc7ff4b6821ab2d.js integrity="sha256-EFQt39SFOczkfhGawv9mU0Uxmt65GaUvL8f/S2ghqy0="></script><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.cf0efeebfea85186ccfa1ab860f53a721a53d5112d3eb0e6671f5335b852e18b.js integrity="sha256-zw7+6/6oUYbM+hq4YPU6chpT1REtPrDmZx9TNbhS4Ys="></script><link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.123.3"><link rel=alternate hreflang=en href=https://fahmifj.github.io/blog/building-virtual-home-lab-for-pentest/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="Building Virtual Home Lab for Pentesting"><meta property="og:description" content="Virtual home lab for offensive security practice, with 8 gigs!"><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/blog/building-virtual-home-lab-for-pentest/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-06-17T14:04:24+07:00"><meta property="article:modified_time" content="2021-06-17T14:04:24+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building Virtual Home Lab for Pentesting"><meta name=twitter:description content="Virtual home lab for offensive security practice, with 8 gigs!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://fahmifj.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Building Virtual Home Lab for Pentesting","item":"https://fahmifj.github.io/blog/building-virtual-home-lab-for-pentest/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building Virtual Home Lab for Pentesting","name":"Building Virtual Home Lab for Pentesting","description":"Virtual home lab for offensive security practice, with 8 gigs!","keywords":["Home lab","Pentesting","Cyber Security"],"articleBody":"This article documents a virtual Active Directory lab I built to learn some Active Directory attacks, network pivoting, and basic Command and Control (C2) using Metasploit.\nThe lab is designed to resemble a small enterprise Windows environment with minimal requirements that enough to run on a mid-range specification.\nAssumptions \u0026 Threat Model This lab assumes:\nAn internal attacker with network access Minimal internal monitoring Default or weak Windows security configurations Misconfigured behavior Prerequisites Knowledge Virtualization (VirtualBox) Windows and Windows Server installation Basic Active Directory concepts (Domain, DNS, SPNs) Basic networking and routing Hardware Recommended minimum (sorted by priority):\nStorage: 256 GB SSD (or high-speed USB 3.x) RAM: 8 GB minimum, 16 GB recommended CPU: Minimum: Intel i3 6th gen / Ryzen 3 Recommended: i5 / Ryzen 5 (H or K variants) The lab was built and tested on an 8 GB system by aggressively disabling unused services after installation.\nSoftware VirtualBox (Download) Kali Linux (attacker) (Download) Windows 10 evaluation image file (Download) Windows Server 2019 evaluation image file (Download) Topology Overview The environment consists of:\n1 Domain Controller 2 Domain-joined Windows clients 1 Attacker machine (Kali Linux) Two network segments are used:\n192.168.1.0/24 – Internal domain network 10.10.10.96/28 – Segmented network used for pivoting scenarios Note: It’s NIC (Network Interface Card) not NC\nNetwork Segments This lab intentionally uses two network segments to simulate an internal enterprise environment and to enable pivoting scenarios later on.\nSegment CIDR Name Purpose 1 192.168.1.0/24 windows_domain Main internal network (initial setup \u0026 attacker access) 2 10.10.10.96/28 internal_windows Restricted internal segment (pivoting target) VirtualBox Setup System Configuration Initial installation:\nServer: 2424 MB Clients: 1280 MB each Post-installation (after disabling unnecessary services):\nServer: 1280 MB Clients: 1024 MB Attacker: 1024 MB This configuration allows all VMs to run concurrently on an 8 GB host. For initial setup, the two clients can stay inside 192.168.1.0/24 network.\nNetwork Configuration For each VM (initial setup):\nAdapter 1 Type: Internal Network Name: windows_domain IP Range: 192.168.1.0/24 For the Domain Controller only:\nAdapter 2 Name: internal_windows IP Range: 10.10.10.96/28 This makes the Domain Controller act as a bridge between segments.\nActive Directory Setup Server Initial Setup Admin credentials: administrator:p@$$w0rd! PC Name: server19-DC (restart after) Network (Static): Adapter 1: 192.168.1.100/24 Adapter 2: 10.10.10.100/28 Promote Server to Domain Controller Server Manager \u003e Manage \u003e Add Roles and Features. Add Roles and Features Wizard: Installation type: “Role-based or feature-based installation” Server selection: server19-DC Server roles: “Active Directory Domain Services” and check the “Include management tools”. Features: Check the “Group Policy Management” Confirmation: Check on “Restart destination server automatically if required” Close after it’s done. Server Manager \u003e Notification flag \u003e Click on “Promote this server to a domain controller” Active Directory Domain Services Configuration Wizard: Deployment configuration: “Add a new forest” and set “server19.local” as root domain name Domain controller options: set “Windows Server 2016” as FFL (Forest Functional Level) and DFL (Domain Functional Level). Checklist DNS server and set the same admin password for DSRM password. Additional options: set NetBIOS domain name to SERVER19 Let the rest options in default state until installation section. Restart after installation complete. Create Domain Accounts John Smith User logon name: jsmith@server19.local Password: jsmith@123 Carl Smith User logon name: cmisth@server19.local Password: @csmith@ All password is set to never expires.\nCreate Fake Service Account Fake SQL Service\nUser logon name: SQLService@server19.local Password: Mysql@Password123 Set service principle name:\nsetspn -a SERVER19-DC/SQLService.SERVER19.local:60111 SERVER19\\SQLService setspn -T SERVER19.local -Q */* Configure File Sharing (SMB): Server manager \u003e File and Storage Services \u003e Shares \u003e Task \u003e New Share. New Share Wizard: Profile: SMB Share Quick Share Location: C:\\Shares\\DATA (Create the shares folder in C:) Other Settings: Allow caching of share Permission: Leave it default Confirmation and create. Clients Initial Setup Client 1: IP: 192.168.1.101/24 (static) PC name: NESCOFFEE Client 2: IP: 192.168.1.102/24 (static) PC name: MILO For pivoting\nClient 2: IP: 10.10.10.101/28(static) Create Local Accounts Same with domain accounts, but add an L at the end of username/password.\nUsername: cmisthL, password: jsmithL@123 Username: jsmithL, password: @csmith@ Joining Domain Client 1:\nUse Server’s IP as DNS server: 192.168.1.100 Hit Win+I, type “access”, click on Connect. Microsoft account window: Click on “Join this device to a local Active Directory domain” under the alternate actions. Use the server administrator password to join. Skip the Add an account section Restart Client 2 has the same steps\nCreate Local Admin Set John Smith (jsmith@server19.local) as local administrator for NESCOFFEE. Set Carl Smith (cmisth@server19.local) as local administrator for MILO. Attacker Initial Setup Put it on the same network Set static IP: 192.168.1.10/24 Perform ping test Attack Scenarios Here are some attack scenarios that can be reproduced using this lab:\nLLMNR Poisoning\nExample: https://www.aptive.co.uk/blog/llmnr-nbt-ns-spoofing/ AS-REP Roasting\nExample: ASREP-Roasting tags Kerberoasting\nExample: https://pentestlab.blog/2018/06/12/kerberoast/ Take Over IPv6 DNS\nExample: https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/ DCSync\nExample: DCSync tags Attack scenario(s) that requires two clients online + server:\nSMB Relay Examples: HackTheBox - APT, SMB Relay Attack ","wordCount":"810","inLanguage":"en","datePublished":"2021-06-17T14:04:24+07:00","dateModified":"2021-06-17T14:04:24+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/blog/building-virtual-home-lab-for-pentest/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a>
<button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div><ul id=menu onscroll=menuOnScroll()><li><a href=https://fahmifj.github.io/blog/ title=Blog>Blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=CTF>CTF</a></li><li><a href=https://fahmifj.github.io/projects/ title=Projects>Projects</a></li><li><a href=https://fahmifj.github.io/threads/ title=Threads>Threads</a></li><li><a href=https://fahmifj.github.io/archives/ title=Archives>Archives</a></li></ul><button id=menu-toggle aria-label="Toggle menu">☰</button><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search placeholder=Search...><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div></div></nav></header><div id=mask></div><main id=swup class="main transition-fade"><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/blog/>Blog</a></div><h1 class=post-title>Building Virtual Home Lab for Pentesting</h1><p class=post-description>Virtual home lab for offensive security practice, with 8 gigs!</p><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>Published on June 17, 2021</span>&nbsp;&#183;&nbsp;<span class=read-time>4 min read</span></div><hr></header><div class=post-content-container><nav id=toc class=toc aria-label="Table of contents"><div class=inner><ul><li><a href=#assumptions--threat-model aria-label="Assumptions &amp;amp; Threat Model">Assumptions & Threat Model</a></li><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a><ul><li><a href=#knowledge aria-label=Knowledge>Knowledge</a></li><li><a href=#hardware aria-label=Hardware>Hardware</a></li><li><a href=#software aria-label=Software>Software</a></li></ul></li><li><a href=#topology-overview aria-label="Topology Overview">Topology Overview</a></li><li><a href=#network-segments aria-label="Network Segments">Network Segments</a></li><li><a href=#virtualbox-setup aria-label="VirtualBox Setup">VirtualBox Setup</a><ul><li><a href=#system-configuration aria-label="System Configuration">System Configuration</a></li><li><a href=#network-configuration aria-label="Network Configuration">Network Configuration</a></li></ul></li><li><a href=#active-directory-setup aria-label="Active Directory Setup">Active Directory Setup</a><ul><li><a href=#server aria-label=Server>Server</a></li><li><a href=#clients aria-label=Clients>Clients</a></li><li><a href=#attacker aria-label=Attacker>Attacker</a></li></ul></li><li><a href=#attack-scenarios aria-label="Attack Scenarios">Attack Scenarios</a></li></ul></div></nav><div class=post-content><div class=series-info><p><i>This article is a part of:</i></p><ul><div><strong>Series: </strong><a href=https://fahmifj.github.io/series/active-directory-attacks/>Active Directory Attacks</a></div><div><strong>Threads: </strong><a href=https://fahmifj.github.io/threads/home-lab/>Home Lab</a></div></div></ul><p>This article documents a virtual Active Directory lab I built to learn some Active Directory attacks, network pivoting, and basic Command and Control (<code>C2</code>) using Metasploit.</p><p>The lab is designed to resemble a small enterprise Windows environment with minimal requirements that enough to run on a mid-range specification.</p><h2 id=assumptions--threat-model>Assumptions & Threat Model<a class=anchor aria-hidden=true href=#assumptions--threat-model>#</a></h2><p>This lab assumes:</p><ul><li>An internal attacker with network access</li><li>Minimal internal monitoring</li><li>Default or weak Windows security configurations</li><li>Misconfigured behavior</li></ul><h2 id=prerequisites>Prerequisites<a class=anchor aria-hidden=true href=#prerequisites>#</a></h2><h3 id=knowledge>Knowledge<a class=anchor aria-hidden=true href=#knowledge>#</a></h3><ul><li>Virtualization (VirtualBox)</li><li>Windows and Windows Server installation</li><li>Basic Active Directory concepts (Domain, DNS, SPNs)</li><li>Basic networking and routing</li></ul><h3 id=hardware>Hardware<a class=anchor aria-hidden=true href=#hardware>#</a></h3><p>Recommended minimum (sorted by priority):</p><ul><li><strong>Storage</strong>: 256 GB SSD (or high-speed USB 3.x)</li><li><strong>RAM</strong>: 8 GB minimum, 16 GB recommended</li><li><strong>CPU</strong>:<ul><li>Minimum: Intel i3 6th gen / Ryzen 3</li><li>Recommended: i5 / Ryzen 5 (H or K variants)</li></ul></li></ul><blockquote><p>The lab was built and tested on an 8 GB system by aggressively disabling unused services after installation.</p></blockquote><h3 id=software>Software<a class=anchor aria-hidden=true href=#software>#</a></h3><ul><li>VirtualBox (<a href=https://www.virtualbox.org/wiki/Downloads target=_blank rel="noopener noreferrer">Download</a>)</li><li>Kali Linux (attacker) (<a href=https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/#1572305786534-030ce714-cc3b target=_blank rel="noopener noreferrer">Download</a>)</li><li>Windows 10 evaluation image file (<a href=https://www.microsoft.com/en-us/evalcenter/ target=_blank rel="noopener noreferrer">Download</a>)</li><li>Windows Server 2019 evaluation image file (<a href=https://www.microsoft.com/en-us/evalcenter/ target=_blank rel="noopener noreferrer">Download</a>)</li></ul><h2 id=topology-overview>Topology Overview<a class=anchor aria-hidden=true href=#topology-overview>#</a></h2><p>The environment consists of:</p><ul><li>1 Domain Controller</li><li>2 Domain-joined Windows clients</li><li>1 Attacker machine (Kali Linux)</li></ul><p>Two network segments are used:</p><ul><li><code>192.168.1.0/24</code> – Internal domain network</li><li><code>10.10.10.96/28</code> – Segmented network used for pivoting scenarios</li></ul><p><div class=img-container><img src=imgs/topology.jpg alt></div></p><blockquote><p>Note: It&rsquo;s NIC (Network Interface Card) not NC</p></blockquote><h2 id=network-segments>Network Segments<a class=anchor aria-hidden=true href=#network-segments>#</a></h2><p>This lab intentionally uses two network segments to simulate an internal enterprise environment and to enable <strong>pivoting scenarios</strong> later on.</p><table><thead><tr><th>Segment</th><th>CIDR</th><th>Name</th><th>Purpose</th></tr></thead><tbody><tr><td>1</td><td><code>192.168.1.0/24</code></td><td>windows_domain</td><td>Main internal network (initial setup & attacker access)</td></tr><tr><td>2</td><td><code>10.10.10.96/28</code></td><td>internal_windows</td><td>Restricted internal segment (pivoting target)</td></tr></tbody></table><h2 id=virtualbox-setup>VirtualBox Setup<a class=anchor aria-hidden=true href=#virtualbox-setup>#</a></h2><h3 id=system-configuration>System Configuration<a class=anchor aria-hidden=true href=#system-configuration>#</a></h3><p>Initial installation:</p><ul><li>Server: <code>2424 MB</code></li><li>Clients: <code>1280 MB</code> each</li></ul><p>Post-installation (after disabling unnecessary services):</p><ul><li>Server: <code>1280 MB</code></li><li>Clients: <code>1024 MB</code></li><li>Attacker: <code>1024 MB</code></li></ul><p>This configuration allows all VMs to run concurrently on an 8 GB host. For initial setup, the two clients can stay inside <code>192.168.1.0/24</code> network.</p><h3 id=network-configuration>Network Configuration<a class=anchor aria-hidden=true href=#network-configuration>#</a></h3><p>For each VM (initial setup):</p><ul><li>Adapter 1<ul><li>Type: <code>Internal Network</code></li><li>Name: <code>windows_domain</code></li><li>IP Range: <code>192.168.1.0/24</code></li></ul></li></ul><p>For the Domain Controller only:</p><ul><li>Adapter 2<ul><li>Name: <code>internal_windows</code></li><li>IP Range: <code>10.10.10.96/28</code></li></ul></li></ul><p>This makes the Domain Controller act as a bridge between segments.</p><p><div class=img-container><img src=imgs/image-20210617143401181.png alt=image-20210617143401181></div></p><h2 id=active-directory-setup>Active Directory Setup<a class=anchor aria-hidden=true href=#active-directory-setup>#</a></h2><h3 id=server>Server<a class=anchor aria-hidden=true href=#server>#</a></h3><h4 id=initial-setup>Initial Setup<a class=anchor aria-hidden=true href=#initial-setup>#</a></h4><ul><li>Admin credentials: <code>administrator:p@$$w0rd!</code></li><li>PC Name: <code>server19-DC</code> (restart after)</li><li>Network (Static):<ul><li>Adapter 1: <code>192.168.1.100/24</code></li><li>Adapter 2: <code>10.10.10.100/28</code></li></ul></li></ul><h4 id=promote-server-to-domain-controller>Promote Server to Domain Controller<a class=anchor aria-hidden=true href=#promote-server-to-domain-controller>#</a></h4><ul><li>Server Manager > Manage > Add Roles and Features.</li><li>Add Roles and Features Wizard:<ul><li>Installation type: &ldquo;<strong>Role-based or feature-based installation</strong>&rdquo;</li><li>Server selection: <code>server19-DC</code></li><li>Server roles: <strong>&ldquo;Active Directory Domain Services&rdquo;</strong> and check the <strong>&ldquo;Include management tools&rdquo;</strong>.</li><li>Features: Check the <strong>&ldquo;Group Policy Management&rdquo;</strong></li><li>Confirmation: Check on <strong>&ldquo;Restart destination server automatically if required&rdquo;</strong></li><li>Close after it&rsquo;s done.</li></ul></li><li>Server Manager > Notification flag > Click on <strong>&ldquo;Promote this server to a domain controller&rdquo;</strong></li><li>Active Directory Domain Services Configuration Wizard:<ul><li>Deployment configuration: <strong>&ldquo;Add a new forest&rdquo;</strong> and set <strong>&ldquo;server19.local&rdquo;</strong> as root domain name</li><li>Domain controller options: set <strong>&ldquo;Windows Server 2016&rdquo;</strong> as FFL (Forest Functional Level) and DFL (Domain Functional Level). Checklist DNS server and set the same admin password for DSRM password.</li><li>Additional options: set NetBIOS domain name to <code>SERVER19</code></li><li>Let the rest options in default state until installation section.</li><li>Restart after installation complete.</li></ul></li></ul><p><div class=img-container><img src=imgs/server19logon.jpg alt></div></p><h4 id=create-domain-accounts>Create Domain Accounts<a class=anchor aria-hidden=true href=#create-domain-accounts>#</a></h4><ul><li>John Smith<ul><li>User logon name: <code>jsmith@server19.local</code></li><li>Password: <code>jsmith@123</code></li></ul></li><li>Carl Smith<ul><li>User logon name: <code>cmisth@server19.local</code></li><li>Password: <code>@csmith@</code></li></ul></li></ul><p>All password is set to never expires.</p><h4 id=create-fake-service-account>Create Fake Service Account<a class=anchor aria-hidden=true href=#create-fake-service-account>#</a></h4><p>Fake SQL Service</p><ul><li>User logon name: <code>SQLService@server19.local</code></li><li>Password: <code>Mysql@Password123</code></li></ul><p>Set service principle name:</p><figure class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>setspn -a SERVER19-DC/SQLService.SERVER19.local:60111 SERVER19\SQLService
</span></span><span class=line><span class=cl>setspn -T SERVER19.local -Q */*</span></span></code></pre></figure><h4 id=configure-file-sharing-smb>Configure File Sharing (SMB):<a class=anchor aria-hidden=true href=#configure-file-sharing-smb>#</a></h4><ul><li>Server manager > File and Storage Services > Shares > Task > New Share.</li><li>New Share Wizard:<ul><li>Profile: SMB Share Quick</li><li>Share Location: <code>C:\Shares\DATA</code> (Create the shares folder in C:)</li><li>Other Settings: Allow caching of share</li><li>Permission: Leave it default</li><li>Confirmation and create.</li></ul></li></ul><h3 id=clients>Clients<a class=anchor aria-hidden=true href=#clients>#</a></h3><h4 id=initial-setup-1>Initial Setup<a class=anchor aria-hidden=true href=#initial-setup-1>#</a></h4><ul><li>Client 1:<ul><li>IP: <code>192.168.1.101/24</code> (static)</li><li>PC name: NESCOFFEE</li></ul></li><li>Client 2:<ul><li>IP: <code>192.168.1.102/24</code> (static)</li><li>PC name: MILO</li></ul></li></ul><p>For pivoting</p><ul><li>Client 2:<ul><li>IP: <code>10.10.10.101/28</code>(static)</li></ul></li></ul><h4 id=create-local-accounts>Create Local Accounts<a class=anchor aria-hidden=true href=#create-local-accounts>#</a></h4><p>Same with domain accounts, but add an <code>L</code> at the end of username/password.</p><ul><li>Username: <code>cmisthL</code>, password: <code>jsmithL@123</code></li><li>Username: <code>jsmithL</code>, password: <code>@csmith@</code></li></ul><h4 id=joining-domain>Joining Domain<a class=anchor aria-hidden=true href=#joining-domain>#</a></h4><p>Client 1:</p><ul><li>Use Server&rsquo;s IP as DNS server: <code>192.168.1.100</code></li><li>Hit <code>Win+I</code>, type &ldquo;access&rdquo;, click on <strong>Connect</strong>.</li><li>Microsoft account window:<ul><li>Click on <strong>&ldquo;Join this device to a local Active Directory domain&rdquo;</strong> under the alternate actions.</li><li>Use the server administrator password to join.</li><li>Skip the <strong>Add an account</strong> section</li><li>Restart</li></ul></li></ul><p>Client 2 has the same steps</p><h4 id=create-local-admin>Create Local Admin<a class=anchor aria-hidden=true href=#create-local-admin>#</a></h4><ul><li>Set John Smith (<code>jsmith@server19.local</code>) as local administrator for NESCOFFEE.</li><li>Set Carl Smith (<code>cmisth@server19.local</code>) as local administrator for MILO.</li></ul><h3 id=attacker>Attacker<a class=anchor aria-hidden=true href=#attacker>#</a></h3><h4 id=initial-setup-2>Initial Setup<a class=anchor aria-hidden=true href=#initial-setup-2>#</a></h4><ul><li>Put it on the same network</li><li>Set static IP: <code>192.168.1.10/24</code></li><li>Perform ping test</li></ul><h2 id=attack-scenarios>Attack Scenarios<a class=anchor aria-hidden=true href=#attack-scenarios>#</a></h2><p>Here are some attack scenarios that can be reproduced using this lab:</p><ul><li><p>LLMNR Poisoning</p><ul><li>Example: <a href=https://www.aptive.co.uk/blog/llmnr-nbt-ns-spoofing/ target=_blank rel="noopener noreferrer">https://www.aptive.co.uk/blog/llmnr-nbt-ns-spoofing/</a></li></ul></li><li><p>AS-REP Roasting</p><ul><li>Example: <a href=https://fahmifj.github.io/tags/asrep-roasting target=_blank rel="noopener noreferrer">ASREP-Roasting tags</a></li></ul></li><li><p>Kerberoasting</p><ul><li>Example: <a href=https://pentestlab.blog/2018/06/12/kerberoast/ target=_blank rel="noopener noreferrer">https://pentestlab.blog/2018/06/12/kerberoast/</a></li></ul></li><li><p>Take Over IPv6 DNS</p><ul><li>Example: <a href=https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/ target=_blank rel="noopener noreferrer">https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/</a></li></ul></li><li><p>DCSync</p><ul><li>Example: <a href=https://fahmifj.github.io/tags/dcsync/ target=_blank rel="noopener noreferrer">DCSync tags</a></li></ul></li></ul><p>Attack scenario(s) that requires two clients online + server:</p><ul><li>SMB Relay<ul><li>Examples: <a href=https://fahmifj.github.io/writeups/hackthebox/htb-apt/ target=_blank rel="noopener noreferrer">HackTheBox - APT</a>, <a href=https://akimboviper.gitbook.io/pentest-everything/everything/everything-windows/attacking-windows/relay-attacks/smb-relay target=_blank rel="noopener noreferrer">SMB Relay Attack</a></li></ul></li></ul></div></div><div class=post-meta-bottom></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/virtualization/>virtualization</a></li><li><a href=https://fahmifj.github.io/tags/virtualbox/>virtualbox</a></li><li><a href=https://fahmifj.github.io/tags/kali/>kali</a></li><li><a href=https://fahmifj.github.io/tags/windows-server/>windows-server</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on twitter" href="https://twitter.com/intent/tweet/?text=Building%20Virtual%20Home%20Lab%20for%20Pentesting&amp;url=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f&amp;hashtags=virtualization%2cvirtualbox%2ckali%2cwindows-server"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f&amp;title=Building%20Virtual%20Home%20Lab%20for%20Pentesting&amp;summary=Building%20Virtual%20Home%20Lab%20for%20Pentesting&amp;source=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f&title=Building%20Virtual%20Home%20Lab%20for%20Pentesting"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on whatsapp" href="https://api.whatsapp.com/send?text=Building%20Virtual%20Home%20Lab%20for%20Pentesting%20-%20https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Building Virtual Home Lab for Pentesting on telegram" href="https://telegram.me/share/url?text=Building%20Virtual%20Home%20Lab%20for%20Pentesting&amp;url=https%3a%2f%2ffahmifj.github.io%2fblog%2fbuilding-virtual-home-lab-for-pentest%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><div class=footer-wrapper><div class=footer-right><span class=copyright>&copy; 2025&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span></div><div class=footer-mid><span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a>
</span>&nbsp;·&nbsp;
<span class=support><a href=https://fahmifj.github.io/about#support>support</a>
</span>&nbsp;·&nbsp;
<span class=rss><a href=https://fahmifj.github.io/index.xml>rss</a></span></div><div class=footer-left><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
</span><span>&#183;</span>
<span><a href=https://git.io/hugopapermod rel="noopener noreferrer" target=_blank>PaperMod</a></span></div></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a><script>document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script src=https://fahmifj.github.io/js/toc.min.2fdf2a552d475a4f70f7cd5bdd987dfa7d62f78b07acacd44027b6b9486268e4.js></script><script defer type=module src=https://fahmifj.github.io/js/Swup.umd.min.d64a38b8723041127f14ef7bcd3898876f7226120fe6bd79aadb73f863ee0395.js></script><script defer src=https://fahmifj.github.io/js/custom.min.0d656f9bbea8e2daee0da7be0ee49b1213d8dde31ca5a8c1c16340bee53daea9.js></script></body></html>